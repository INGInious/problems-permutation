var PermutationTaskUI=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=Muuri},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initialized=!1,this.TPL_ANSWER_CONTAINER="$pid-answer",this.TPL_CANDIDATES_CONTAINER="$pid-candidates",this.TPL_HIDDEN_INPUTS="$pid-hidden-inputs",this.TPL_CARD="$pid-card$item",this.TPL_HIDDEN_INPUT_POS="$pid-$item-pos",this.TPL_HIDDEN_INPUT_IPOS="$pid-$item-ipos"}return s(e,[{key:"init",value:function(e){this.pid=e,this._initialized=!0}},{key:"stringify",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this._initialized)throw"Uninitialized IdManager";return null==t?e.replace("$pid",this.pid):e.replace("$pid",this.pid).replace("$item",t)}}]),e}()),o=!1,u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(){function e(t,n,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o&&this.ipos<0?this.ipos=-1:this.ipos=t,this.name=n,this.content=i,this.showEnum=r,this.textSelectable=!1,this.pos=this.ipos}return u(e,[{key:"get_id",value:function(){return a.stringify(a.TPL_CARD,this.ipos+"")}},{key:"toString",value:function(){return this.content}},{key:"build",value:function(e){this.enumeration=document.createElement("span"),this.enumeration.style.fontSize="1.2em",this.enumeration.style.position="absolute",this.enumeration.innerHTML="",this.contentCard=document.createElement("div"),this.contentCard.innerHTML=this.content,this.showEnum&&(this.contentCard.style.marginLeft="2em"),this.card=document.createElement("div"),this.card.classList.add("permutation-item"),this.textSelectable||this.card.classList.add("unselectable");var t=document.createElement("div");t.setAttribute("class","permutation-item-content"),t.setAttribute("id",this.get_id()),t.appendChild(this.enumeration),t.appendChild(this.contentCard),this.card.appendChild(t),this.iposHiddenInput=document.createElement("input"),this.iposHiddenInput.setAttribute("type","hidden"),this.iposHiddenInput.setAttribute("name",a.stringify(a.TPL_HIDDEN_INPUT_IPOS,this.name)),this.iposHiddenInput.setAttribute("value",e+"#"+this.ipos),this.posHiddenInput=document.createElement("input"),this.posHiddenInput.setAttribute("type","hidden"),this.posHiddenInput.setAttribute("name",this.get_pos_id()),this.posHiddenInput.setAttribute("value",e+"#"+this.pos)}},{key:"get_pos_id",value:function(){return a.stringify(a.TPL_HIDDEN_INPUT_POS,this.name)}},{key:"update_position",value:function(e,t){this.table=e,this.pos=t,t<0?this.posHiddenInput.setAttribute("value",this.table+"#"+-this.pos):this.posHiddenInput.setAttribute("value",this.table+"#"+this.pos),t>0?this.showEnum&&(this.enumeration.innerHTML=t+". "):this.enumeration.innerHTML=""}},{key:"get_card",value:function(){return this.card}},{key:"get_iposHiddenInput",value:function(){return this.iposHiddenInput}},{key:"get_posHiddenInput",value:function(){return this.posHiddenInput}},{key:"get_y",value:function(){return this.card.getBoundingClientRect().top}}]),e}(),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=50,h=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listenerCount=new Set,this.doScroll=!1,this.topMouseY=2*c,this.bottomMouseY=screen.height-2*c,this.__bind_functions()}return d(e,[{key:"__bind_functions",value:function(){this.enableListener=this.enableListener.bind(this),this.disableListener=this.disableListener.bind(this),this.scrollLoop=this.scrollLoop.bind(this),this.startScrolling=this.startScrolling.bind(this),this.stopScrolling=this.stopScrolling.bind(this),this.updateMouse=this.updateMouse.bind(this)}},{key:"scrollLoop",value:function(){this.topMouseY<=c?window.scrollBy(0,-30):this.bottomMouseY>=screen.height-c&&window.scrollBy(0,30),this.doScroll&&setTimeout(this.scrollLoop,30)}},{key:"startScrolling",value:function(){this.doScroll=!0,this.scrollLoop()}},{key:"stopScrolling",value:function(){this.doScroll=!1}},{key:"updateMouse",value:function(e){this.topMouseY=e.pageY-window.pageYOffset,this.bottomMouseY=e.screenY}},{key:"enableListener",value:function(e){if(this.listenerCount.add(e),!(this.listenerCount.size>1)){this.topMouseY=2*c,this.bottomMouseY=screen.height-2*c;var t=document.body;t&&t.addEventListener("mousemove",this.updateMouse,!0),this.startScrolling()}}},{key:"disableListener",value:function(e){if(this.listenerCount.delete(e),!(this.listenerCount.size>0)){this.stopScrolling();var t=document.body;t&&t.removeEventListener("mousemove",this.updateMouse,!0)}}}]),e}()),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),m=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__bind_functions();var s=this;this.candidatesTableName=i[0][0],this.answersTablesNames=i.slice(1).map(function(e){return e[0]}),this.muuris=new Map,this.containers=new Map,this.answerItems=new Map,this.candidateItems=new Set,this.itemsMap={},this.itemsPosMap=new Map;for(var u=0;u<n.length;u++)this.itemsMap[n[u].get_id()]=n[u],this.itemsPosMap.set(n[u].get_pos_id(),n[u]),this.candidateItems.add(n[u]);this.columnGrids=[];for(var l=1;l<i.length;l++){var d=i[l],c=d[0],h=d[1],p=document.createElement("div");p.setAttribute("class","permutation-column");var m=document.createElement("div");m.setAttribute("class","permutation-column-header unselectable"),m.style.background=h;var f=document.createElement("span");f.setAttribute("class","glyphicon glyphicon-th-list"),m.appendChild(f),m.innerHTML+="<b> "+c+"</b>";var g=document.createElement("div");g.setAttribute("class","permutation-column-content"),p.appendChild(m),p.appendChild(g),t.appendChild(p),this.add_table(g,c,h,i)}var b=document.createElement("div");b.setAttribute("class","permutation-column");var v=document.createElement("div");v.setAttribute("class","permutation-column-header unselectable"),v.style.background=i[0][1];var _=document.createElement("span");_.setAttribute("class","glyphicon glyphicon-trash"),v.appendChild(_),v.innerHTML+="<b> "+i[0][0]+"</b>";var y=document.createElement("div");y.setAttribute("class","permutation-column-content"),y.setAttribute("id",a.pid+"-candidates"),this.populate_items(n,y),b.appendChild(v),b.appendChild(y),t.appendChild(b),this.generate_muuri(this.candidatesTableName,y,function(e){for(var t=1;t<i.length;t++){var n=i[t][0],r=s.answerItems.get(n);if(r){if(r.has(e)){r.delete(e);for(var a=s.get_sorted_items(r),u=0;u<a.length;u++)a[u].update_position(n,u+1)}}else console.error("Undefined table "+n)}if(s.candidateItems.add(e),o)e.update_position(i[0][0],-1);else{a=s.get_sorted_items(s.candidateItems);for(var l=0;l<a.length;l++)a[l].update_position(i[0][0],-l-1)}}),this.boardGrid=new r.a(".permutation",{layoutDuration:400,layoutEasing:"ease",dragEnabled:!1,dragSortInterval:0,dragStartPredicate:{handle:".permutation-column-header"},dragReleaseDuration:400,dragReleaseEasing:"ease"})}return p(e,[{key:"__bind_functions",value:function(){this.sortItems=this.sortItems.bind(this),this.generate_muuri=this.generate_muuri.bind(this)}}]),p(e,[{key:"sortItems",value:function(e,t){var n=this,i=this.muuris.get(this.candidatesTableName),r=this.containers.get(this.candidatesTableName);if(r){var s=r;this.candidateItems.forEach(function(e){i.remove(0),s.removeChild(e.get_card())});for(var a=0;a<this.answersTablesNames.length;a++){var o=this.answersTablesNames[a],u=this.muuris.get(o),l=this.containers.get(o),d=this.answerItems.get(o);d&&u&&l?d.forEach(function(e){u.remove(0),l.removeChild(e.get_card())}):console.error("Item not found!")}this.candidateItems.clear(),this.answerItems.forEach(function(e){e.clear()});var c=new Map;c.set(this.candidatesTableName,new Map),this.answersTablesNames.forEach(function(e){c.set(e,new Map)}),console.log(this.itemsPosMap),e.map(function(e,i){if(n.itemsPosMap.has(e)){var r=n.itemsPosMap.get(e),s=t[i],a=s.lastIndexOf("#"),o=s.substring(0,a),u=parseInt(s.substring(a+1)),l=c.get(o);if(l)if(r){if(o==n.candidatesTableName)n.candidateItems.add(r),r.update_position(o,-u);else{var d=n.answerItems.get(o);d?d.add(r):console.error("Could not find items table"),r.update_position(o,u)}l.has(u)&&l.set(l.size+1,r),l.set(u,r)}else console.error('Error loading item "'+e+'"');else console.error('Error loading map from table "'+o+'"')}});var h={};for(c.forEach(function(e,t){var n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e.entries())).sort(function(e,t){return e[0]>t[0]?1:-1}).map(function(e){return e[1]});h[t]=n}),i.add(h[this.candidatesTableName].map(function(e){return e.get_card()})),a=0;a<this.answersTablesNames.length;a++){o=this.answersTablesNames[a];var p=this.muuris.get(o);p?p.add(h[o].map(function(e){return e.get_card()})):console.error("Could not find muuri for table "+o)}}else console.error("Candidates container not found")}},{key:"populate_items",value:function(e,t){for(var n=0;n<e.length;n++)t.appendChild(e[n].get_card())}},{key:"add_table",value:function(e,t,n,i){var r=this;this.answerItems.set(t,new Set),this.generate_muuri(t,e,function(e){if(r.candidateItems.has(e)&&(r.candidateItems.delete(e),!o))for(var n=r.get_sorted_items(r.candidateItems),s=0;s<n.length;s++)n[s].update_position(i[0][0],-s-1);for(var a=1;a<i.length;a++){var u=i[a][0];if(u!=t)if(d=r.answerItems.get(u)){if(d.has(e)){d.delete(e),n=r.get_sorted_items(d);for(var l=0;l<n.length;l++)n[l].update_position(u,l+1)}}else console.error("Undefined table "+u)}var d;if(d=r.answerItems.get(t)){d.add(e),n=r.get_sorted_items(d);for(var c=0;c<n.length;c++)n[c].update_position(t,c+1)}else console.error("Undefined table "+t)})}},{key:"get_sorted_items",value:function(e){var t=[],n=[];e.forEach(function(e){n.push([e.get_y(),e])}),n=n.sort(function(e,t){return e[0]>t[0]?1:-1});for(var i=0;i<n.length;i++)t.push(n[i][1]);return t}},{key:"generate_muuri",value:function(e,t,n){var i=this,s=new r.a(t,{items:".permutation-item",layoutDuration:400,layoutEasing:"ease",dragEnabled:!0,dragSort:function(){return i.columnGrids},dragSortInterval:0,dragContainer:document.body,dragReleaseDuration:400,dragReleaseEasing:"ease"}).on("dragStart",function(e){e.getElement().style.width=e.getWidth()+"px",e.getElement().style.height=e.getHeight()+"px",h.enableListener(e._child.getAttribute("id"))}).on("dragReleaseEnd",function(e){e.getElement().style.width="",e.getElement().style.height="",i.columnGrids.forEach(function(e){e.refreshItems()}),h.disableListener(e._child.getAttribute("id")),null!=n&&n(i.itemsMap[e._child.getAttribute("id")])}).on("layoutStart",function(){i.boardGrid.refreshItems().layout()});i.columnGrids.push(s),i.muuris.set(e,s),i.containers.set(e,t)}}]),e}(),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),g=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=this;this.listContainer=t,this.answers=new Set,this.itemsMap={};for(var s=0;s<n.length;s++)this.itemsMap[n[s].get_id()]=n[s],this.answers.add(n[s]);this.generate_muuri(t,function(e){for(var t=r.get_sorted_items(r.answers),n=0;n<t.length;n++)t[n].update_position(i,n+1)})}return f(e,[{key:"get_sorted_items",value:function(e){var t=[],n=[];e.forEach(function(e){n.push([e.get_y(),e])}),n=n.sort(function(e,t){return e[0]>t[0]?1:-1});for(var i=0;i<n.length;i++)t.push(n[i][1]);return t}},{key:"generate_muuri",value:function(e,t){var n=this,i=new r.a(e,{items:".permutation-item",layoutDuration:400,layoutEasing:"ease",dragEnabled:!0,dragSort:function(){return[n.columnGrid]},dragSortInterval:0,dragContainer:document.body,dragReleaseDuration:400,dragReleaseEasing:"ease"}).on("dragStart",function(e){e.getElement().style.width=e.getWidth()+"px",e.getElement().style.height=e.getHeight()+"px",h.enableListener(e._child.getAttribute("id"))}).on("dragReleaseEnd",function(e){e.getElement().style.width="",e.getElement().style.height="",n.columnGrid.refreshItems(),h.disableListener(e._child.getAttribute("id")),null!=t&&t(n.itemsMap[e._child.getAttribute("id")])});n.columnGrid=i}}]),e}();function b(e,t,n,i,r){return a.init(t),"trello"==e?function(e,t,n,i){var r=document.getElementById(a.stringify(a.TPL_ANSWER_CONTAINER)),s=document.getElementById(a.stringify(a.TPL_HIDDEN_INPUTS));if(null==r||null==s)return console.error("Something is null:"),console.log(r),void console.log(s);for(var o=r,u=s,d=[],c=0;c<t.length;c++){var h;(h=new l(c+1,n[c],t[c])).build(i[0][0]),u.appendChild(h.get_iposHiddenInput()),u.appendChild(h.get_posHiddenInput()),d.push(h)}return new m(o,d,i)}(0,n,i,r):"list"==e?function(e,t,n,i){var r=i[1][0],s=i[1][1],o=document.getElementById(a.stringify(a.TPL_ANSWER_CONTAINER)),u=document.getElementById(a.stringify(a.TPL_HIDDEN_INPUTS));if(null==o||null==u)return console.error("Something is null:"),console.log(o),void console.log(u);var d=document.createElement("div");d.setAttribute("class","permutation-column");var c=document.createElement("div");c.setAttribute("class","permutation-column-header unselectable"),c.style.background=s;var h=document.createElement("span");h.setAttribute("class","glyphicon glyphicon-th-list"),c.appendChild(h),c.innerHTML+="<b> "+r+"</b>";var p=document.createElement("div");p.setAttribute("class","permutation-column-content"),d.appendChild(c),d.appendChild(p),o.appendChild(d);for(var m=p,f=u,b=[],v=0;v<t.length;v++){var _;(_=new l(v+1,n[v],t[v])).build(r),m.appendChild(_.get_card()),f.appendChild(_.get_iposHiddenInput()),f.appendChild(_.get_posHiddenInput()),b.push(_)}return new g(m,b,r)}(0,n,i,r):void 0}n.d(t,"generate_ui",function(){return b})}]);