{"version":3,"sources":["webpack://PermutationTaskUI/webpack/bootstrap","webpack://PermutationTaskUI/./node_modules/hammerjs/hammer.js","webpack://PermutationTaskUI/./node_modules/muuri/muuri.js","webpack://PermutationTaskUI/(webpack)/buildin/module.js","webpack://PermutationTaskUI/./src/GridSystem.jsx","webpack://PermutationTaskUI/./src/IdManager.jsx","webpack://PermutationTaskUI/./src/Item.jsx","webpack://PermutationTaskUI/./src/PermutationList.jsx","webpack://PermutationTaskUI/./src/flags.jsx","webpack://PermutationTaskUI/./src/index.jsx"],"names":["window","document","exportName","undefined","VENDOR_PREFIXES","TEST_ELEMENT","createElement","TYPE_FUNCTION","round","Math","abs","now","Date","setTimeoutContext","fn","timeout","context","setTimeout","bindFn","invokeArrayArg","arg","Array","isArray","each","obj","iterator","i","forEach","length","call","hasOwnProperty","deprecate","method","name","message","deprecationMessage","e","Error","stack","replace","log","console","warn","apply","arguments","assign","Object","target","TypeError","output","index","source","nextKey","extend","dest","src","merge","keys","inherit","child","base","properties","baseP","prototype","childP","create","constructor","_super","boundFn","boolOrFn","val","args","ifUndefined","val1","val2","addEventListeners","types","handler","splitStr","type","addEventListener","removeEventListeners","removeEventListener","hasParent","node","parent","parentNode","inStr","str","find","indexOf","trim","split","inArray","findByKey","toArray","slice","uniqueArray","key","sort","results","values","push","sortUniqueArray","a","b","prefixed","property","prefix","prop","camelProp","toUpperCase","_uniqueId","uniqueId","getWindowForElement","element","doc","ownerDocument","defaultView","parentWindow","MOBILE_REGEX","SUPPORT_TOUCH","SUPPORT_POINTER_EVENTS","SUPPORT_ONLY_TOUCH","test","navigator","userAgent","INPUT_TYPE_TOUCH","INPUT_TYPE_PEN","INPUT_TYPE_MOUSE","INPUT_TYPE_KINECT","COMPUTE_INTERVAL","INPUT_START","INPUT_MOVE","INPUT_END","INPUT_CANCEL","DIRECTION_NONE","DIRECTION_LEFT","DIRECTION_RIGHT","DIRECTION_UP","DIRECTION_DOWN","DIRECTION_HORIZONTAL","DIRECTION_VERTICAL","DIRECTION_ALL","PROPS_XY","PROPS_CLIENT_XY","Input","manager","callback","self","options","inputTarget","domHandler","ev","enable","init","evEl","evTarget","evWin","destroy","createInputInstance","Type","inputClass","PointerEventInput","TouchInput","MouseInput","TouchMouseInput","inputHandler","eventType","input","pointersLen","pointers","changedPointersLen","changedPointers","isFirst","isFinal","session","computeInputData","emit","recognize","prevInput","pointersLength","firstInput","simpleCloneInputData","firstMultiple","offsetCenter","center","getCenter","timeStamp","deltaTime","angle","getAngle","distance","getDistance","computeDeltaXY","offsetDirection","getDirection","deltaX","deltaY","overallVelocity","getVelocity","overallVelocityX","x","overallVelocityY","y","scale","getScale","rotation","getRotation","maxPointers","computeIntervalInputData","srcEvent","offset","offsetDelta","prevDelta","last","lastInterval","velocity","velocityX","velocityY","direction","v","clientX","clientY","p1","p2","props","sqrt","atan2","PI","start","end","MOUSE_INPUT_MAP","mousedown","mousemove","mouseup","MOUSE_ELEMENT_EVENTS","MOUSE_WINDOW_EVENTS","pressed","MEhandler","button","which","pointerType","POINTER_INPUT_MAP","pointerdown","pointermove","pointerup","pointercancel","pointerout","IE10_POINTER_TYPE_ENUM","POINTER_ELEMENT_EVENTS","POINTER_WINDOW_EVENTS","MSPointerEvent","PointerEvent","store","pointerEvents","PEhandler","removePointer","eventTypeNormalized","toLowerCase","isTouch","storeIndex","pointerId","splice","SINGLE_TOUCH_INPUT_MAP","touchstart","touchmove","touchend","touchcancel","SINGLE_TOUCH_TARGET_EVENTS","SINGLE_TOUCH_WINDOW_EVENTS","SingleTouchInput","started","TEhandler","touches","normalizeSingleTouches","all","changed","changedTouches","concat","TOUCH_INPUT_MAP","TOUCH_TARGET_EVENTS","targetIds","MTEhandler","getTouches","allTouches","identifier","targetTouches","changedTargetTouches","filter","touch","DEDUP_TIMEOUT","DEDUP_DISTANCE","mouse","primaryTouch","lastTouches","TMEhandler","inputEvent","inputData","isMouse","sourceCapabilities","firesTouchEvents","recordTouches","isSyntheticEvent","eventData","setLastTouch","lastTouch","lts","removeLastTouch","t","dx","dy","PREFIXED_TOUCH_ACTION","style","NATIVE_TOUCH_ACTION","TOUCH_ACTION_COMPUTE","TOUCH_ACTION_AUTO","TOUCH_ACTION_MANIPULATION","TOUCH_ACTION_NONE","TOUCH_ACTION_PAN_X","TOUCH_ACTION_PAN_Y","TOUCH_ACTION_MAP","getTouchActionProps","TouchAction","value","set","compute","actions","update","touchAction","recognizers","recognizer","getTouchAction","cleanTouchActions","join","preventDefaults","prevented","preventDefault","hasNone","hasPanY","hasPanX","isTapPointer","isTapMovement","isTapTouchTime","preventSrc","touchMap","cssSupports","CSS","supports","STATE_POSSIBLE","STATE_BEGAN","STATE_CHANGED","STATE_ENDED","STATE_RECOGNIZED","STATE_CANCELLED","STATE_FAILED","Recognizer","defaults","id","state","simultaneous","requireFail","recognizeWith","otherRecognizer","getRecognizerByNameIfManager","dropRecognizeWith","requireFailure","dropRequireFailure","hasRequireFailures","canRecognizeWith","event","stateStr","additionalEvent","tryEmit","canEmit","inputDataClone","reset","process","directionStr","get","AttrRecognizer","attrTest","optionPointers","isRecognized","isValid","PanRecognizer","pX","pY","threshold","directionTest","hasMoved","PinchRecognizer","inOut","PressRecognizer","_timer","_input","time","validPointers","validMovement","validTime","clearTimeout","RotateRecognizer","SwipeRecognizer","TapRecognizer","pTime","pCenter","count","taps","interval","posThreshold","validTouchTime","failTimeout","validInterval","validMultiTap","tapCount","Hammer","preset","Manager","VERSION","domEvents","cssProps","userSelect","touchSelect","touchCallout","contentZooming","userDrag","tapHighlightColor","STOP","FORCED_STOP","handlers","oldCssProps","toggleCssProps","item","add","stop","force","stopped","curRecognizer","existing","remove","on","events","off","data","triggerDomEvent","gestureEvent","createEvent","initEvent","gesture","dispatchEvent","Tap","Pan","Swipe","Pinch","Rotate","Press","freeGlobal","define","global","factory","namespace","module","exports","require","Element","docElem","documentElement","body","typeFunction","typeString","typeNumber","rafLoop","createRafLoop","rafQueueLayout","rafQueueVisibility","rafQueueMove","rafQueueScroll","startPredicateInactive","startPredicatePending","startPredicateResolved","startPredicateRejected","gridInstances","itemInstances","noop","uuid","elementMatches","getSupportedElementMatches","transform","getSupportedStyle","transformLeaksFixed","doesTransformLeakFixed","evSynchronize","evLayoutStart","evLayoutEnd","evAdd","evRemove","evShowStart","evShowEnd","evHideStart","evHideEnd","evFilter","evSort","evMove","evSend","evBeforeSend","evReceive","evBeforeReceive","evDragInit","evDragStart","evDragMove","evDragScroll","evDragEnd","evDragReleaseStart","evDragReleaseEnd","evDestroy","Grid","inst","settings","items","layoutOnResize","_element","querySelector","contains","_settings","mergeSettings","defaultOptions","dragSort","_id","_isDestroyed","_layout","_emitter","Emitter","_itemShowHandler","getItemVisibilityHandler","_itemHideHandler","addClass","containerClass","_items","nodeListToArray","children","itemElement","Item","isNodeList","map","_resizeHandler","debounce","refreshItems","layout","layoutOnInit","ItemDrag","ItemRelease","ItemMigrate","ItemAnimate","Layout","showDuration","showEasing","hideDuration","hideEasing","visibleStyles","opacity","hiddenStyles","fillGaps","horizontal","alignRight","alignBottom","rounding","layoutDuration","layoutEasing","sortData","dragEnabled","dragContainer","dragStartPredicate","delay","handle","dragAxis","dragSortInterval","dragSortPredicate","action","dragReleaseDuration","dragReleaseEasing","dragHammerSettings","itemClass","itemVisibleClass","itemHiddenClass","itemPositioningClass","itemDraggingClass","itemReleasingClass","_maxRafBatchSize","listener","once","getElement","getItems","targets","hasTargets","targetItems","targetState","ret","_getItem","isItemInState","_refreshDimensions","refreshSortData","_refreshSortData","synchronize","container","fragment","createDocumentFragment","appendChild","_emit","instant","onFinish","isInstant","counter","isBorderBox","containerStyles","position","tryFinish","setWidth","setHeight","getStyle","height","_border","top","bottom","width","left","right","setStyles","slots","_left","_top","isDragging","elements","targetElements","newItems","opts","needsLayout","elementIndex","_isActive","_skipNextLayoutAnimation","insertItemsToArray","allItems","indices","_destroy","removeElements","show","gridShowHideHandler","hide","predicate","predicateType","isPredicateString","isPredicateFn","itemsToShow","itemsToHide","tryFinishCounter","comparer","isDescending","descending","origItems","indexMap","result","compareItemIndices","getItemIndexMap","compareItems","sortItemsByReference","reverse","move","isSwap","fromItem","toItem","fromIndex","toIndex","arraySwap","arrayMove","send","grid","currentGrid","targetGrid","appendTo","layoutSender","layoutReceiver","_migrate","isActive","removeClass","_gridId","rect","getBoundingClientRect","sides","_width","_height","getStyleAsFloat","isHidden","_child","_animate","_animateChild","_isPositioning","_isHidden","_isHiding","_isShowing","_visibilityQueue","_layoutQueue","getTranslateString","display","_release","_drag","getGrid","getWidth","getHeight","getMargin","_margin","getPosition","isVisible","isShowing","isHiding","isPositioning","_data","isReleasing","isDestroyed","margin","side","getters","_sortData","migrate","release","isJustReleased","isPositioningStarted","animDuration","animEasing","animEnabled","isAnimating","offsetLeft","offsetTop","currentLeft","currentTop","targetStyles","processQueue","containerDiffX","containerDiffY","cancel","_stopLayout","_finishLayout","getTranslateAsFloat","duration","easing","processLayoutQueue","_show","queue","_hide","removeElement","removeAttribute","removeChild","layoutSettings","isCustomLayout","muuriLayout","isPlainObject","_events","listeners","arg1","arg2","arg3","listenersLength","argsLength","eventNames","_item","_animation","_propsTo","propsFrom","propsTo","shouldStop","some","propName","onfinish","animate","currentProps","getCurrentStyles","_itemId","getItem","isItemVisible","currentGridStn","targetGridStn","targetGridElement","currentIndex","targetIndex","targetContainer","currentContainer","offsetDiff","containerDiff","translateX","translateY","normalizeArrayIndex","fromGrid","toGrid","getOffsetDiff","abort","currentStyles","gridElement","drag","hammer","startPredicate","defaultStartPredicate","startPredicateState","startPredicateResult","_hammer","_isMigrating","_resolveStartPredicate","onStart","_scrollListener","onScroll","_checkSortOverlap","checkOverlap","_sortPredicate","defaultSortPredicate","onMove","isResolved","onEnd","_startPredicateData","config","isAnchor","href","max","tagName","getAttribute","dragStartPredicateReset","open","location","handleElement","parentElement","delayTimer","dragStartPredicateResolve","dragData","rootGrid","sortThreshold","sortAction","itemRect","elementClientX","elementClientY","getTargetGrid","gridOffsetLeft","gridOffsetTop","matchScore","matchIndex","hasValidTargets","score","gridX","gridY","getRectOverlapScore","Infinity","containingBlock","startEvent","currentEvent","scrollers","bindScrollListeners","gridContainer","getScrollParents","arrayUnique","unbindScrollListeners","isMigration","finishMigration","targetSettings","currentSettings","cancelRafLoop","getContainingBlock","elementRect","axis","xDiff","yDiff","array","maxIndex","withIndex","indexA","indexB","temp","from","to","len","toString","mergeObjects","isObject","wait","actionCancel","actionFinish","nextTick","raf","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","cb","bind","readCallback","writeCallback","unshift","flush","maxBatchSize","batch","min","batchMap","getStyleName","string","getComputedStyle","getPropertyValue","styleName","el","parseFloat","styles","current","className","classList","nodeList","p","matches","matchesSelector","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","selector","styleCap","charAt","prefixes","elemA","elemB","compareContainingBlocks","aOffset","getOffset","bOffset","excludeElementBorders","pageXOffset","pageYOffset","isParent","isTransformed","overflowRegex","elems","elem","isInner","visibility","outer","inner","isLeaking","doRectsOverlap","maxWidth","maxHeight","itemA","itemB","criterias","criteriaName","criteriaOrder","valA","valB","refItems","currentItems","isPointWithinRect","isShow","endEvent","completedItems","hiddenItems","interrupted","parseInt","isEnabled","grids","bestScore","gridScore","instance","callbacks","methodName","defaultSettings","userSettings","pointer","pageX","pageY","handleRect","isHorizontal","freeSlots","slotIds","slotData","slot","itemWidth","itemHeight","getSlot","vertical","leeway","newSlots","potentialSlots","ignoreCurrentSlots","ii","splitRect","purgeRects","sortRectsTopLeft","sortRectsLeftTop","hole","isRectWithinRect","rects","rectA","rectB","webpackPolyfill","paths","defineProperty","enumerable","l","GridSystem","sortItems","generate_muuri","listsContainer","tablesMetadata","__bind_functions","that","candidatesTableName","answersTablesNames","pair","muuris","Map","containers","answerItems","candidateItems","Set","itemsMap","itemsPosMap","get_id","get_pos_id","columnGrids","tableId","metadata","tableName","tableColor","setAttribute","headerContainer","background","header","innerHTML","add_table","container2","headerContainer2","header2","candidatesContainer","IdManager","pid","populate_items","table","error","has","delete","sorted","get_sorted_items","update_position","boardGrid","itemsPos","candidatesMuuri","tmpContainer","get_card","muuriGrid","itemSet","clear","mappedOrder","itemId","itemPos","sepPos","lastIndexOf","substring","pos","tableItems","size","newOrder","posMap","sortedItems","entries","muuri","otherTableName","unsorted","posItemPair","get_y","include_item","_initialized","TPL_ANSWER_CONTAINER","TPL_CANDIDATES_CONTAINER","TPL_HIDDEN_INPUTS","TPL_CARD","TPL_HIDDEN_INPUT_POS","TPL_HIDDEN_INPUT_IPOS","template","itemid","ipos","content","showEnum","USE_SACK_ALGORITHM","textSelectable","stringify","enumeration","fontSize","contentCard","marginLeft","card","itemContent","iposHiddenInput","posHiddenInput","PermutationList","listContainer","answers","process_item","columnGrid","generate_trello_ui","elemsId","nullListsContainer","getElementById","nullHiddenInputs","hiddenInputs","build","get_iposHiddenInput","get_posHiddenInput","generate_list_ui","nullAnswersContainer","answersContainer","generate_ui","ptype"],"mappings":"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","file":"../../inginious-problems-permutation/static/ui/permutation_task.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.jsx\");\n","/*! Hammer.JS - v2.0.7 - 2016-04-22\n * http://hammerjs.github.io/\n *\n * Copyright (c) 2016 Jorik Tangelder;\n * Licensed under the MIT license */\n(function(window, document, exportName, undefined) {\n  'use strict';\n\nvar VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];\nvar TEST_ELEMENT = document.createElement('div');\n\nvar TYPE_FUNCTION = 'function';\n\nvar round = Math.round;\nvar abs = Math.abs;\nvar now = Date.now;\n\n/**\n * set a timeout with a given scope\n * @param {Function} fn\n * @param {Number} timeout\n * @param {Object} context\n * @returns {number}\n */\nfunction setTimeoutContext(fn, timeout, context) {\n    return setTimeout(bindFn(fn, context), timeout);\n}\n\n/**\n * if the argument is an array, we want to execute the fn on each entry\n * if it aint an array we don't want to do a thing.\n * this is used by all the methods that accept a single and array argument.\n * @param {*|Array} arg\n * @param {String} fn\n * @param {Object} [context]\n * @returns {Boolean}\n */\nfunction invokeArrayArg(arg, fn, context) {\n    if (Array.isArray(arg)) {\n        each(arg, context[fn], context);\n        return true;\n    }\n    return false;\n}\n\n/**\n * walk objects and arrays\n * @param {Object} obj\n * @param {Function} iterator\n * @param {Object} context\n */\nfunction each(obj, iterator, context) {\n    var i;\n\n    if (!obj) {\n        return;\n    }\n\n    if (obj.forEach) {\n        obj.forEach(iterator, context);\n    } else if (obj.length !== undefined) {\n        i = 0;\n        while (i < obj.length) {\n            iterator.call(context, obj[i], i, obj);\n            i++;\n        }\n    } else {\n        for (i in obj) {\n            obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);\n        }\n    }\n}\n\n/**\n * wrap a method with a deprecation warning and stack trace\n * @param {Function} method\n * @param {String} name\n * @param {String} message\n * @returns {Function} A new function wrapping the supplied method.\n */\nfunction deprecate(method, name, message) {\n    var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\\n' + message + ' AT \\n';\n    return function() {\n        var e = new Error('get-stack-trace');\n        var stack = e && e.stack ? e.stack.replace(/^[^\\(]+?[\\n$]/gm, '')\n            .replace(/^\\s+at\\s+/gm, '')\n            .replace(/^Object.<anonymous>\\s*\\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';\n\n        var log = window.console && (window.console.warn || window.console.log);\n        if (log) {\n            log.call(window.console, deprecationMessage, stack);\n        }\n        return method.apply(this, arguments);\n    };\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} target\n * @param {...Object} objects_to_assign\n * @returns {Object} target\n */\nvar assign;\nif (typeof Object.assign !== 'function') {\n    assign = function assign(target) {\n        if (target === undefined || target === null) {\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var output = Object(target);\n        for (var index = 1; index < arguments.length; index++) {\n            var source = arguments[index];\n            if (source !== undefined && source !== null) {\n                for (var nextKey in source) {\n                    if (source.hasOwnProperty(nextKey)) {\n                        output[nextKey] = source[nextKey];\n                    }\n                }\n            }\n        }\n        return output;\n    };\n} else {\n    assign = Object.assign;\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} dest\n * @param {Object} src\n * @param {Boolean} [merge=false]\n * @returns {Object} dest\n */\nvar extend = deprecate(function extend(dest, src, merge) {\n    var keys = Object.keys(src);\n    var i = 0;\n    while (i < keys.length) {\n        if (!merge || (merge && dest[keys[i]] === undefined)) {\n            dest[keys[i]] = src[keys[i]];\n        }\n        i++;\n    }\n    return dest;\n}, 'extend', 'Use `assign`.');\n\n/**\n * merge the values from src in the dest.\n * means that properties that exist in dest will not be overwritten by src\n * @param {Object} dest\n * @param {Object} src\n * @returns {Object} dest\n */\nvar merge = deprecate(function merge(dest, src) {\n    return extend(dest, src, true);\n}, 'merge', 'Use `assign`.');\n\n/**\n * simple class inheritance\n * @param {Function} child\n * @param {Function} base\n * @param {Object} [properties]\n */\nfunction inherit(child, base, properties) {\n    var baseP = base.prototype,\n        childP;\n\n    childP = child.prototype = Object.create(baseP);\n    childP.constructor = child;\n    childP._super = baseP;\n\n    if (properties) {\n        assign(childP, properties);\n    }\n}\n\n/**\n * simple function bind\n * @param {Function} fn\n * @param {Object} context\n * @returns {Function}\n */\nfunction bindFn(fn, context) {\n    return function boundFn() {\n        return fn.apply(context, arguments);\n    };\n}\n\n/**\n * let a boolean value also be a function that must return a boolean\n * this first item in args will be used as the context\n * @param {Boolean|Function} val\n * @param {Array} [args]\n * @returns {Boolean}\n */\nfunction boolOrFn(val, args) {\n    if (typeof val == TYPE_FUNCTION) {\n        return val.apply(args ? args[0] || undefined : undefined, args);\n    }\n    return val;\n}\n\n/**\n * use the val2 when val1 is undefined\n * @param {*} val1\n * @param {*} val2\n * @returns {*}\n */\nfunction ifUndefined(val1, val2) {\n    return (val1 === undefined) ? val2 : val1;\n}\n\n/**\n * addEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction addEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.addEventListener(type, handler, false);\n    });\n}\n\n/**\n * removeEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction removeEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.removeEventListener(type, handler, false);\n    });\n}\n\n/**\n * find if a node is in the given parent\n * @method hasParent\n * @param {HTMLElement} node\n * @param {HTMLElement} parent\n * @return {Boolean} found\n */\nfunction hasParent(node, parent) {\n    while (node) {\n        if (node == parent) {\n            return true;\n        }\n        node = node.parentNode;\n    }\n    return false;\n}\n\n/**\n * small indexOf wrapper\n * @param {String} str\n * @param {String} find\n * @returns {Boolean} found\n */\nfunction inStr(str, find) {\n    return str.indexOf(find) > -1;\n}\n\n/**\n * split string on whitespace\n * @param {String} str\n * @returns {Array} words\n */\nfunction splitStr(str) {\n    return str.trim().split(/\\s+/g);\n}\n\n/**\n * find if a array contains the object using indexOf or a simple polyFill\n * @param {Array} src\n * @param {String} find\n * @param {String} [findByKey]\n * @return {Boolean|Number} false when not found, or the index\n */\nfunction inArray(src, find, findByKey) {\n    if (src.indexOf && !findByKey) {\n        return src.indexOf(find);\n    } else {\n        var i = 0;\n        while (i < src.length) {\n            if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {\n                return i;\n            }\n            i++;\n        }\n        return -1;\n    }\n}\n\n/**\n * convert array-like objects to real arrays\n * @param {Object} obj\n * @returns {Array}\n */\nfunction toArray(obj) {\n    return Array.prototype.slice.call(obj, 0);\n}\n\n/**\n * unique array with objects based on a key (like 'id') or just by the array's value\n * @param {Array} src [{id:1},{id:2},{id:1}]\n * @param {String} [key]\n * @param {Boolean} [sort=False]\n * @returns {Array} [{id:1},{id:2}]\n */\nfunction uniqueArray(src, key, sort) {\n    var results = [];\n    var values = [];\n    var i = 0;\n\n    while (i < src.length) {\n        var val = key ? src[i][key] : src[i];\n        if (inArray(values, val) < 0) {\n            results.push(src[i]);\n        }\n        values[i] = val;\n        i++;\n    }\n\n    if (sort) {\n        if (!key) {\n            results = results.sort();\n        } else {\n            results = results.sort(function sortUniqueArray(a, b) {\n                return a[key] > b[key];\n            });\n        }\n    }\n\n    return results;\n}\n\n/**\n * get the prefixed property\n * @param {Object} obj\n * @param {String} property\n * @returns {String|Undefined} prefixed\n */\nfunction prefixed(obj, property) {\n    var prefix, prop;\n    var camelProp = property[0].toUpperCase() + property.slice(1);\n\n    var i = 0;\n    while (i < VENDOR_PREFIXES.length) {\n        prefix = VENDOR_PREFIXES[i];\n        prop = (prefix) ? prefix + camelProp : property;\n\n        if (prop in obj) {\n            return prop;\n        }\n        i++;\n    }\n    return undefined;\n}\n\n/**\n * get a unique id\n * @returns {number} uniqueId\n */\nvar _uniqueId = 1;\nfunction uniqueId() {\n    return _uniqueId++;\n}\n\n/**\n * get the window object of an element\n * @param {HTMLElement} element\n * @returns {DocumentView|Window}\n */\nfunction getWindowForElement(element) {\n    var doc = element.ownerDocument || element;\n    return (doc.defaultView || doc.parentWindow || window);\n}\n\nvar MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\n\nvar SUPPORT_TOUCH = ('ontouchstart' in window);\nvar SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\nvar SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);\n\nvar INPUT_TYPE_TOUCH = 'touch';\nvar INPUT_TYPE_PEN = 'pen';\nvar INPUT_TYPE_MOUSE = 'mouse';\nvar INPUT_TYPE_KINECT = 'kinect';\n\nvar COMPUTE_INTERVAL = 25;\n\nvar INPUT_START = 1;\nvar INPUT_MOVE = 2;\nvar INPUT_END = 4;\nvar INPUT_CANCEL = 8;\n\nvar DIRECTION_NONE = 1;\nvar DIRECTION_LEFT = 2;\nvar DIRECTION_RIGHT = 4;\nvar DIRECTION_UP = 8;\nvar DIRECTION_DOWN = 16;\n\nvar DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;\nvar DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;\nvar DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;\n\nvar PROPS_XY = ['x', 'y'];\nvar PROPS_CLIENT_XY = ['clientX', 'clientY'];\n\n/**\n * create new input type manager\n * @param {Manager} manager\n * @param {Function} callback\n * @returns {Input}\n * @constructor\n */\nfunction Input(manager, callback) {\n    var self = this;\n    this.manager = manager;\n    this.callback = callback;\n    this.element = manager.element;\n    this.target = manager.options.inputTarget;\n\n    // smaller wrapper around the handler, for the scope and the enabled state of the manager,\n    // so when disabled the input events are completely bypassed.\n    this.domHandler = function(ev) {\n        if (boolOrFn(manager.options.enable, [manager])) {\n            self.handler(ev);\n        }\n    };\n\n    this.init();\n\n}\n\nInput.prototype = {\n    /**\n     * should handle the inputEvent data and trigger the callback\n     * @virtual\n     */\n    handler: function() { },\n\n    /**\n     * bind the events\n     */\n    init: function() {\n        this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    },\n\n    /**\n     * unbind the events\n     */\n    destroy: function() {\n        this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    }\n};\n\n/**\n * create new input type manager\n * called by the Manager constructor\n * @param {Hammer} manager\n * @returns {Input}\n */\nfunction createInputInstance(manager) {\n    var Type;\n    var inputClass = manager.options.inputClass;\n\n    if (inputClass) {\n        Type = inputClass;\n    } else if (SUPPORT_POINTER_EVENTS) {\n        Type = PointerEventInput;\n    } else if (SUPPORT_ONLY_TOUCH) {\n        Type = TouchInput;\n    } else if (!SUPPORT_TOUCH) {\n        Type = MouseInput;\n    } else {\n        Type = TouchMouseInput;\n    }\n    return new (Type)(manager, inputHandler);\n}\n\n/**\n * handle input events\n * @param {Manager} manager\n * @param {String} eventType\n * @param {Object} input\n */\nfunction inputHandler(manager, eventType, input) {\n    var pointersLen = input.pointers.length;\n    var changedPointersLen = input.changedPointers.length;\n    var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));\n    var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));\n\n    input.isFirst = !!isFirst;\n    input.isFinal = !!isFinal;\n\n    if (isFirst) {\n        manager.session = {};\n    }\n\n    // source event is the normalized value of the domEvents\n    // like 'touchstart, mouseup, pointerdown'\n    input.eventType = eventType;\n\n    // compute scale, rotation etc\n    computeInputData(manager, input);\n\n    // emit secret event\n    manager.emit('hammer.input', input);\n\n    manager.recognize(input);\n    manager.session.prevInput = input;\n}\n\n/**\n * extend the data with some usable properties like scale, rotate, velocity etc\n * @param {Object} manager\n * @param {Object} input\n */\nfunction computeInputData(manager, input) {\n    var session = manager.session;\n    var pointers = input.pointers;\n    var pointersLength = pointers.length;\n\n    // store the first input to calculate the distance and direction\n    if (!session.firstInput) {\n        session.firstInput = simpleCloneInputData(input);\n    }\n\n    // to compute scale and rotation we need to store the multiple touches\n    if (pointersLength > 1 && !session.firstMultiple) {\n        session.firstMultiple = simpleCloneInputData(input);\n    } else if (pointersLength === 1) {\n        session.firstMultiple = false;\n    }\n\n    var firstInput = session.firstInput;\n    var firstMultiple = session.firstMultiple;\n    var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;\n\n    var center = input.center = getCenter(pointers);\n    input.timeStamp = now();\n    input.deltaTime = input.timeStamp - firstInput.timeStamp;\n\n    input.angle = getAngle(offsetCenter, center);\n    input.distance = getDistance(offsetCenter, center);\n\n    computeDeltaXY(session, input);\n    input.offsetDirection = getDirection(input.deltaX, input.deltaY);\n\n    var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);\n    input.overallVelocityX = overallVelocity.x;\n    input.overallVelocityY = overallVelocity.y;\n    input.overallVelocity = (abs(overallVelocity.x) > abs(overallVelocity.y)) ? overallVelocity.x : overallVelocity.y;\n\n    input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;\n    input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;\n\n    input.maxPointers = !session.prevInput ? input.pointers.length : ((input.pointers.length >\n        session.prevInput.maxPointers) ? input.pointers.length : session.prevInput.maxPointers);\n\n    computeIntervalInputData(session, input);\n\n    // find the correct target\n    var target = manager.element;\n    if (hasParent(input.srcEvent.target, target)) {\n        target = input.srcEvent.target;\n    }\n    input.target = target;\n}\n\nfunction computeDeltaXY(session, input) {\n    var center = input.center;\n    var offset = session.offsetDelta || {};\n    var prevDelta = session.prevDelta || {};\n    var prevInput = session.prevInput || {};\n\n    if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {\n        prevDelta = session.prevDelta = {\n            x: prevInput.deltaX || 0,\n            y: prevInput.deltaY || 0\n        };\n\n        offset = session.offsetDelta = {\n            x: center.x,\n            y: center.y\n        };\n    }\n\n    input.deltaX = prevDelta.x + (center.x - offset.x);\n    input.deltaY = prevDelta.y + (center.y - offset.y);\n}\n\n/**\n * velocity is calculated every x ms\n * @param {Object} session\n * @param {Object} input\n */\nfunction computeIntervalInputData(session, input) {\n    var last = session.lastInterval || input,\n        deltaTime = input.timeStamp - last.timeStamp,\n        velocity, velocityX, velocityY, direction;\n\n    if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {\n        var deltaX = input.deltaX - last.deltaX;\n        var deltaY = input.deltaY - last.deltaY;\n\n        var v = getVelocity(deltaTime, deltaX, deltaY);\n        velocityX = v.x;\n        velocityY = v.y;\n        velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;\n        direction = getDirection(deltaX, deltaY);\n\n        session.lastInterval = input;\n    } else {\n        // use latest velocity info if it doesn't overtake a minimum period\n        velocity = last.velocity;\n        velocityX = last.velocityX;\n        velocityY = last.velocityY;\n        direction = last.direction;\n    }\n\n    input.velocity = velocity;\n    input.velocityX = velocityX;\n    input.velocityY = velocityY;\n    input.direction = direction;\n}\n\n/**\n * create a simple clone from the input used for storage of firstInput and firstMultiple\n * @param {Object} input\n * @returns {Object} clonedInputData\n */\nfunction simpleCloneInputData(input) {\n    // make a simple copy of the pointers because we will get a reference if we don't\n    // we only need clientXY for the calculations\n    var pointers = [];\n    var i = 0;\n    while (i < input.pointers.length) {\n        pointers[i] = {\n            clientX: round(input.pointers[i].clientX),\n            clientY: round(input.pointers[i].clientY)\n        };\n        i++;\n    }\n\n    return {\n        timeStamp: now(),\n        pointers: pointers,\n        center: getCenter(pointers),\n        deltaX: input.deltaX,\n        deltaY: input.deltaY\n    };\n}\n\n/**\n * get the center of all the pointers\n * @param {Array} pointers\n * @return {Object} center contains `x` and `y` properties\n */\nfunction getCenter(pointers) {\n    var pointersLength = pointers.length;\n\n    // no need to loop when only one touch\n    if (pointersLength === 1) {\n        return {\n            x: round(pointers[0].clientX),\n            y: round(pointers[0].clientY)\n        };\n    }\n\n    var x = 0, y = 0, i = 0;\n    while (i < pointersLength) {\n        x += pointers[i].clientX;\n        y += pointers[i].clientY;\n        i++;\n    }\n\n    return {\n        x: round(x / pointersLength),\n        y: round(y / pointersLength)\n    };\n}\n\n/**\n * calculate the velocity between two points. unit is in px per ms.\n * @param {Number} deltaTime\n * @param {Number} x\n * @param {Number} y\n * @return {Object} velocity `x` and `y`\n */\nfunction getVelocity(deltaTime, x, y) {\n    return {\n        x: x / deltaTime || 0,\n        y: y / deltaTime || 0\n    };\n}\n\n/**\n * get the direction between two points\n * @param {Number} x\n * @param {Number} y\n * @return {Number} direction\n */\nfunction getDirection(x, y) {\n    if (x === y) {\n        return DIRECTION_NONE;\n    }\n\n    if (abs(x) >= abs(y)) {\n        return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\n    }\n    return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\n}\n\n/**\n * calculate the absolute distance between two points\n * @param {Object} p1 {x, y}\n * @param {Object} p2 {x, y}\n * @param {Array} [props] containing x and y keys\n * @return {Number} distance\n */\nfunction getDistance(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n\n    return Math.sqrt((x * x) + (y * y));\n}\n\n/**\n * calculate the angle between two coordinates\n * @param {Object} p1\n * @param {Object} p2\n * @param {Array} [props] containing x and y keys\n * @return {Number} angle\n */\nfunction getAngle(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n    return Math.atan2(y, x) * 180 / Math.PI;\n}\n\n/**\n * calculate the rotation degrees between two pointersets\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} rotation\n */\nfunction getRotation(start, end) {\n    return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);\n}\n\n/**\n * calculate the scale factor between two pointersets\n * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} scale\n */\nfunction getScale(start, end) {\n    return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);\n}\n\nvar MOUSE_INPUT_MAP = {\n    mousedown: INPUT_START,\n    mousemove: INPUT_MOVE,\n    mouseup: INPUT_END\n};\n\nvar MOUSE_ELEMENT_EVENTS = 'mousedown';\nvar MOUSE_WINDOW_EVENTS = 'mousemove mouseup';\n\n/**\n * Mouse events input\n * @constructor\n * @extends Input\n */\nfunction MouseInput() {\n    this.evEl = MOUSE_ELEMENT_EVENTS;\n    this.evWin = MOUSE_WINDOW_EVENTS;\n\n    this.pressed = false; // mousedown state\n\n    Input.apply(this, arguments);\n}\n\ninherit(MouseInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function MEhandler(ev) {\n        var eventType = MOUSE_INPUT_MAP[ev.type];\n\n        // on start we want to have the left mouse button down\n        if (eventType & INPUT_START && ev.button === 0) {\n            this.pressed = true;\n        }\n\n        if (eventType & INPUT_MOVE && ev.which !== 1) {\n            eventType = INPUT_END;\n        }\n\n        // mouse must be down\n        if (!this.pressed) {\n            return;\n        }\n\n        if (eventType & INPUT_END) {\n            this.pressed = false;\n        }\n\n        this.callback(this.manager, eventType, {\n            pointers: [ev],\n            changedPointers: [ev],\n            pointerType: INPUT_TYPE_MOUSE,\n            srcEvent: ev\n        });\n    }\n});\n\nvar POINTER_INPUT_MAP = {\n    pointerdown: INPUT_START,\n    pointermove: INPUT_MOVE,\n    pointerup: INPUT_END,\n    pointercancel: INPUT_CANCEL,\n    pointerout: INPUT_CANCEL\n};\n\n// in IE10 the pointer types is defined as an enum\nvar IE10_POINTER_TYPE_ENUM = {\n    2: INPUT_TYPE_TOUCH,\n    3: INPUT_TYPE_PEN,\n    4: INPUT_TYPE_MOUSE,\n    5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816\n};\n\nvar POINTER_ELEMENT_EVENTS = 'pointerdown';\nvar POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';\n\n// IE10 has prefixed support, and case-sensitive\nif (window.MSPointerEvent && !window.PointerEvent) {\n    POINTER_ELEMENT_EVENTS = 'MSPointerDown';\n    POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';\n}\n\n/**\n * Pointer events input\n * @constructor\n * @extends Input\n */\nfunction PointerEventInput() {\n    this.evEl = POINTER_ELEMENT_EVENTS;\n    this.evWin = POINTER_WINDOW_EVENTS;\n\n    Input.apply(this, arguments);\n\n    this.store = (this.manager.session.pointerEvents = []);\n}\n\ninherit(PointerEventInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function PEhandler(ev) {\n        var store = this.store;\n        var removePointer = false;\n\n        var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');\n        var eventType = POINTER_INPUT_MAP[eventTypeNormalized];\n        var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;\n\n        var isTouch = (pointerType == INPUT_TYPE_TOUCH);\n\n        // get index of the event in the store\n        var storeIndex = inArray(store, ev.pointerId, 'pointerId');\n\n        // start and mouse must be down\n        if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {\n            if (storeIndex < 0) {\n                store.push(ev);\n                storeIndex = store.length - 1;\n            }\n        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n            removePointer = true;\n        }\n\n        // it not found, so the pointer hasn't been down (so it's probably a hover)\n        if (storeIndex < 0) {\n            return;\n        }\n\n        // update the event in the store\n        store[storeIndex] = ev;\n\n        this.callback(this.manager, eventType, {\n            pointers: store,\n            changedPointers: [ev],\n            pointerType: pointerType,\n            srcEvent: ev\n        });\n\n        if (removePointer) {\n            // remove from the store\n            store.splice(storeIndex, 1);\n        }\n    }\n});\n\nvar SINGLE_TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';\nvar SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Touch events input\n * @constructor\n * @extends Input\n */\nfunction SingleTouchInput() {\n    this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;\n    this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;\n    this.started = false;\n\n    Input.apply(this, arguments);\n}\n\ninherit(SingleTouchInput, Input, {\n    handler: function TEhandler(ev) {\n        var type = SINGLE_TOUCH_INPUT_MAP[ev.type];\n\n        // should we handle the touch events?\n        if (type === INPUT_START) {\n            this.started = true;\n        }\n\n        if (!this.started) {\n            return;\n        }\n\n        var touches = normalizeSingleTouches.call(this, ev, type);\n\n        // when done, reset the started state\n        if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {\n            this.started = false;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction normalizeSingleTouches(ev, type) {\n    var all = toArray(ev.touches);\n    var changed = toArray(ev.changedTouches);\n\n    if (type & (INPUT_END | INPUT_CANCEL)) {\n        all = uniqueArray(all.concat(changed), 'identifier', true);\n    }\n\n    return [all, changed];\n}\n\nvar TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Multi-user touch events input\n * @constructor\n * @extends Input\n */\nfunction TouchInput() {\n    this.evTarget = TOUCH_TARGET_EVENTS;\n    this.targetIds = {};\n\n    Input.apply(this, arguments);\n}\n\ninherit(TouchInput, Input, {\n    handler: function MTEhandler(ev) {\n        var type = TOUCH_INPUT_MAP[ev.type];\n        var touches = getTouches.call(this, ev, type);\n        if (!touches) {\n            return;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction getTouches(ev, type) {\n    var allTouches = toArray(ev.touches);\n    var targetIds = this.targetIds;\n\n    // when there is only one touch, the process can be simplified\n    if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {\n        targetIds[allTouches[0].identifier] = true;\n        return [allTouches, allTouches];\n    }\n\n    var i,\n        targetTouches,\n        changedTouches = toArray(ev.changedTouches),\n        changedTargetTouches = [],\n        target = this.target;\n\n    // get target touches from touches\n    targetTouches = allTouches.filter(function(touch) {\n        return hasParent(touch.target, target);\n    });\n\n    // collect touches\n    if (type === INPUT_START) {\n        i = 0;\n        while (i < targetTouches.length) {\n            targetIds[targetTouches[i].identifier] = true;\n            i++;\n        }\n    }\n\n    // filter changed touches to only contain touches that exist in the collected target ids\n    i = 0;\n    while (i < changedTouches.length) {\n        if (targetIds[changedTouches[i].identifier]) {\n            changedTargetTouches.push(changedTouches[i]);\n        }\n\n        // cleanup removed touches\n        if (type & (INPUT_END | INPUT_CANCEL)) {\n            delete targetIds[changedTouches[i].identifier];\n        }\n        i++;\n    }\n\n    if (!changedTargetTouches.length) {\n        return;\n    }\n\n    return [\n        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'\n        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),\n        changedTargetTouches\n    ];\n}\n\n/**\n * Combined touch and mouse input\n *\n * Touch has a higher priority then mouse, and while touching no mouse events are allowed.\n * This because touch devices also emit mouse events while doing a touch.\n *\n * @constructor\n * @extends Input\n */\n\nvar DEDUP_TIMEOUT = 2500;\nvar DEDUP_DISTANCE = 25;\n\nfunction TouchMouseInput() {\n    Input.apply(this, arguments);\n\n    var handler = bindFn(this.handler, this);\n    this.touch = new TouchInput(this.manager, handler);\n    this.mouse = new MouseInput(this.manager, handler);\n\n    this.primaryTouch = null;\n    this.lastTouches = [];\n}\n\ninherit(TouchMouseInput, Input, {\n    /**\n     * handle mouse and touch events\n     * @param {Hammer} manager\n     * @param {String} inputEvent\n     * @param {Object} inputData\n     */\n    handler: function TMEhandler(manager, inputEvent, inputData) {\n        var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),\n            isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);\n\n        if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {\n            return;\n        }\n\n        // when we're in a touch event, record touches to  de-dupe synthetic mouse event\n        if (isTouch) {\n            recordTouches.call(this, inputEvent, inputData);\n        } else if (isMouse && isSyntheticEvent.call(this, inputData)) {\n            return;\n        }\n\n        this.callback(manager, inputEvent, inputData);\n    },\n\n    /**\n     * remove the event listeners\n     */\n    destroy: function destroy() {\n        this.touch.destroy();\n        this.mouse.destroy();\n    }\n});\n\nfunction recordTouches(eventType, eventData) {\n    if (eventType & INPUT_START) {\n        this.primaryTouch = eventData.changedPointers[0].identifier;\n        setLastTouch.call(this, eventData);\n    } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n        setLastTouch.call(this, eventData);\n    }\n}\n\nfunction setLastTouch(eventData) {\n    var touch = eventData.changedPointers[0];\n\n    if (touch.identifier === this.primaryTouch) {\n        var lastTouch = {x: touch.clientX, y: touch.clientY};\n        this.lastTouches.push(lastTouch);\n        var lts = this.lastTouches;\n        var removeLastTouch = function() {\n            var i = lts.indexOf(lastTouch);\n            if (i > -1) {\n                lts.splice(i, 1);\n            }\n        };\n        setTimeout(removeLastTouch, DEDUP_TIMEOUT);\n    }\n}\n\nfunction isSyntheticEvent(eventData) {\n    var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;\n    for (var i = 0; i < this.lastTouches.length; i++) {\n        var t = this.lastTouches[i];\n        var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);\n        if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {\n            return true;\n        }\n    }\n    return false;\n}\n\nvar PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');\nvar NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;\n\n// magical touchAction value\nvar TOUCH_ACTION_COMPUTE = 'compute';\nvar TOUCH_ACTION_AUTO = 'auto';\nvar TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented\nvar TOUCH_ACTION_NONE = 'none';\nvar TOUCH_ACTION_PAN_X = 'pan-x';\nvar TOUCH_ACTION_PAN_Y = 'pan-y';\nvar TOUCH_ACTION_MAP = getTouchActionProps();\n\n/**\n * Touch Action\n * sets the touchAction property or uses the js alternative\n * @param {Manager} manager\n * @param {String} value\n * @constructor\n */\nfunction TouchAction(manager, value) {\n    this.manager = manager;\n    this.set(value);\n}\n\nTouchAction.prototype = {\n    /**\n     * set the touchAction value on the element or enable the polyfill\n     * @param {String} value\n     */\n    set: function(value) {\n        // find out the touch-action by the event handlers\n        if (value == TOUCH_ACTION_COMPUTE) {\n            value = this.compute();\n        }\n\n        if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {\n            this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;\n        }\n        this.actions = value.toLowerCase().trim();\n    },\n\n    /**\n     * just re-set the touchAction value\n     */\n    update: function() {\n        this.set(this.manager.options.touchAction);\n    },\n\n    /**\n     * compute the value for the touchAction property based on the recognizer's settings\n     * @returns {String} value\n     */\n    compute: function() {\n        var actions = [];\n        each(this.manager.recognizers, function(recognizer) {\n            if (boolOrFn(recognizer.options.enable, [recognizer])) {\n                actions = actions.concat(recognizer.getTouchAction());\n            }\n        });\n        return cleanTouchActions(actions.join(' '));\n    },\n\n    /**\n     * this method is called on each input cycle and provides the preventing of the browser behavior\n     * @param {Object} input\n     */\n    preventDefaults: function(input) {\n        var srcEvent = input.srcEvent;\n        var direction = input.offsetDirection;\n\n        // if the touch action did prevented once this session\n        if (this.manager.session.prevented) {\n            srcEvent.preventDefault();\n            return;\n        }\n\n        var actions = this.actions;\n        var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];\n        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];\n        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];\n\n        if (hasNone) {\n            //do not prevent defaults if this is a tap gesture\n\n            var isTapPointer = input.pointers.length === 1;\n            var isTapMovement = input.distance < 2;\n            var isTapTouchTime = input.deltaTime < 250;\n\n            if (isTapPointer && isTapMovement && isTapTouchTime) {\n                return;\n            }\n        }\n\n        if (hasPanX && hasPanY) {\n            // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent\n            return;\n        }\n\n        if (hasNone ||\n            (hasPanY && direction & DIRECTION_HORIZONTAL) ||\n            (hasPanX && direction & DIRECTION_VERTICAL)) {\n            return this.preventSrc(srcEvent);\n        }\n    },\n\n    /**\n     * call preventDefault to prevent the browser's default behavior (scrolling in most cases)\n     * @param {Object} srcEvent\n     */\n    preventSrc: function(srcEvent) {\n        this.manager.session.prevented = true;\n        srcEvent.preventDefault();\n    }\n};\n\n/**\n * when the touchActions are collected they are not a valid value, so we need to clean things up. *\n * @param {String} actions\n * @returns {*}\n */\nfunction cleanTouchActions(actions) {\n    // none\n    if (inStr(actions, TOUCH_ACTION_NONE)) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);\n    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);\n\n    // if both pan-x and pan-y are set (different recognizers\n    // for different directions, e.g. horizontal pan but vertical swipe?)\n    // we need none (as otherwise with pan-x pan-y combined none of these\n    // recognizers will work, since the browser would handle all panning\n    if (hasPanX && hasPanY) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    // pan-x OR pan-y\n    if (hasPanX || hasPanY) {\n        return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;\n    }\n\n    // manipulation\n    if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {\n        return TOUCH_ACTION_MANIPULATION;\n    }\n\n    return TOUCH_ACTION_AUTO;\n}\n\nfunction getTouchActionProps() {\n    if (!NATIVE_TOUCH_ACTION) {\n        return false;\n    }\n    var touchMap = {};\n    var cssSupports = window.CSS && window.CSS.supports;\n    ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function(val) {\n\n        // If css.supports is not supported but there is native touch-action assume it supports\n        // all values. This is the case for IE 10 and 11.\n        touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;\n    });\n    return touchMap;\n}\n\n/**\n * Recognizer flow explained; *\n * All recognizers have the initial state of POSSIBLE when a input session starts.\n * The definition of a input session is from the first input until the last input, with all it's movement in it. *\n * Example session for mouse-input: mousedown -> mousemove -> mouseup\n *\n * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed\n * which determines with state it should be.\n *\n * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to\n * POSSIBLE to give it another change on the next cycle.\n *\n *               Possible\n *                  |\n *            +-----+---------------+\n *            |                     |\n *      +-----+-----+               |\n *      |           |               |\n *   Failed      Cancelled          |\n *                          +-------+------+\n *                          |              |\n *                      Recognized       Began\n *                                         |\n *                                      Changed\n *                                         |\n *                                  Ended/Recognized\n */\nvar STATE_POSSIBLE = 1;\nvar STATE_BEGAN = 2;\nvar STATE_CHANGED = 4;\nvar STATE_ENDED = 8;\nvar STATE_RECOGNIZED = STATE_ENDED;\nvar STATE_CANCELLED = 16;\nvar STATE_FAILED = 32;\n\n/**\n * Recognizer\n * Every recognizer needs to extend from this class.\n * @constructor\n * @param {Object} options\n */\nfunction Recognizer(options) {\n    this.options = assign({}, this.defaults, options || {});\n\n    this.id = uniqueId();\n\n    this.manager = null;\n\n    // default is enable true\n    this.options.enable = ifUndefined(this.options.enable, true);\n\n    this.state = STATE_POSSIBLE;\n\n    this.simultaneous = {};\n    this.requireFail = [];\n}\n\nRecognizer.prototype = {\n    /**\n     * @virtual\n     * @type {Object}\n     */\n    defaults: {},\n\n    /**\n     * set options\n     * @param {Object} options\n     * @return {Recognizer}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // also update the touchAction, in case something changed about the directions/enabled state\n        this.manager && this.manager.touchAction.update();\n        return this;\n    },\n\n    /**\n     * recognize simultaneous with an other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    recognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {\n            return this;\n        }\n\n        var simultaneous = this.simultaneous;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (!simultaneous[otherRecognizer.id]) {\n            simultaneous[otherRecognizer.id] = otherRecognizer;\n            otherRecognizer.recognizeWith(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the simultaneous link. it doesnt remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRecognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        delete this.simultaneous[otherRecognizer.id];\n        return this;\n    },\n\n    /**\n     * recognizer can only run when an other is failing\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    requireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {\n            return this;\n        }\n\n        var requireFail = this.requireFail;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (inArray(requireFail, otherRecognizer) === -1) {\n            requireFail.push(otherRecognizer);\n            otherRecognizer.requireFailure(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the requireFailure link. it does not remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRequireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        var index = inArray(this.requireFail, otherRecognizer);\n        if (index > -1) {\n            this.requireFail.splice(index, 1);\n        }\n        return this;\n    },\n\n    /**\n     * has require failures boolean\n     * @returns {boolean}\n     */\n    hasRequireFailures: function() {\n        return this.requireFail.length > 0;\n    },\n\n    /**\n     * if the recognizer can recognize simultaneous with an other recognizer\n     * @param {Recognizer} otherRecognizer\n     * @returns {Boolean}\n     */\n    canRecognizeWith: function(otherRecognizer) {\n        return !!this.simultaneous[otherRecognizer.id];\n    },\n\n    /**\n     * You should use `tryEmit` instead of `emit` directly to check\n     * that all the needed recognizers has failed before emitting.\n     * @param {Object} input\n     */\n    emit: function(input) {\n        var self = this;\n        var state = this.state;\n\n        function emit(event) {\n            self.manager.emit(event, input);\n        }\n\n        // 'panstart' and 'panmove'\n        if (state < STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n\n        emit(self.options.event); // simple 'eventName' events\n\n        if (input.additionalEvent) { // additional event(panleft, panright, pinchin, pinchout...)\n            emit(input.additionalEvent);\n        }\n\n        // panend and pancancel\n        if (state >= STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n    },\n\n    /**\n     * Check that all the require failure recognizers has failed,\n     * if true, it emits a gesture event,\n     * otherwise, setup the state to FAILED.\n     * @param {Object} input\n     */\n    tryEmit: function(input) {\n        if (this.canEmit()) {\n            return this.emit(input);\n        }\n        // it's failing anyway\n        this.state = STATE_FAILED;\n    },\n\n    /**\n     * can we emit?\n     * @returns {boolean}\n     */\n    canEmit: function() {\n        var i = 0;\n        while (i < this.requireFail.length) {\n            if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {\n                return false;\n            }\n            i++;\n        }\n        return true;\n    },\n\n    /**\n     * update the recognizer\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        // make a new copy of the inputData\n        // so we can change the inputData without messing up the other recognizers\n        var inputDataClone = assign({}, inputData);\n\n        // is is enabled and allow recognizing?\n        if (!boolOrFn(this.options.enable, [this, inputDataClone])) {\n            this.reset();\n            this.state = STATE_FAILED;\n            return;\n        }\n\n        // reset when we've reached the end\n        if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {\n            this.state = STATE_POSSIBLE;\n        }\n\n        this.state = this.process(inputDataClone);\n\n        // the recognizer has recognized a gesture\n        // so trigger an event\n        if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {\n            this.tryEmit(inputDataClone);\n        }\n    },\n\n    /**\n     * return the state of the recognizer\n     * the actual recognizing happens in this method\n     * @virtual\n     * @param {Object} inputData\n     * @returns {Const} STATE\n     */\n    process: function(inputData) { }, // jshint ignore:line\n\n    /**\n     * return the preferred touch-action\n     * @virtual\n     * @returns {Array}\n     */\n    getTouchAction: function() { },\n\n    /**\n     * called when the gesture isn't allowed to recognize\n     * like when another is being recognized or it is disabled\n     * @virtual\n     */\n    reset: function() { }\n};\n\n/**\n * get a usable string, used as event postfix\n * @param {Const} state\n * @returns {String} state\n */\nfunction stateStr(state) {\n    if (state & STATE_CANCELLED) {\n        return 'cancel';\n    } else if (state & STATE_ENDED) {\n        return 'end';\n    } else if (state & STATE_CHANGED) {\n        return 'move';\n    } else if (state & STATE_BEGAN) {\n        return 'start';\n    }\n    return '';\n}\n\n/**\n * direction cons to string\n * @param {Const} direction\n * @returns {String}\n */\nfunction directionStr(direction) {\n    if (direction == DIRECTION_DOWN) {\n        return 'down';\n    } else if (direction == DIRECTION_UP) {\n        return 'up';\n    } else if (direction == DIRECTION_LEFT) {\n        return 'left';\n    } else if (direction == DIRECTION_RIGHT) {\n        return 'right';\n    }\n    return '';\n}\n\n/**\n * get a recognizer by name if it is bound to a manager\n * @param {Recognizer|String} otherRecognizer\n * @param {Recognizer} recognizer\n * @returns {Recognizer}\n */\nfunction getRecognizerByNameIfManager(otherRecognizer, recognizer) {\n    var manager = recognizer.manager;\n    if (manager) {\n        return manager.get(otherRecognizer);\n    }\n    return otherRecognizer;\n}\n\n/**\n * This recognizer is just used as a base for the simple attribute recognizers.\n * @constructor\n * @extends Recognizer\n */\nfunction AttrRecognizer() {\n    Recognizer.apply(this, arguments);\n}\n\ninherit(AttrRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof AttrRecognizer\n     */\n    defaults: {\n        /**\n         * @type {Number}\n         * @default 1\n         */\n        pointers: 1\n    },\n\n    /**\n     * Used to check if it the recognizer receives valid input, like input.distance > 10.\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {Boolean} recognized\n     */\n    attrTest: function(input) {\n        var optionPointers = this.options.pointers;\n        return optionPointers === 0 || input.pointers.length === optionPointers;\n    },\n\n    /**\n     * Process the input and return the state for the recognizer\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {*} State\n     */\n    process: function(input) {\n        var state = this.state;\n        var eventType = input.eventType;\n\n        var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);\n        var isValid = this.attrTest(input);\n\n        // on cancel input and we've recognized before, return STATE_CANCELLED\n        if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {\n            return state | STATE_CANCELLED;\n        } else if (isRecognized || isValid) {\n            if (eventType & INPUT_END) {\n                return state | STATE_ENDED;\n            } else if (!(state & STATE_BEGAN)) {\n                return STATE_BEGAN;\n            }\n            return state | STATE_CHANGED;\n        }\n        return STATE_FAILED;\n    }\n});\n\n/**\n * Pan\n * Recognized when the pointer is down and moved in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PanRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n\n    this.pX = null;\n    this.pY = null;\n}\n\ninherit(PanRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PanRecognizer\n     */\n    defaults: {\n        event: 'pan',\n        threshold: 10,\n        pointers: 1,\n        direction: DIRECTION_ALL\n    },\n\n    getTouchAction: function() {\n        var direction = this.options.direction;\n        var actions = [];\n        if (direction & DIRECTION_HORIZONTAL) {\n            actions.push(TOUCH_ACTION_PAN_Y);\n        }\n        if (direction & DIRECTION_VERTICAL) {\n            actions.push(TOUCH_ACTION_PAN_X);\n        }\n        return actions;\n    },\n\n    directionTest: function(input) {\n        var options = this.options;\n        var hasMoved = true;\n        var distance = input.distance;\n        var direction = input.direction;\n        var x = input.deltaX;\n        var y = input.deltaY;\n\n        // lock to axis?\n        if (!(direction & options.direction)) {\n            if (options.direction & DIRECTION_HORIZONTAL) {\n                direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;\n                hasMoved = x != this.pX;\n                distance = Math.abs(input.deltaX);\n            } else {\n                direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;\n                hasMoved = y != this.pY;\n                distance = Math.abs(input.deltaY);\n            }\n        }\n        input.direction = direction;\n        return hasMoved && distance > options.threshold && direction & options.direction;\n    },\n\n    attrTest: function(input) {\n        return AttrRecognizer.prototype.attrTest.call(this, input) &&\n            (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));\n    },\n\n    emit: function(input) {\n\n        this.pX = input.deltaX;\n        this.pY = input.deltaY;\n\n        var direction = directionStr(input.direction);\n\n        if (direction) {\n            input.additionalEvent = this.options.event + direction;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Pinch\n * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PinchRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(PinchRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'pinch',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);\n    },\n\n    emit: function(input) {\n        if (input.scale !== 1) {\n            var inOut = input.scale < 1 ? 'in' : 'out';\n            input.additionalEvent = this.options.event + inOut;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Press\n * Recognized when the pointer is down for x ms without any movement.\n * @constructor\n * @extends Recognizer\n */\nfunction PressRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    this._timer = null;\n    this._input = null;\n}\n\ninherit(PressRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PressRecognizer\n     */\n    defaults: {\n        event: 'press',\n        pointers: 1,\n        time: 251, // minimal time of the pointer to be pressed\n        threshold: 9 // a minimal movement is ok, but keep it low\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_AUTO];\n    },\n\n    process: function(input) {\n        var options = this.options;\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTime = input.deltaTime > options.time;\n\n        this._input = input;\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {\n            this.reset();\n        } else if (input.eventType & INPUT_START) {\n            this.reset();\n            this._timer = setTimeoutContext(function() {\n                this.state = STATE_RECOGNIZED;\n                this.tryEmit();\n            }, options.time, this);\n        } else if (input.eventType & INPUT_END) {\n            return STATE_RECOGNIZED;\n        }\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function(input) {\n        if (this.state !== STATE_RECOGNIZED) {\n            return;\n        }\n\n        if (input && (input.eventType & INPUT_END)) {\n            this.manager.emit(this.options.event + 'up', input);\n        } else {\n            this._input.timeStamp = now();\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Rotate\n * Recognized when two or more pointer are moving in a circular motion.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction RotateRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(RotateRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof RotateRecognizer\n     */\n    defaults: {\n        event: 'rotate',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);\n    }\n});\n\n/**\n * Swipe\n * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction SwipeRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(SwipeRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof SwipeRecognizer\n     */\n    defaults: {\n        event: 'swipe',\n        threshold: 10,\n        velocity: 0.3,\n        direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,\n        pointers: 1\n    },\n\n    getTouchAction: function() {\n        return PanRecognizer.prototype.getTouchAction.call(this);\n    },\n\n    attrTest: function(input) {\n        var direction = this.options.direction;\n        var velocity;\n\n        if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {\n            velocity = input.overallVelocity;\n        } else if (direction & DIRECTION_HORIZONTAL) {\n            velocity = input.overallVelocityX;\n        } else if (direction & DIRECTION_VERTICAL) {\n            velocity = input.overallVelocityY;\n        }\n\n        return this._super.attrTest.call(this, input) &&\n            direction & input.offsetDirection &&\n            input.distance > this.options.threshold &&\n            input.maxPointers == this.options.pointers &&\n            abs(velocity) > this.options.velocity && input.eventType & INPUT_END;\n    },\n\n    emit: function(input) {\n        var direction = directionStr(input.offsetDirection);\n        if (direction) {\n            this.manager.emit(this.options.event + direction, input);\n        }\n\n        this.manager.emit(this.options.event, input);\n    }\n});\n\n/**\n * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur\n * between the given interval and position. The delay option can be used to recognize multi-taps without firing\n * a single tap.\n *\n * The eventData from the emitted event contains the property `tapCount`, which contains the amount of\n * multi-taps being recognized.\n * @constructor\n * @extends Recognizer\n */\nfunction TapRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    // previous time and center,\n    // used for tap counting\n    this.pTime = false;\n    this.pCenter = false;\n\n    this._timer = null;\n    this._input = null;\n    this.count = 0;\n}\n\ninherit(TapRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'tap',\n        pointers: 1,\n        taps: 1,\n        interval: 300, // max time between the multi-tap taps\n        time: 250, // max time of the pointer to be down (like finger on the screen)\n        threshold: 9, // a minimal movement is ok, but keep it low\n        posThreshold: 10 // a multi-tap can be a bit off the initial position\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_MANIPULATION];\n    },\n\n    process: function(input) {\n        var options = this.options;\n\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTouchTime = input.deltaTime < options.time;\n\n        this.reset();\n\n        if ((input.eventType & INPUT_START) && (this.count === 0)) {\n            return this.failTimeout();\n        }\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (validMovement && validTouchTime && validPointers) {\n            if (input.eventType != INPUT_END) {\n                return this.failTimeout();\n            }\n\n            var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;\n            var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;\n\n            this.pTime = input.timeStamp;\n            this.pCenter = input.center;\n\n            if (!validMultiTap || !validInterval) {\n                this.count = 1;\n            } else {\n                this.count += 1;\n            }\n\n            this._input = input;\n\n            // if tap count matches we have recognized it,\n            // else it has began recognizing...\n            var tapCount = this.count % options.taps;\n            if (tapCount === 0) {\n                // no failing requirements, immediately trigger the tap event\n                // or wait as long as the multitap interval to trigger\n                if (!this.hasRequireFailures()) {\n                    return STATE_RECOGNIZED;\n                } else {\n                    this._timer = setTimeoutContext(function() {\n                        this.state = STATE_RECOGNIZED;\n                        this.tryEmit();\n                    }, options.interval, this);\n                    return STATE_BEGAN;\n                }\n            }\n        }\n        return STATE_FAILED;\n    },\n\n    failTimeout: function() {\n        this._timer = setTimeoutContext(function() {\n            this.state = STATE_FAILED;\n        }, this.options.interval, this);\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function() {\n        if (this.state == STATE_RECOGNIZED) {\n            this._input.tapCount = this.count;\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Simple way to create a manager with a default set of recognizers.\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Hammer(element, options) {\n    options = options || {};\n    options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);\n    return new Manager(element, options);\n}\n\n/**\n * @const {string}\n */\nHammer.VERSION = '2.0.7';\n\n/**\n * default settings\n * @namespace\n */\nHammer.defaults = {\n    /**\n     * set if DOM events are being triggered.\n     * But this is slower and unused by simple implementations, so disabled by default.\n     * @type {Boolean}\n     * @default false\n     */\n    domEvents: false,\n\n    /**\n     * The value for the touchAction property/fallback.\n     * When set to `compute` it will magically set the correct value based on the added recognizers.\n     * @type {String}\n     * @default compute\n     */\n    touchAction: TOUCH_ACTION_COMPUTE,\n\n    /**\n     * @type {Boolean}\n     * @default true\n     */\n    enable: true,\n\n    /**\n     * EXPERIMENTAL FEATURE -- can be removed/changed\n     * Change the parent input target element.\n     * If Null, then it is being set the to main element.\n     * @type {Null|EventTarget}\n     * @default null\n     */\n    inputTarget: null,\n\n    /**\n     * force an input class\n     * @type {Null|Function}\n     * @default null\n     */\n    inputClass: null,\n\n    /**\n     * Default recognizer setup when calling `Hammer()`\n     * When creating a new Manager these will be skipped.\n     * @type {Array}\n     */\n    preset: [\n        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]\n        [RotateRecognizer, {enable: false}],\n        [PinchRecognizer, {enable: false}, ['rotate']],\n        [SwipeRecognizer, {direction: DIRECTION_HORIZONTAL}],\n        [PanRecognizer, {direction: DIRECTION_HORIZONTAL}, ['swipe']],\n        [TapRecognizer],\n        [TapRecognizer, {event: 'doubletap', taps: 2}, ['tap']],\n        [PressRecognizer]\n    ],\n\n    /**\n     * Some CSS properties can be used to improve the working of Hammer.\n     * Add them to this method and they will be set when creating a new Manager.\n     * @namespace\n     */\n    cssProps: {\n        /**\n         * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userSelect: 'none',\n\n        /**\n         * Disable the Windows Phone grippers when pressing an element.\n         * @type {String}\n         * @default 'none'\n         */\n        touchSelect: 'none',\n\n        /**\n         * Disables the default callout shown when you touch and hold a touch target.\n         * On iOS, when you touch and hold a touch target such as a link, Safari displays\n         * a callout containing information about the link. This property allows you to disable that callout.\n         * @type {String}\n         * @default 'none'\n         */\n        touchCallout: 'none',\n\n        /**\n         * Specifies whether zooming is enabled. Used by IE10>\n         * @type {String}\n         * @default 'none'\n         */\n        contentZooming: 'none',\n\n        /**\n         * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userDrag: 'none',\n\n        /**\n         * Overrides the highlight color shown when the user taps a link or a JavaScript\n         * clickable element in iOS. This property obeys the alpha value, if specified.\n         * @type {String}\n         * @default 'rgba(0,0,0,0)'\n         */\n        tapHighlightColor: 'rgba(0,0,0,0)'\n    }\n};\n\nvar STOP = 1;\nvar FORCED_STOP = 2;\n\n/**\n * Manager\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Manager(element, options) {\n    this.options = assign({}, Hammer.defaults, options || {});\n\n    this.options.inputTarget = this.options.inputTarget || element;\n\n    this.handlers = {};\n    this.session = {};\n    this.recognizers = [];\n    this.oldCssProps = {};\n\n    this.element = element;\n    this.input = createInputInstance(this);\n    this.touchAction = new TouchAction(this, this.options.touchAction);\n\n    toggleCssProps(this, true);\n\n    each(this.options.recognizers, function(item) {\n        var recognizer = this.add(new (item[0])(item[1]));\n        item[2] && recognizer.recognizeWith(item[2]);\n        item[3] && recognizer.requireFailure(item[3]);\n    }, this);\n}\n\nManager.prototype = {\n    /**\n     * set options\n     * @param {Object} options\n     * @returns {Manager}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // Options that need a little more setup\n        if (options.touchAction) {\n            this.touchAction.update();\n        }\n        if (options.inputTarget) {\n            // Clean up existing event listeners and reinitialize\n            this.input.destroy();\n            this.input.target = options.inputTarget;\n            this.input.init();\n        }\n        return this;\n    },\n\n    /**\n     * stop recognizing for this session.\n     * This session will be discarded, when a new [input]start event is fired.\n     * When forced, the recognizer cycle is stopped immediately.\n     * @param {Boolean} [force]\n     */\n    stop: function(force) {\n        this.session.stopped = force ? FORCED_STOP : STOP;\n    },\n\n    /**\n     * run the recognizers!\n     * called by the inputHandler function on every movement of the pointers (touches)\n     * it walks through all the recognizers and tries to detect the gesture that is being made\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        var session = this.session;\n        if (session.stopped) {\n            return;\n        }\n\n        // run the touch-action polyfill\n        this.touchAction.preventDefaults(inputData);\n\n        var recognizer;\n        var recognizers = this.recognizers;\n\n        // this holds the recognizer that is being recognized.\n        // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED\n        // if no recognizer is detecting a thing, it is set to `null`\n        var curRecognizer = session.curRecognizer;\n\n        // reset when the last recognizer is recognized\n        // or when we're in a new session\n        if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {\n            curRecognizer = session.curRecognizer = null;\n        }\n\n        var i = 0;\n        while (i < recognizers.length) {\n            recognizer = recognizers[i];\n\n            // find out if we are allowed try to recognize the input for this one.\n            // 1.   allow if the session is NOT forced stopped (see the .stop() method)\n            // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one\n            //      that is being recognized.\n            // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.\n            //      this can be setup with the `recognizeWith()` method on the recognizer.\n            if (session.stopped !== FORCED_STOP && ( // 1\n                    !curRecognizer || recognizer == curRecognizer || // 2\n                    recognizer.canRecognizeWith(curRecognizer))) { // 3\n                recognizer.recognize(inputData);\n            } else {\n                recognizer.reset();\n            }\n\n            // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the\n            // current active recognizer. but only if we don't already have an active recognizer\n            if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {\n                curRecognizer = session.curRecognizer = recognizer;\n            }\n            i++;\n        }\n    },\n\n    /**\n     * get a recognizer by its event name.\n     * @param {Recognizer|String} recognizer\n     * @returns {Recognizer|Null}\n     */\n    get: function(recognizer) {\n        if (recognizer instanceof Recognizer) {\n            return recognizer;\n        }\n\n        var recognizers = this.recognizers;\n        for (var i = 0; i < recognizers.length; i++) {\n            if (recognizers[i].options.event == recognizer) {\n                return recognizers[i];\n            }\n        }\n        return null;\n    },\n\n    /**\n     * add a recognizer to the manager\n     * existing recognizers with the same event name will be removed\n     * @param {Recognizer} recognizer\n     * @returns {Recognizer|Manager}\n     */\n    add: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'add', this)) {\n            return this;\n        }\n\n        // remove existing\n        var existing = this.get(recognizer.options.event);\n        if (existing) {\n            this.remove(existing);\n        }\n\n        this.recognizers.push(recognizer);\n        recognizer.manager = this;\n\n        this.touchAction.update();\n        return recognizer;\n    },\n\n    /**\n     * remove a recognizer by name or instance\n     * @param {Recognizer|String} recognizer\n     * @returns {Manager}\n     */\n    remove: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'remove', this)) {\n            return this;\n        }\n\n        recognizer = this.get(recognizer);\n\n        // let's make sure this recognizer exists\n        if (recognizer) {\n            var recognizers = this.recognizers;\n            var index = inArray(recognizers, recognizer);\n\n            if (index !== -1) {\n                recognizers.splice(index, 1);\n                this.touchAction.update();\n            }\n        }\n\n        return this;\n    },\n\n    /**\n     * bind event\n     * @param {String} events\n     * @param {Function} handler\n     * @returns {EventEmitter} this\n     */\n    on: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n        if (handler === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            handlers[event] = handlers[event] || [];\n            handlers[event].push(handler);\n        });\n        return this;\n    },\n\n    /**\n     * unbind event, leave emit blank to remove all handlers\n     * @param {String} events\n     * @param {Function} [handler]\n     * @returns {EventEmitter} this\n     */\n    off: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            if (!handler) {\n                delete handlers[event];\n            } else {\n                handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);\n            }\n        });\n        return this;\n    },\n\n    /**\n     * emit event to the listeners\n     * @param {String} event\n     * @param {Object} data\n     */\n    emit: function(event, data) {\n        // we also want to trigger dom events\n        if (this.options.domEvents) {\n            triggerDomEvent(event, data);\n        }\n\n        // no handlers, so skip it all\n        var handlers = this.handlers[event] && this.handlers[event].slice();\n        if (!handlers || !handlers.length) {\n            return;\n        }\n\n        data.type = event;\n        data.preventDefault = function() {\n            data.srcEvent.preventDefault();\n        };\n\n        var i = 0;\n        while (i < handlers.length) {\n            handlers[i](data);\n            i++;\n        }\n    },\n\n    /**\n     * destroy the manager and unbinds all events\n     * it doesn't unbind dom events, that is the user own responsibility\n     */\n    destroy: function() {\n        this.element && toggleCssProps(this, false);\n\n        this.handlers = {};\n        this.session = {};\n        this.input.destroy();\n        this.element = null;\n    }\n};\n\n/**\n * add/remove the css properties as defined in manager.options.cssProps\n * @param {Manager} manager\n * @param {Boolean} add\n */\nfunction toggleCssProps(manager, add) {\n    var element = manager.element;\n    if (!element.style) {\n        return;\n    }\n    var prop;\n    each(manager.options.cssProps, function(value, name) {\n        prop = prefixed(element.style, name);\n        if (add) {\n            manager.oldCssProps[prop] = element.style[prop];\n            element.style[prop] = value;\n        } else {\n            element.style[prop] = manager.oldCssProps[prop] || '';\n        }\n    });\n    if (!add) {\n        manager.oldCssProps = {};\n    }\n}\n\n/**\n * trigger dom event\n * @param {String} event\n * @param {Object} data\n */\nfunction triggerDomEvent(event, data) {\n    var gestureEvent = document.createEvent('Event');\n    gestureEvent.initEvent(event, true, true);\n    gestureEvent.gesture = data;\n    data.target.dispatchEvent(gestureEvent);\n}\n\nassign(Hammer, {\n    INPUT_START: INPUT_START,\n    INPUT_MOVE: INPUT_MOVE,\n    INPUT_END: INPUT_END,\n    INPUT_CANCEL: INPUT_CANCEL,\n\n    STATE_POSSIBLE: STATE_POSSIBLE,\n    STATE_BEGAN: STATE_BEGAN,\n    STATE_CHANGED: STATE_CHANGED,\n    STATE_ENDED: STATE_ENDED,\n    STATE_RECOGNIZED: STATE_RECOGNIZED,\n    STATE_CANCELLED: STATE_CANCELLED,\n    STATE_FAILED: STATE_FAILED,\n\n    DIRECTION_NONE: DIRECTION_NONE,\n    DIRECTION_LEFT: DIRECTION_LEFT,\n    DIRECTION_RIGHT: DIRECTION_RIGHT,\n    DIRECTION_UP: DIRECTION_UP,\n    DIRECTION_DOWN: DIRECTION_DOWN,\n    DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,\n    DIRECTION_VERTICAL: DIRECTION_VERTICAL,\n    DIRECTION_ALL: DIRECTION_ALL,\n\n    Manager: Manager,\n    Input: Input,\n    TouchAction: TouchAction,\n\n    TouchInput: TouchInput,\n    MouseInput: MouseInput,\n    PointerEventInput: PointerEventInput,\n    TouchMouseInput: TouchMouseInput,\n    SingleTouchInput: SingleTouchInput,\n\n    Recognizer: Recognizer,\n    AttrRecognizer: AttrRecognizer,\n    Tap: TapRecognizer,\n    Pan: PanRecognizer,\n    Swipe: SwipeRecognizer,\n    Pinch: PinchRecognizer,\n    Rotate: RotateRecognizer,\n    Press: PressRecognizer,\n\n    on: addEventListeners,\n    off: removeEventListeners,\n    each: each,\n    merge: merge,\n    extend: extend,\n    assign: assign,\n    inherit: inherit,\n    bindFn: bindFn,\n    prefixed: prefixed\n});\n\n// this prevents errors when Hammer is loaded in the presence of an AMD\n//  style loader but by script tag, not by the loader.\nvar freeGlobal = (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : {})); // jshint ignore:line\nfreeGlobal.Hammer = Hammer;\n\nif (typeof define === 'function' && define.amd) {\n    define(function() {\n        return Hammer;\n    });\n} else if (typeof module != 'undefined' && module.exports) {\n    module.exports = Hammer;\n} else {\n    window[exportName] = Hammer;\n}\n\n})(window, document, 'Hammer');\n","/*!\n * Muuri v0.5.4\n * https://github.com/haltu/muuri\n * Copyright (c) 2015, Haltu Oy\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n(function (global, factory) {\n\n  var namespace = 'Muuri';\n  var Hammer;\n\n  if (typeof module === 'object' && module.exports) {\n    /* eslint-disable */\n    try { Hammer = require('hammerjs'); } catch (e) {}\n    /* eslint-enable */\n    module.exports = factory(namespace, Hammer);\n  }\n  else if (typeof define === 'function' && define.amd) {\n    define(['hammerjs'], function (Hammer) {\n      return factory(namespace, Hammer);\n    });\n  }\n  else {\n    global[namespace] = factory(namespace, global.Hammer);\n  }\n\n}(typeof window !== 'undefined' ? window : this, function (namespace, Hammer, undefined) {\n\n  'use strict';\n\n  // Get references to all the stuff we are using from the global scope.\n  var global = window;\n  var Object = global.Object;\n  var Array = global.Array;\n  var Math = global.Math;\n  var Error = global.Error;\n  var Element = global.Element;\n  var doc = global.document;\n  var docElem = doc.documentElement;\n  var body = doc.body;\n\n  // Types.\n  var typeFunction = 'function';\n  var typeString = 'string';\n  var typeNumber = 'number';\n\n  // Raf loop that can be used to organize DOM write and read operations\n  // optimally in the next animation frame.\n  var rafLoop = createRafLoop();\n\n  // Raf loop queue names.\n  var rafQueueLayout = 'layout';\n  var rafQueueVisibility = 'visibility';\n  var rafQueueMove = 'move';\n  var rafQueueScroll = 'scroll';\n\n  // Drag start predicate states.\n  var startPredicateInactive = 0;\n  var startPredicatePending = 1;\n  var startPredicateResolved = 2;\n  var startPredicateRejected = 3;\n\n  // Keep track of Grid instances.\n  var gridInstances = {};\n\n  // Keep track of Item instances.\n  var itemInstances = {};\n\n  // No operation function.\n  var noop = function () {};\n\n  // Unique id which is used for Grid instances and Item instances.\n  // Should be incremented every time when used.\n  var uuid = 0;\n\n  // Get the supported element.matches().\n  var elementMatches = getSupportedElementMatches();\n\n  // Get the supported transform style property.\n  var transform = getSupportedStyle('transform');\n\n  // Test if transformed elements leak fixed elements.\n  var transformLeaksFixed = body ? doesTransformLeakFixed() : null;\n\n  // Event names.\n  var evSynchronize = 'synchronize';\n  var evLayoutStart = 'layoutStart';\n  var evLayoutEnd = 'layoutEnd';\n  var evAdd = 'add';\n  var evRemove = 'remove';\n  var evShowStart = 'showStart';\n  var evShowEnd = 'showEnd';\n  var evHideStart = 'hideStart';\n  var evHideEnd = 'hideEnd';\n  var evFilter = 'filter';\n  var evSort = 'sort';\n  var evMove = 'move';\n  var evSend = 'send';\n  var evBeforeSend = 'beforeSend';\n  var evReceive = 'receive';\n  var evBeforeReceive = 'beforeReceive';\n  var evDragInit = 'dragInit';\n  var evDragStart = 'dragStart';\n  var evDragMove = 'dragMove';\n  var evDragScroll = 'dragScroll';\n  var evDragEnd = 'dragEnd';\n  var evDragReleaseStart = 'dragReleaseStart';\n  var evDragReleaseEnd = 'dragReleaseEnd';\n  var evDestroy = 'destroy';\n\n  /**\n   * Grid\n   * ****\n   */\n\n  /**\n   * Creates a new Grid instance.\n   *\n   * @public\n   * @class\n   * @param {(HTMLElement|String)} element\n   * @param {Object} [options]\n   * @param {(?HTMLElement[]|NodeList|String)} [options.items]\n   * @param {Number} [options.showDuration=300]\n   * @param {String} [options.showEasing=\"ease\"]\n   * @param {Object} [options.visibleStyles]\n   * @param {Number} [options.hideDuration=300]\n   * @param {String} [options.hideEasing=\"ease\"]\n   * @param {Object} [options.hiddenStyles]\n   * @param {(Function|Object)} [options.layout]\n   * @param {Boolean} [options.layout.fillGaps=false]\n   * @param {Boolean} [options.layout.horizontal=false]\n   * @param {Boolean} [options.layout.alignRight=false]\n   * @param {Boolean} [options.layout.alignBottom=false]\n   * @param {Boolean} [options.layout.rounding=true]\n   * @param {(Boolean|Number)} [options.layoutOnResize=100]\n   * @param {Boolean} [options.layoutOnInit=true]\n   * @param {Number} [options.layoutDuration=300]\n   * @param {String} [options.layoutEasing=\"ease\"]\n   * @param {?Object} [options.sortData=null]\n   * @param {Boolean} [options.dragEnabled=false]\n   * @param {?HtmlElement} [options.dragContainer=null]\n   * @param {?Function} [options.dragStartPredicate]\n   * @param {Number} [options.dragStartPredicate.distance=0]\n   * @param {Number} [options.dragStartPredicate.delay=0]\n   * @param {(Boolean|String)} [options.dragStartPredicate.handle=false]\n   * @param {?String} [options.dragAxis]\n   * @param {(Boolean|Function)} [options.dragSort=true]\n   * @param {Number} [options.dragSortInterval=100]\n   * @param {(Function|Object)} [options.dragSortPredicate]\n   * @param {Number} [options.dragSortPredicate.threshold=50]\n   * @param {String} [options.dragSortPredicate.action=\"move\"]\n   * @param {Number} [options.dragReleaseDuration=300]\n   * @param {String} [options.dragReleaseEasing=\"ease\"]\n   * @param {Object} [options.dragHammerSettings={touchAction: \"none\"}]\n   * @param {String} [options.containerClass=\"muuri\"]\n   * @param {String} [options.itemClass=\"muuri-item\"]\n   * @param {String} [options.itemVisibleClass=\"muuri-item-visible\"]\n   * @param {String} [options.itemHiddenClass=\"muuri-item-hidden\"]\n   * @param {String} [options.itemPositioningClass=\"muuri-item-positioning\"]\n   * @param {String} [options.itemDraggingClass=\"muuri-item-dragging\"]\n   * @param {String} [options.itemReleasingClass=\"muuri-item-releasing\"]\n   */\n  function Grid(element, options) {\n\n    var inst = this;\n    var settings;\n    var items;\n    var layoutOnResize;\n\n    // Muuri can be loaded inside the head tag also, but in that case Muuri can\n    // not cache body element and run the initial DOM tests. So, if we detect\n    // that body element could not be fetched on init we do it here once and\n    // also run the DOM tests. If the Grid is instantiated before body is ready\n    // you are doing it wrong ;)\n    if (!body) {\n      body = document.body;\n      transformLeaksFixed = doesTransformLeakFixed();\n    }\n\n    // Allow passing element as selector string. Store element for instance.\n    element = inst._element = typeof element === typeString ? doc.querySelector(element) : element;\n\n    // Throw an error if the container element is not body element or does not\n    // exist within the body element.\n    if (!body.contains(element)) {\n      throw new Error('Container element must be an existing DOM element');\n    }\n\n    // Create instance settings by merging the options with default options.\n    settings = inst._settings = mergeSettings(Grid.defaultOptions, options);\n\n    // Sanitize dragSort setting.\n    if (typeof settings.dragSort !== typeFunction) {\n      settings.dragSort = !!settings.dragSort;\n    }\n\n    // Create instance id and store it to the grid instances collection.\n    gridInstances[inst._id = ++uuid] = inst;\n\n    // Destroyed flag.\n    inst._isDestroyed = false;\n\n    // Reference to the currently used Layout instance.\n    inst._layout = null;\n\n    // Create private Emitter instance.\n    inst._emitter = new Grid.Emitter();\n\n    // Setup grid's show/hide animation handler for items.\n    inst._itemShowHandler = getItemVisibilityHandler('show', settings);\n    inst._itemHideHandler = getItemVisibilityHandler('hide', settings);\n\n    // Add container element's class name.\n    addClass(element, settings.containerClass);\n\n    // Create initial items.\n    inst._items = [];\n    items = settings.items;\n    if (typeof items === typeString) {\n      nodeListToArray(inst._element.children).forEach(function (itemElement) {\n        if (items === '*' || elementMatches(itemElement, items)) {\n          inst._items.push(new Grid.Item(inst, itemElement));\n        }\n      });\n    }\n    else if (Array.isArray(items) || isNodeList(items)) {\n      inst._items = nodeListToArray(items).map(function (itemElement) {\n        return new Grid.Item(inst, itemElement);\n      });\n    }\n\n    // Sanitize layoutOnResize option and bind debounced resize handler if the\n    // layoutOnResize option a valid number.\n    layoutOnResize = settings.layoutOnResize;\n    layoutOnResize = layoutOnResize === true ? 0 : typeof layoutOnResize === typeNumber ? layoutOnResize : -1;\n    if (layoutOnResize >= 0) {\n      global.addEventListener('resize', inst._resizeHandler = debounce(function () {\n        inst.refreshItems().layout();\n      }, layoutOnResize));\n    }\n\n    // Layout on init if necessary.\n    if (settings.layoutOnInit) {\n      inst.layout(true);\n    }\n\n  }\n\n  /**\n   * Grid - Public properties\n   * ************************\n   */\n\n  /**\n   * @see Item\n   */\n  Grid.Item = Item;\n\n  /**\n   * @see ItemDrag\n   */\n  Grid.ItemDrag = ItemDrag;\n\n  /**\n   * @see ItemRelease\n   */\n  Grid.ItemRelease = ItemRelease;\n\n  /**\n   * @see ItemMigrate\n   */\n  Grid.ItemMigrate = ItemMigrate;\n\n  /**\n   * @see ItemAnimate\n   */\n  Grid.ItemAnimate = ItemAnimate;\n\n  /**\n   * @see Layout\n   */\n  Grid.Layout = Layout;\n\n  /**\n   * @see Emitter\n   */\n  Grid.Emitter = Emitter;\n\n  /**\n   * Default options for Grid instance.\n   *\n   * @public\n   * @memberof Grid\n   */\n  Grid.defaultOptions = {\n\n    // Item elements\n    items: '*',\n\n    // Default show animation\n    showDuration: 300,\n    showEasing: 'ease',\n\n    // Default hide animation\n    hideDuration: 300,\n    hideEasing: 'ease',\n\n    // Item's visible/hidden state styles\n    visibleStyles: {\n      opacity: '1',\n      transform: 'scale(1)'\n    },\n    hiddenStyles: {\n      opacity: '0',\n      transform: 'scale(0.5)'\n    },\n\n    // Layout\n    layout: {\n      fillGaps: false,\n      horizontal: false,\n      alignRight: false,\n      alignBottom: false,\n      rounding: true\n    },\n    layoutOnResize: 100,\n    layoutOnInit: true,\n    layoutDuration: 300,\n    layoutEasing: 'ease',\n\n    // Sorting\n    sortData: null,\n\n    // Drag & Drop\n    dragEnabled: false,\n    dragContainer: null,\n    dragStartPredicate: {\n      distance: 0,\n      delay: 0,\n      handle: false\n    },\n    dragAxis: null,\n    dragSort: true,\n    dragSortInterval: 100,\n    dragSortPredicate: {\n      threshold: 50,\n      action: 'move'\n    },\n    dragReleaseDuration: 300,\n    dragReleaseEasing: 'ease',\n    dragHammerSettings: {\n      touchAction: 'none'\n    },\n\n    // Classnames\n    containerClass: 'muuri',\n    itemClass: 'muuri-item',\n    itemVisibleClass: 'muuri-item-shown',\n    itemHiddenClass: 'muuri-item-hidden',\n    itemPositioningClass: 'muuri-item-positioning',\n    itemDraggingClass: 'muuri-item-dragging',\n    itemReleasingClass: 'muuri-item-releasing'\n\n  };\n\n  /**\n   * Grid - Private properties\n   * *************************\n   */\n\n  Grid._maxRafBatchSize = 100;\n\n  /**\n   * Grid - Public prototype methods\n   * *******************************\n   */\n\n  /**\n   * Bind an event listener.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {String} event\n   * @param {Function} listener\n   * @returns {Grid}\n   */\n  Grid.prototype.on = function (event, listener) {\n\n    var inst = this;\n\n    if (!inst._isDestroyed) {\n      inst._emitter.on(event, listener);\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Bind an event listener that is triggered only once.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {String} event\n   * @param {Function} listener\n   * @returns {Grid}\n   */\n  Grid.prototype.once = function (event, listener) {\n\n    var inst = this;\n\n    if (!inst._isDestroyed) {\n      inst._emitter.once(event, listener);\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Unbind an event listener.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {String} event\n   * @param {Function} listener\n   * @returns {Grid}\n   */\n  Grid.prototype.off = function (event, listener) {\n\n    var inst = this;\n\n    if (!inst._isDestroyed) {\n      inst._emitter.off(event, listener);\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Get the container element.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @returns {HTMLElement}\n   */\n  Grid.prototype.getElement = function () {\n\n    return this._element;\n\n  };\n\n  /**\n   * Get all items. Optionally you can provide specific targets (elements and\n   * indices) and filter the results based on the state of the items. Note that\n   * the returned array is not the same object used by the instance so modifying\n   * it will not affect instance's items. All items that are not found are\n   * omitted from the returned array.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {GridMultiItemQuery} [targets]\n   * @param {GridItemState} [state]\n   * @returns {Item[]}\n   */\n  Grid.prototype.getItems = function (targets, state) {\n\n    var inst = this;\n\n    // Return an empty array immediately if the instance is destroyed.\n    if (inst._isDestroyed) {\n      return [];\n    }\n\n    var hasTargets = targets === 0 || (targets && typeof targets !== typeString);\n    var targetItems = !hasTargets ? null : isNodeList(targets) ? nodeListToArray(targets) : [].concat(targets);\n    var targetState = !hasTargets ? targets : state;\n    var ret = [];\n    var item;\n    var i;\n\n    // Sanitize target state.\n    targetState = typeof targetState === typeString ? targetState : null;\n\n    // If target state or target items are defined return filtered results.\n    if (targetState || targetItems) {\n      targetItems = targetItems || inst._items;\n      for (i = 0; i < targetItems.length; i++) {\n        item = hasTargets ? inst._getItem(targetItems[i]) : targetItems[i];\n        if (item && (!targetState || isItemInState(item, targetState))) {\n          ret.push(item);\n        }\n      }\n      return ret;\n    }\n\n    // Otherwise return all items.\n    else {\n      return ret.concat(inst._items);\n    }\n\n  };\n\n  /**\n   * Update the cached dimensions of the instance's items.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {(GridMultiItemQuery|GridItemState)} [items]\n   * @returns {Grid}\n   */\n  Grid.prototype.refreshItems = function (items) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var targetItems = inst.getItems(items || 'active');\n    var i;\n\n    for (i = 0; i < targetItems.length; i++) {\n      targetItems[i]._refreshDimensions();\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Update the sort data of the instance's items.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {(GridMultiItemQuery|GridItemState)} [items]\n   * @returns {Grid}\n   */\n  Grid.prototype.refreshSortData = function (items) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var targetItems = inst.getItems(items);\n    var i;\n\n    for (i = 0; i < targetItems.length; i++) {\n      targetItems[i]._refreshSortData();\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Synchronize the item elements to match the order of the items in the DOM.\n   * This comes handy if you need to keep the DOM structure matched with the\n   * order of the items. Note that if an item's element is not currently a child\n   * of the container element (if it is dragged for example) it is ignored and\n   * left untouched.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @returns {Grid}\n   */\n  Grid.prototype.synchronize = function () {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var container = inst._element;\n    var items = inst._items;\n    var fragment;\n    var element;\n    var i;\n\n    // Append all elements in order to the container element.\n    if (items.length) {\n      for (i = 0; i < items.length; i++) {\n        element = items[i]._element;\n        if (element.parentNode === container) {\n          fragment = fragment || doc.createDocumentFragment();\n          fragment.appendChild(element);\n        }\n      }\n      if (fragment) {\n        container.appendChild(fragment);\n      }\n    }\n\n    // Emit synchronize event.\n    inst._emit(evSynchronize);\n\n    return inst;\n\n  };\n\n  /**\n   * Calculate and apply item positions.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {Boolean} [instant=false]\n   * @param {LayoutCallback} [onFinish]\n   * @returns {Grid}\n   */\n  Grid.prototype.layout = function (instant, onFinish) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var callback = typeof instant === typeFunction ? instant : onFinish;\n    var isInstant = instant === true;\n    var items = inst.getItems('active');\n    var layout = inst._layout = new Grid.Layout(inst, items);\n    var counter = items.length;\n    var isBorderBox;\n    var containerStyles;\n    var item;\n    var position;\n    var i;\n\n    // The finish function, which will be used for checking if all the items\n    // have laid out yet. After all items have finished their animations call\n    // callback and emit layoutEnd event. Only emit layoutEnd event if there\n    // hasn't been a new layout call during this layout.\n    function tryFinish() {\n      if (--counter <= 0) {\n        if (typeof callback === typeFunction) {\n          callback(inst._layout !== layout, items.concat());\n        }\n        if (inst._layout === layout) {\n          inst._emit(evLayoutEnd, items.concat());\n        }\n      }\n    }\n\n    // If grid's width or height was modified, we need to update it's cached\n    // dimensions. Also keep in mind that grid's cached width/height should\n    // always equal to what elem.getBoundingClientRect() would return, so\n    // therefore we need to add the grid element's borders to the dimensions if\n    // it's box-sizing is border-box.\n    if (layout.setWidth || layout.setHeight) {\n\n      containerStyles = {};\n      isBorderBox = getStyle(inst._element, 'box-sizing') === 'border-box';\n\n      if (layout.setHeight) {\n        if (typeof layout.height === typeNumber) {\n          containerStyles.height = (isBorderBox ? layout.height + inst._border.top + inst._border.bottom : layout.height) + 'px';\n        }\n        else {\n          containerStyles.height = layout.height;\n        }\n      }\n\n      if (layout.setWidth) {\n        if (typeof layout.width === typeNumber) {\n          containerStyles.width = (isBorderBox ? layout.width + inst._border.left + inst._border.right : layout.width) + 'px';\n        }\n        else {\n          containerStyles.width = layout.width;\n        }\n      }\n\n      setStyles(inst._element, containerStyles);\n\n    }\n\n    // Emit layoutStart event. Note that this is intentionally emitted after the\n    // container element's dimensions are set, because otherwise there would be\n    // no hook for reacting to container dimension changes.\n    inst._emit(evLayoutStart, items.concat());\n\n    // If there are no items let's finish quickly.\n    if (!items.length) {\n      tryFinish();\n      return inst;\n    }\n\n    // If there are items let's position them.\n    for (i = 0; i < items.length; i++) {\n\n      item = items[i];\n      position = layout.slots[item._id];\n\n      // Update item's position.\n      item._left = position.left;\n      item._top = position.top;\n\n      // Layout non-dragged items.\n      if (item.isDragging()) {\n        tryFinish(true, item);\n      }\n      else {\n        item._layout(isInstant, tryFinish);\n      }\n\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Add new items by providing the elements you wish to add to the instance and\n   * optionally provide the index where you want the items to be inserted into.\n   * All elements that are not already children of the container element will be\n   * automatically appended to the container element. If an element has it's CSS\n   * display property set to \"none\" it will be marked as inactive during the\n   * initiation process. As long as the item is inactive it will not be part of\n   * the layout, but it will retain it's index. You can activate items at any\n   * point with grid.show() method. This method will automatically call\n   * grid.layout() if one or more of the added elements are visible. If only\n   * hidden items are added no layout will be called. All the new visible items\n   * are positioned without animation during their first layout.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {(HTMLElement|HTMLElement[])} elements\n   * @param {Object} [options]\n   * @param {Number} [options.index=-1]\n   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]\n   * @returns {Item[]}\n   */\n  Grid.prototype.add = function (elements, options) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return [];\n    }\n\n    var targetElements = isNodeList(elements) ? nodeListToArray(elements) : [].concat(elements);\n    var newItems = [];\n\n    // Return early if there are no items.\n    if (!targetElements.length) {\n      return newItems;\n    }\n\n    var opts = options || {};\n    var layout = opts.layout ? opts.layout : opts.layout === undefined;\n    var items = inst._items;\n    var needsLayout = false;\n    var elementIndex;\n    var item;\n    var i;\n\n    // Filter out all elements that exist already in current instance.\n    // TODO: This filtering can be made a lot faster by storing item elements\n    // in a Map or WeakMap. Other option would be to transfer the reponsibility\n    // completely to the user and get rid of this sanity check.\n    for (i = 0; i < items.length; i++) {\n      elementIndex = targetElements.indexOf(items[i]._element);\n      if (elementIndex > -1) {\n        targetElements.splice(elementIndex, 1);\n        if (!targetElements.length) {\n          return newItems;\n        }\n      }\n    }\n\n    // Create new items.\n    for (i = 0; i < targetElements.length; i++) {\n\n      item = new Grid.Item(inst, targetElements[i]);\n      newItems.push(item);\n\n      // If the item to be added is active, we need to do a layout. Also, we\n      // need to mark the item with the skipNextLayoutAnimation flag to make it\n      // position instantly (without animation) during the next layout. Without\n      // the hack the item would animate to it's new position from the northwest\n      // corner of the grid, which feels a bit buggy (imho).\n      if (item._isActive) {\n        needsLayout = true;\n        item._skipNextLayoutAnimation = true;\n      }\n\n    }\n\n    // Add the new items to the items collection to correct index.\n    insertItemsToArray(items, newItems, opts.index);\n\n    // Emit add event.\n    inst._emit(evAdd, newItems.concat());\n\n    // If layout is needed.\n    if (needsLayout && layout) {\n      inst.layout(layout === 'instant', typeof layout === typeFunction ? layout : undefined);\n    }\n\n    // Return new items.\n    return newItems;\n\n  };\n\n  /**\n   * Remove items from the instance.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {(GridMultiItemQuery|GridItemState)} items\n   * @param {Object} [options]\n   * @param {Boolean} [options.removeElements=false]\n   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]\n   * @returns {Item[]}\n   */\n  Grid.prototype.remove = function (items, options) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var opts = options || {};\n    var layout = opts.layout ? opts.layout : opts.layout === undefined;\n    var needsLayout = false;\n    var allItems = inst.getItems();\n    var targetItems = inst.getItems(items);\n    var indices = [];\n    var item;\n    var i;\n\n    // Remove the individual items.\n    for (i = 0; i < targetItems.length; i++) {\n      item = targetItems[i];\n      indices.push(allItems.indexOf(item));\n      if (item._isActive) {\n        needsLayout = true;\n      }\n      item._destroy(opts.removeElements);\n    }\n\n    // Emit remove event.\n    inst._emit(evRemove, targetItems.concat(), indices);\n\n    // If layout is needed.\n    if (needsLayout && layout) {\n      inst.layout(layout === 'instant', typeof layout === typeFunction ? layout : undefined);\n    }\n\n    return targetItems;\n\n  };\n\n  /**\n   * Show instance items.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {(GridMultiItemQuery|GridItemState)} items\n   * @param {Object} [options]\n   * @param {Boolean} [options.instant=false]\n   * @param {ShowCallback} [options.onFinish]\n   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]\n   * @returns {Grid}\n   */\n  Grid.prototype.show = function (items, options) {\n\n    return this._isDestroyed ? this : gridShowHideHandler(this, 'show', items, options);\n\n  };\n\n  /**\n   * Hide instance items.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {(GridMultiItemQuery|GridItemState)} items\n   * @param {Object} [options]\n   * @param {Boolean} [options.instant=false]\n   * @param {HideCallback} [options.onFinish]\n   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]\n   * @returns {Grid}\n   */\n  Grid.prototype.hide = function (items, options) {\n\n    return this._isDestroyed ? this : gridShowHideHandler(this, 'hide', items, options);\n\n  };\n\n  /**\n   * Filter items. Expects at least one argument, a predicate, which should be\n   * either a function or a string. The predicate callback is executed for every\n   * item in the instance. If the return value of the predicate is truthy the\n   * item in question will be shown and otherwise hidden. The predicate callback\n   * receives the item instance as it's argument. If the predicate is a string\n   * it is considered to be a selector and it is checked against every item\n   * element in the instance with the native element.matches() method. All the\n   * matching items will be shown and others hidden.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {(Function|String)} predicate\n   * @param {Object} [options]\n   * @param {Boolean} [options.instant=false]\n   * @param {FilterCallback} [options.onFinish]\n   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]\n   * @returns {Grid}\n   */\n  Grid.prototype.filter = function (predicate, options) {\n\n    var inst = this;\n\n    // Return immediately if there are no items or if the instance id destroyed.\n    if (inst._isDestroyed || !inst._items.length) {\n      return inst;\n    }\n\n    var items = inst._items;\n    var predicateType = typeof predicate;\n    var isPredicateString = predicateType === typeString;\n    var isPredicateFn = predicateType === typeFunction;\n    var opts = options || {};\n    var isInstant = opts.instant === true;\n    var layout = opts.layout ? opts.layout : opts.layout === undefined;\n    var onFinish = typeof opts.onFinish === typeFunction ? opts.onFinish : null;\n    var itemsToShow = [];\n    var itemsToHide = [];\n    var tryFinishCounter = -1;\n    var tryFinish = !onFinish ? noop : function () {\n      ++tryFinishCounter && onFinish(itemsToShow.concat(), itemsToHide.concat());\n    };\n    var item;\n    var i;\n\n    // Check which items need to be shown and which hidden.\n    if (isPredicateFn || isPredicateString) {\n      for (i = 0; i < items.length; i++) {\n        item = items[i];\n        if (isPredicateFn ? predicate(item) : elementMatches(item._element, predicate)) {\n          itemsToShow.push(item);\n        }\n        else {\n          itemsToHide.push(item);\n        }\n      }\n    }\n\n    // Show items that need to be shown.\n    if (itemsToShow.length) {\n      inst.show(itemsToShow, {\n        instant: isInstant,\n        onFinish: tryFinish,\n        layout: false\n      });\n    }\n    else {\n      tryFinish();\n    }\n\n    // Hide items that need to be hidden.\n    if (itemsToHide.length) {\n      inst.hide(itemsToHide, {\n        instant: isInstant,\n        onFinish: tryFinish,\n        layout: false\n      });\n    }\n    else {\n      tryFinish();\n    }\n\n    // If there are any items to filter.\n    if (itemsToShow.length || itemsToHide.length) {\n\n      // Emit filter event.\n      inst._emit(evFilter, itemsToShow.concat(), itemsToHide.concat());\n\n      // If layout is needed.\n      if (layout) {\n        inst.layout(layout === 'instant', typeof layout === typeFunction ? layout : undefined);\n      }\n\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Sort items. There are three ways to sort the items. The first is simply by\n   * providing a function as the comparer which works identically to native\n   * array sort. Alternatively you can sort by the sort data you have provided\n   * in the instance's options. Just provide the sort data key(s) as a string\n   * (separated by space) and the items will be sorted based on the provided\n   * sort data keys. Lastly you have the opportunity to provide a presorted\n   * array of items which will be used to sync the internal items array in the\n   * same order.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {(Function|Item[]|String|String[])} comparer\n   * @param {Object} [options]\n   * @param {Boolean} [options.descending=false]\n   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]\n   * @returns {Grid}\n   */\n  Grid.prototype.sort = function (comparer, options) {\n\n    var inst = this;\n\n    // Let's not sort if it has no effect.\n    if (inst._isDestroyed || inst._items.length < 2) {\n      return inst;\n    }\n\n    var items = inst._items;\n    var opts = options || {};\n    var isDescending = !!opts.descending;\n    var layout = opts.layout ? opts.layout : opts.layout === undefined;\n    var origItems = items.concat();\n    var indexMap;\n\n    // If function is provided do a native array sort.\n    if (typeof comparer === typeFunction) {\n      items.sort(function (a, b) {\n        var result = comparer(a, b);\n        return (isDescending && result !== 0 ? -result : result) || compareItemIndices(a, b, isDescending, indexMap || (indexMap = getItemIndexMap(origItems)));\n      });\n    }\n\n    // Otherwise if we got a string, let's sort by the sort data as provided in\n    // the instance's options.\n    else if (typeof comparer === typeString) {\n      comparer = comparer.trim().split(' ').map(function (val) {\n        return val.split(':');\n      });\n      items.sort(function (a, b) {\n        return compareItems(a, b, isDescending, comparer) || compareItemIndices(a, b, isDescending, indexMap || (indexMap = getItemIndexMap(origItems)));\n      });\n    }\n\n    // Otherwise if we got an array, let's assume it's a presorted array of the\n    // items and order the items based on it.\n    else if (Array.isArray(comparer)) {\n      sortItemsByReference(items, comparer);\n      if (isDescending) {\n        items.reverse();\n      }\n    }\n\n    // Otherwise, let's go home.\n    else {\n      return inst;\n    }\n\n    // Emit sort event.\n    inst._emit(evSort, items.concat(), origItems);\n\n    // If layout is needed.\n    if (layout) {\n      inst.layout(layout === 'instant', typeof layout === typeFunction ? layout : undefined);\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Move item to another index or in place of another item.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {GridSingleItemQuery} item\n   * @param {GridSingleItemQuery} position\n   * @param {Object} [options]\n   * @param {String} [options.action=\"move\"]\n   *   - Accepts either \"move\" or \"swap\".\n   *   - \"move\" moves the item in place of the other item.\n   *   - \"swap\" swaps the position of the items.\n   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]\n   * @returns {Grid}\n   */\n  Grid.prototype.move = function (item, position, options) {\n\n    var inst = this;\n\n    // Return immediately, if moving an item is not possible.\n    if (inst._isDestroyed || inst._items.length < 2) {\n      return inst;\n    }\n\n    var items = inst._items;\n    var opts = options || {};\n    var layout = opts.layout ? opts.layout : opts.layout === undefined;\n    var isSwap = opts.action === 'swap';\n    var action = isSwap ? 'swap' : 'move';\n    var fromItem = inst._getItem(item);\n    var toItem = inst._getItem(position);\n    var fromIndex;\n    var toIndex;\n\n    // Make sure the items exist and are not the same.\n    if (fromItem && toItem && (fromItem !== toItem)) {\n\n      // Get the indices of the items.\n      fromIndex = items.indexOf(fromItem);\n      toIndex = items.indexOf(toItem);\n\n      // Do the move/swap.\n      (isSwap ? arraySwap : arrayMove)(items, fromIndex, toIndex);\n\n      // Emit move event.\n      inst._emit(evMove, {\n        item: fromItem,\n        fromIndex: fromIndex,\n        toIndex: toIndex,\n        action: action\n      });\n\n      // If layout is needed.\n      if (layout) {\n        inst.layout(layout === 'instant', typeof layout === typeFunction ? layout : undefined);\n      }\n\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Send item to another Grid instance.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {GridSingleItemQuery} item\n   * @param {Grid} grid\n   * @param {GridSingleItemQuery} position\n   * @param {Object} [options]\n   * @param {HTMLElement} [options.appendTo=document.body]\n   * @param {(Boolean|LayoutCallback|String)} [options.layoutSender=true]\n   * @param {(Boolean|LayoutCallback|String)} [options.layoutReceiver=true]\n   * @returns {Grid}\n   */\n  Grid.prototype.send = function (item, grid, position, options) {\n\n    var currentGrid = this;\n\n    // Return immediately if either grid is destroyed or if the grids are the\n    // same, or if target item was not found.\n    if (currentGrid._isDestroyed || grid._isDestroyed || currentGrid === grid || !(item = currentGrid._getItem(item))) {\n      return currentGrid;\n    }\n\n    var targetGrid = grid;\n    var opts = options || {};\n    var container = opts.appendTo || body;\n    var layoutSender = opts.layoutSender ? opts.layoutSender : opts.layoutSender === undefined;\n    var layoutReceiver = opts.layoutReceiver ? opts.layoutReceiver : opts.layoutReceiver === undefined;\n\n    // Start the migration process.\n    item._migrate.start(targetGrid, position, container);\n\n    // If migration was started succesfully and the item is active, let's layout\n    // the grids.\n    if (item._migrate.isActive && item.isActive()) {\n      if (layoutSender) {\n        currentGrid.layout(layoutSender === 'instant', typeof layoutSender === typeFunction ? layoutSender : undefined);\n      }\n      if (layoutReceiver) {\n        targetGrid.layout(layoutReceiver === 'instant', typeof layoutReceiver === typeFunction ? layoutReceiver : undefined);\n      }\n    }\n\n    return currentGrid;\n\n  };\n\n  /**\n   * Destroy the instance.\n   *\n   * @public\n   * @memberof Grid.prototype\n   * @param {Boolean} [removeElements=false]\n   * @returns {Grid}\n   */\n  Grid.prototype.destroy = function (removeElements) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var container = inst._element;\n    var items = inst._items.concat();\n    var i;\n\n    // Unbind window resize event listener.\n    if (inst._resizeHandler) {\n      global.removeEventListener('resize', inst._resizeHandler);\n    }\n\n    // Destroy items.\n    for (i = 0; i < items.length; i++) {\n      items[i]._destroy(removeElements);\n    }\n\n    // Restore container.\n    removeClass(container, inst._settings.containerClass);\n    setStyles(container, {height: ''});\n\n    // Emit destroy event and unbind all events.\n    inst._emit(evDestroy);\n    inst._emitter.destroy();\n\n    // Remove reference from the grid instances collection.\n    gridInstances[inst._id] = undefined;\n\n    // Flag instance as destroyed.\n    inst._isDestroyed = true;\n\n    return inst;\n\n  };\n\n  /**\n   * Grid - Protected prototype methods\n   * **********************************\n   */\n\n  /**\n   * Get instance's item by element or by index. Target can also be an Item\n   * instance in which case the function returns the item if it exists within\n   * related Grid instance. If nothing is found with the provided target, null\n   * is returned.\n   *\n   * @protected\n   * @memberof Grid.prototype\n   * @param {GridSingleItemQuery} [target=0]\n   * @returns {?Item}\n   */\n  Grid.prototype._getItem = function (target) {\n\n    var inst = this;\n    var items = inst._items;\n    var i;\n\n    // If no target is specified or the instance is destroyed, return the first\n    // item or null.\n    if (inst._isDestroyed || !target) {\n      return items[0] || null;\n    }\n\n    // If target is number return the item in that index. If the number is lower\n    // than zero look for the item starting from the end of the items array. For\n    // example -1 for the last item, -2 for the second last item, etc.\n    else if (typeof target === typeNumber) {\n      return items[target > -1 ? target : items.length + target] || null;\n    }\n\n    // If the target is an instance of Item return it if it is attached to this\n    // Grid instance, otherwise return null.\n    else if (target instanceof Item) {\n      return target._gridId === inst._id ? target : null;\n    }\n\n    // In other cases let's assume that the target is an element, so let's try\n    // to find an item that matches the element and return it. If item is not\n    // found return null.\n    else {\n      // TODO: This could be made a lot faster by using WeakMap or Map.\n      for (i = 0; i < items.length; i++) {\n        if (items[i]._element === target) {\n          return items[i];\n        }\n      }\n      return null;\n    }\n\n  };\n\n  /**\n   * Bind an event listener.\n   *\n   * @protected\n   * @memberof Grid.prototype\n   * @param {String} event\n   * @param {*} [arg1]\n   * @param {*} [arg2]\n   * @param {*} [arg3]\n   * @returns {Grid}\n   */\n  Grid.prototype._emit = function () {\n\n    var inst = this;\n\n    if (!inst._isDestroyed) {\n      inst._emitter.emit.apply(inst._emitter, arguments);\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Refresh container's internal dimensions.\n   *\n   * @private\n   * @memberof Grid.prototype\n   * @returns {Grid}\n   */\n  Grid.prototype._refreshDimensions = function () {\n\n    var inst = this;\n    var element = inst._element;\n    var rect = element.getBoundingClientRect();\n    var sides = ['left', 'right', 'top', 'bottom'];\n    var i;\n\n    inst._width = rect.width;\n    inst._height = rect.height;\n    inst._left = rect.left;\n    inst._top = rect.top;\n    inst._border = {};\n\n    for (i = 0; i < sides.length; i++) {\n      inst._border[sides[i]] = getStyleAsFloat(element, 'border-' + sides[i] + '-width');\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Item\n   * ****\n   */\n\n  /**\n   * Creates a new Item instance for a Grid instance.\n   *\n   * @public\n   * @class\n   * @param {Grid} grid\n   * @param {HTMLElement} element\n   */\n  function Item(grid, element) {\n\n    var inst = this;\n    var settings = grid._settings;\n    var isHidden;\n\n    // Create instance id and add item to the itemInstances collection.\n    inst._id = ++uuid;\n    itemInstances[inst._id] = inst;\n\n    // Destroyed flag.\n    inst._isDestroyed = false;\n\n    // If the provided item element is not a direct child of the grid container\n    // element, append it to the grid container.\n    if (element.parentNode !== grid._element) {\n      grid._element.appendChild(element);\n    }\n\n    // Set item class.\n    addClass(element, settings.itemClass);\n\n    // Check if the element is hidden.\n    isHidden = getStyle(element, 'display') === 'none';\n\n    // Set visible/hidden class.\n    addClass(element, isHidden ? settings.itemHiddenClass : settings.itemVisibleClass);\n\n    // Refrence to connected Grid instance's id.\n    inst._gridId = grid._id;\n\n    // The elements.\n    inst._element = element;\n    inst._child = element.children[0];\n\n    // Initiate item's animation controllers.\n    inst._animate = new Grid.ItemAnimate(inst, element);\n    inst._animateChild = new Grid.ItemAnimate(inst, inst._child);\n\n    // Set up active state (defines if the item is considered part of the layout\n    // or not).\n    inst._isActive = isHidden ? false : true;\n\n    // Set up positioning state (defines if the item is currently animating\n    // it's position).\n    inst._isPositioning = false;\n\n    // Set up visibility states.\n    inst._isHidden = isHidden;\n    inst._isHiding = false;\n    inst._isShowing = false;\n\n    // Visibility animation callback queue. Whenever a callback is provided for\n    // show/hide methods and animation is enabled the callback is stored\n    // temporarily to this array. The callbacks are called with the first\n    // argument as false if the animation succeeded without interruptions and\n    // with the first argument as true if the animation was interrupted.\n    inst._visibilityQueue = [];\n\n    // Layout animation callback queue. Whenever a callback is provided for\n    // layout method and animation is enabled the callback is stored temporarily\n    // to this array. The callbacks are called with the first argument as false\n    // if the animation succeeded without interruptions and with the first\n    // argument as true if the animation was interrupted.\n    inst._layoutQueue = [];\n\n    // Set up initial positions.\n    inst._left = 0;\n    inst._top = 0;\n\n    // Set element's initial styles.\n    setStyles(element, {\n      left: '0',\n      top: '0',\n      transform: getTranslateString(0, 0),\n      display: isHidden ? 'none' : 'block'\n    });\n\n    // Set up the initial dimensions and sort data.\n    inst._refreshDimensions()._refreshSortData();\n\n    // Set initial styles for the child element.\n    if (isHidden) {\n      grid._itemHideHandler.start(inst, true);\n    }\n    else {\n      grid._itemShowHandler.start(inst, true);\n    }\n\n    // Set up migration handler data.\n    inst._migrate = new Grid.ItemMigrate(inst);\n\n    // Set up release handler\n    inst._release = new Grid.ItemRelease(inst);\n\n    // Set up drag handler.\n    inst._drag = settings.dragEnabled ? new Grid.ItemDrag(inst) : null;\n\n  }\n\n  /**\n   * Item - Public prototype methods\n   * *******************************\n   */\n\n  /**\n   * Get the instance grid reference.\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Grid}\n   */\n  Item.prototype.getGrid = function () {\n\n    return gridInstances[this._gridId];\n\n  };\n\n  /**\n   * Get the instance element.\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {HTMLElement}\n   */\n  Item.prototype.getElement = function () {\n\n    return this._element;\n\n  };\n\n  /**\n   * Get instance element's cached width.\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Number}\n   */\n  Item.prototype.getWidth = function () {\n\n    return this._width;\n\n  };\n\n  /**\n   * Get instance element's cached height.\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Number}\n   */\n  Item.prototype.getHeight = function () {\n\n    return this._height;\n\n  };\n\n  /**\n   * Get instance element's cached margins.\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Object}\n   *   - The returned object contains left, right, top and bottom properties\n   *     which indicate the item element's cached margins.\n   */\n  Item.prototype.getMargin = function () {\n\n    return {\n      left: this._margin.left,\n      right: this._margin.right,\n      top: this._margin.top,\n      bottom: this._margin.bottom\n    };\n\n  };\n\n  /**\n   * Get instance element's cached position.\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Object}\n   *   - The returned object contains left and top properties which indicate the\n   *     item element's cached position in the grid.\n   */\n  Item.prototype.getPosition = function () {\n\n    return {\n      left: this._left,\n      top: this._top\n    };\n\n  };\n\n  /**\n   * Is the item active?\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Boolean}\n   */\n  Item.prototype.isActive = function () {\n\n    return this._isActive;\n\n  };\n\n  /**\n   * Is the item visible?\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Boolean}\n   */\n  Item.prototype.isVisible = function () {\n\n    return !this._isHidden;\n\n  };\n\n  /**\n   * Is the item being animated to visible?\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Boolean}\n   */\n  Item.prototype.isShowing = function () {\n\n    return this._isShowing;\n\n  };\n\n  /**\n   * Is the item being animated to hidden?\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Boolean}\n   */\n  Item.prototype.isHiding = function () {\n\n    return this._isHiding;\n\n  };\n\n  /**\n   * Is the item positioning?\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Boolean}\n   */\n  Item.prototype.isPositioning = function () {\n\n    return this._isPositioning;\n\n  };\n\n  /**\n   * Is the item being dragged?\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Boolean}\n   */\n  Item.prototype.isDragging = function () {\n\n    return !!this._drag && this._drag._data.isActive;\n\n  };\n\n  /**\n   * Is the item being released?\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Boolean}\n   */\n  Item.prototype.isReleasing = function () {\n\n    return this._release.isActive;\n\n  };\n\n  /**\n   * Is the item destroyed?\n   *\n   * @public\n   * @memberof Item.prototype\n   * @returns {Boolean}\n   */\n  Item.prototype.isDestroyed = function () {\n\n    return this._isDestroyed;\n\n  };\n\n  /**\n   * Item - Protected prototype methods\n   * **********************************\n   */\n\n  /**\n   * Recalculate item's dimensions.\n   *\n   * @protected\n   * @memberof Item.prototype\n   * @returns {Item}\n   */\n  Item.prototype._refreshDimensions = function () {\n\n    var inst = this;\n\n    if (inst._isDestroyed || inst._isHidden) {\n      return inst;\n    }\n\n    var element = inst._element;\n    var rect = element.getBoundingClientRect();\n    var sides = ['left', 'right', 'top', 'bottom'];\n    var margin = inst._margin = inst._margin || {};\n    var side;\n    var i;\n\n    // Calculate width and height.\n    inst._width = rect.width;\n    inst._height = rect.height;\n\n    // Calculate margins (ignore negative margins).\n    for (i = 0; i < 4; i++) {\n      side = getStyleAsFloat(element, 'margin-' + sides[i]);\n      margin[sides[i]] = side > 0 ? side : 0;\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Fetch and store item's sort data.\n   *\n   * @protected\n   * @memberof Item.prototype\n   * @returns {Item}\n   */\n  Item.prototype._refreshSortData = function () {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var sortData = {};\n    var getters = inst.getGrid()._settings.sortData;\n\n    // Fetch sort data.\n    if (getters) {\n      Object.keys(getters).forEach(function (key) {\n        sortData[key] = getters[key](inst, inst._element);\n      });\n    }\n\n    // Store sort data to the instance.\n    inst._sortData = sortData;\n\n    return inst;\n\n  };\n\n  /**\n   * Position item based on it's current data.\n   *\n   * @protected\n   * @memberof Item.prototype\n   * @param {Boolean} instant\n   * @param {Function} [onFinish]\n   * @returns {Item}\n   */\n  Item.prototype._layout = function (instant, onFinish) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var element = inst._element;\n    var isPositioning = inst._isPositioning;\n    var migrate = inst._migrate;\n    var release = inst._release;\n    var isJustReleased = release.isActive && release.isPositioningStarted === false;\n    var grid = inst.getGrid();\n    var settings = grid._settings;\n    var animDuration = isJustReleased ? settings.dragReleaseDuration : settings.layoutDuration;\n    var animEasing = isJustReleased ? settings.dragReleaseEasing : settings.layoutEasing;\n    var animEnabled = !instant && !inst._skipNextLayoutAnimation && animDuration > 0;\n    var isAnimating;\n    var offsetLeft;\n    var offsetTop;\n    var currentLeft;\n    var currentTop;\n    var targetStyles;\n\n    // If the item is currently positioning process current layout callback\n    // queue with interrupted flag on if the item is currently positioning.\n    if (isPositioning) {\n      processQueue(inst._layoutQueue, true, inst);\n    }\n\n    // Mark release positioning as started.\n    if (isJustReleased) {\n      release.isPositioningStarted = true;\n    }\n\n    // Push the callback to the callback queue.\n    if (typeof onFinish === typeFunction) {\n      inst._layoutQueue.push(onFinish);\n    }\n\n    // Get item container offsets and target styles.\n    offsetLeft = release.isActive ? release.containerDiffX : migrate.isActive ? migrate.containerDiffX : 0;\n    offsetTop = release.isActive ? release.containerDiffY : migrate.isActive ? migrate.containerDiffY : 0;\n    targetStyles = {transform: getTranslateString(inst._left + offsetLeft, inst._top + offsetTop)};\n\n    // If no animations are needed, easy peasy!\n    if (!animEnabled) {\n      isPositioning && rafLoop.cancel(rafQueueLayout, inst._id);\n      isAnimating = inst._animate.isAnimating();\n      inst._stopLayout(false, targetStyles);\n      !isAnimating && setStyles(element, targetStyles);\n      inst._skipNextLayoutAnimation = false;\n      return inst._finishLayout();\n    }\n\n    // Set item as positioning.\n    inst._isPositioning = true;\n\n    // Get the element's current left and top position in the read callback.\n    // Then in the write callback do the animation if necessary.\n    rafLoop.add(rafQueueLayout, inst._id, function () {\n      currentLeft = getTranslateAsFloat(element, 'x') - offsetLeft;\n      currentTop = getTranslateAsFloat(element, 'y') - offsetTop;\n    }, function () {\n\n      // If the item is already in correct position let's quit early.\n      if (inst._left === currentLeft && inst._top === currentTop) {\n        isPositioning && inst._stopLayout(false, targetStyles);\n        inst._isPositioning = false;\n        return inst._finishLayout();\n      }\n\n      // Set item's positioning class.\n      !isPositioning && addClass(element, settings.itemPositioningClass);\n\n      // Animate.\n      inst._animate.start(\n        {transform: getTranslateString(currentLeft + offsetLeft, currentTop + offsetTop)},\n        targetStyles,\n        {\n          duration: animDuration,\n          easing: animEasing,\n          onFinish: function () {\n            inst._finishLayout();\n          }\n        }\n      );\n\n    });\n\n    return inst;\n\n  };\n\n  /**\n   * Position item based on it's current data.\n   *\n   * @protected\n   * @memberof Item.prototype\n   * @returns {Item}\n   */\n  Item.prototype._finishLayout = function () {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    // Mark the item as not positioning and remove positioning classes.\n    if (inst._isPositioning) {\n      inst._isPositioning = false;\n      removeClass(inst._element, inst.getGrid()._settings.itemPositioningClass);\n    }\n\n    // Finish up release.\n    if (inst._release.isActive) {\n      inst._release.stop();\n    }\n\n    // Finish up migration.\n    if (inst._migrate.isActive) {\n      inst._migrate.stop();\n    }\n\n    // Process the callback queue.\n    processQueue(inst._layoutQueue, false, inst);\n\n    return inst;\n\n  };\n\n  /**\n   * Stop item's position animation if it is currently animating.\n   *\n   * @protected\n   * @memberof Item.prototype\n   * @param {Boolean} [processLayoutQueue=false]\n   * @param {Object} [targetStyles]\n   * @returns {Item}\n   */\n  Item.prototype._stopLayout = function (processLayoutQueue, targetStyles) {\n\n    var inst = this;\n\n    if (inst._isDestroyed || !inst._isPositioning) {\n      return inst;\n    }\n\n    // Cancel animation init.\n    rafLoop.cancel(rafQueueLayout, inst._id);\n\n    // Stop animation.\n    inst._animate.stop(targetStyles);\n\n    // Remove positioning class.\n    removeClass(inst._element, inst.getGrid()._settings.itemPositioningClass);\n\n    // Reset state.\n    inst._isPositioning = false;\n\n    // Process callback queue.\n    if (processLayoutQueue) {\n      processQueue(inst._layoutQueue, true, inst);\n    }\n\n    return inst;\n\n  };\n\n  Item.prototype._show = function (instant, onFinish) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var element = inst._element;\n    var queue = inst._visibilityQueue;\n    var callback = typeof onFinish === typeFunction ? onFinish : null;\n    var grid = inst.getGrid();\n    var settings = grid._settings;\n\n    // If item is visible call the callback and be done with it.\n    if (!inst._isShowing && !inst._isHidden) {\n      callback && callback(false, inst);\n      return inst;\n    }\n\n    // If item is showing and does not need to be shown instantly, let's just\n    // push callback to the callback queue and be done with it.\n    if (inst._isShowing && !instant) {\n      callback && queue.push(callback);\n      return inst;\n    }\n\n    // If the item is hiding or hidden process the current visibility callback\n    // queue with the interrupted flag active, update classes and set display\n    // to block if necessary.\n    if (!inst._isShowing) {\n      processQueue(queue, true, inst);\n      removeClass(element, settings.itemHiddenClass);\n      addClass(element, settings.itemVisibleClass);\n      !inst._isHiding && setStyles(element, {display: 'block'});\n    }\n\n    // Push callback to the callback queue.\n    callback && queue.push(callback);\n\n    // Update item's internal states.\n    inst._isActive = inst._isShowing = true;\n    inst._isHiding = inst._isHidden = false;\n\n    // If we need to show instantly.\n    if (instant) {\n      grid._itemShowHandler.stop(inst, settings.visibleStyles);\n      inst._isShowing = false;\n      processQueue(queue, false, inst);\n    }\n\n    // If we need to animate.\n    else {\n      grid._itemShowHandler.start(inst, instant, function () {\n        if (!inst._isHidden) {\n          inst._isShowing = false;\n          processQueue(queue, false, inst);\n        }\n      });\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Hide item.\n   *\n   * @protected\n   * @memberof Item.prototype\n   * @param {Boolean} instant\n   * @param {Function} [onFinish]\n   * @returns {Item}\n   */\n  Item.prototype._hide = function (instant, onFinish) {\n\n    var inst = this;\n\n    // Return immediately if the instance is destroyed.\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var element = inst._element;\n    var queue = inst._visibilityQueue;\n    var callback = typeof onFinish === typeFunction ? onFinish : null;\n    var grid = inst.getGrid();\n    var settings = grid._settings;\n\n    // If item is already hidden call the callback and be done with it.\n    if (!inst._isHiding && inst._isHidden) {\n      callback && callback(false, inst);\n      return inst;\n    }\n\n    // If item is hiding and does not need to be hidden instantly, let's just\n    // push callback to the callback queue and be done with it.\n    if (inst._isHiding && !instant) {\n      callback && queue.push(callback);\n      return inst;\n    }\n\n    // If the item is showing or visible process the current visibility callback\n    // queue with the interrupted flag active, update classes and set display\n    // to block if necessary.\n    if (!inst._isHiding) {\n      processQueue(queue, true, inst);\n      addClass(element, settings.itemHiddenClass);\n      removeClass(element, settings.itemVisibleClass);\n    }\n\n    // Push callback to the callback queue.\n    callback && queue.push(callback);\n\n    // Update item's internal states.\n    inst._isHidden = inst._isHiding = true;\n    inst._isActive = inst._isShowing = false;\n\n    // If we need to hide instantly.\n    if (instant) {\n      grid._itemHideHandler.stop(inst, settings.hiddenStyles);\n      inst._isHiding = false;\n      inst._stopLayout(true, {transform: getTranslateString(0, 0)});\n      setStyles(element, {display: 'none'});\n      processQueue(queue, false, inst);\n    }\n\n    // If we need to animate.\n    else {\n      grid._itemHideHandler.start(inst, instant, function () {\n        if (inst._isHidden) {\n          inst._isHiding = false;\n          inst._stopLayout(true, {transform: getTranslateString(0, 0)});\n          setStyles(element, {display: 'none'});\n          processQueue(queue, false, inst);\n        }\n      });\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Destroy item instance.\n   *\n   * @protected\n   * @memberof Item.prototype\n   * @param {Boolean} [removeElement=false]\n   * @returns {Item}\n   */\n  Item.prototype._destroy = function (removeElement) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var element = inst._element;\n    var grid = inst.getGrid();\n    var settings = grid._settings;\n    var index = grid._items.indexOf(inst);\n\n    // Destroy release and migration.\n    inst._release.destroy();\n    inst._migrate.destroy();\n\n    // Stop animations.\n    inst._stopLayout(true, {});\n    grid._itemShowHandler.stop(inst, {});\n    grid._itemHideHandler.stop(inst, {});\n\n    // Destroy drag.\n    inst._drag && inst._drag.destroy();\n\n    // Destroy animation handlers.\n    inst._animate.destroy();\n    inst._animateChild.destroy();\n\n    // Handle visibility callback queue, fire all uncompleted callbacks with\n    // interrupted flag.\n    processQueue(inst._visibilityQueue, true, inst);\n\n    // Remove all inline styles.\n    element.removeAttribute('style');\n    inst._child.removeAttribute('style');\n\n    // Remove classes.\n    removeClass(element, settings.itemPositioningClass);\n    removeClass(element, settings.itemDraggingClass);\n    removeClass(element, settings.itemReleasingClass);\n    removeClass(element, settings.itemClass);\n    removeClass(element, settings.itemVisibleClass);\n    removeClass(element, settings.itemHiddenClass);\n\n    // Remove item from Grid instance if it still exists there.\n    index > -1 && grid._items.splice(index, 1);\n\n    // Remove element from DOM.\n    removeElement && element.parentNode.removeChild(element);\n\n    // Remove item instance from the item instances collection.\n    itemInstances[inst._id] = undefined;\n\n    // Update item states (mostly just for good measure).\n    inst._isActive = inst._isPositioning = inst._isHiding = inst._isShowing = false;\n    inst._isDestroyed = inst._isHidden = true;\n\n    return inst;\n\n  };\n\n  /**\n   * Layout\n   * ******\n   */\n\n  /**\n   * Creates a new Layout instance.\n   *\n   * @public\n   * @class\n   * @param {Grid} grid\n   * @param {Item[]} items\n   */\n  function Layout(grid, items) {\n\n    var inst = this;\n    var layoutSettings = grid._settings.layout;\n\n    // Clone items.\n    items = items.concat();\n\n    // Let's make sure we have the correct container dimensions before going\n    // further.\n    grid._refreshDimensions();\n\n    var width = grid._width - grid._border.left - grid._border.right;\n    var height = grid._height - grid._border.top - grid._border.bottom;\n    var isCustomLayout = typeof layoutSettings === typeFunction;\n    var layout = isCustomLayout ? layoutSettings(items, width, height) :\n      muuriLayout(items, width, height, isPlainObject(layoutSettings) ? layoutSettings : {});\n\n    // Set instance data based on layout data.\n    inst.slots = layout.slots;\n    inst.setWidth = layout.setWidth || false;\n    inst.setHeight = layout.setHeight || false;\n    inst.width = layout.width;\n    inst.height = layout.height;\n\n  }\n\n  /**\n   * Emitter\n   * *******\n   */\n\n  /**\n   * Event emitter constructor.\n   *\n   * @public\n   * @class\n   */\n  function Emitter() {\n\n    this._events = {};\n    this._isDestroyed = false;\n\n  }\n\n  /**\n   * Emitter - Public prototype methods\n   * **********************************\n   */\n\n  /**\n   * Bind an event listener.\n   *\n   * @public\n   * @memberof Emitter.prototype\n   * @param {String} event\n   * @param {Function} listener\n   * @returns {Emitter}\n   */\n  Emitter.prototype.on = function (event, listener) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var listeners = inst._events[event] || [];\n    listeners.push(listener);\n    inst._events[event] = listeners;\n\n    return inst;\n\n  };\n\n  /**\n   * Bind an event listener that is triggered only once.\n   *\n   * @public\n   * @memberof Emitter.prototype\n   * @param {String} event\n   * @param {Function} listener\n   * @returns {Emitter}\n   */\n  Emitter.prototype.once = function (event, listener) {\n\n    var inst = this;\n    return this.on(event, function callback() {\n      inst.off(event, callback);\n      listener.apply(null, arguments);\n    });\n\n  };\n\n  /**\n   * Unbind all event listeners that match the provided listener function.\n   *\n   * @public\n   * @memberof Emitter.prototype\n   * @param {String} event\n   * @param {Function} listener\n   * @returns {Emitter}\n   */\n  Emitter.prototype.off = function (event, listener) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var listeners = inst._events[event] || [];\n    var i = listeners.length;\n\n    while (i--) {\n      if (listener === listeners[i]) {\n        listeners.splice(i, 1);\n      }\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Emit all listeners in a specified event with the provided arguments.\n   *\n   * @public\n   * @memberof Emitter.prototype\n   * @param {String} event\n   * @param {*} [arg1]\n   * @param {*} [arg2]\n   * @param {*} [arg3]\n   * @returns {Emitter}\n   */\n  Emitter.prototype.emit = function (event, arg1, arg2, arg3) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var listeners = inst._events[event] || [];\n    var listenersLength = listeners.length;\n    var argsLength = arguments.length - 1;\n    var i;\n\n    if (listenersLength) {\n      listeners = listeners.concat();\n      for (i = 0; i < listenersLength; i++) {\n        argsLength === 0 ? listeners[i]() :\n        argsLength === 1 ? listeners[i](arg1) :\n        argsLength === 2 ? listeners[i](arg1, arg2) :\n                            listeners[i](arg1, arg2, arg3);\n      }\n    }\n\n    return inst;\n\n  };\n\n  /**\n   * Destroy emitter instance. Basically just removes all bound listeners.\n   *\n   * @public\n   * @memberof Emitter.prototype\n   * @returns {Emitter}\n   */\n  Emitter.prototype.destroy = function () {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return inst;\n    }\n\n    var eventNames = Object.keys(inst._events);\n    var i;\n\n    for (i = 0; i < eventNames.length; i++) {\n      inst._events[eventNames[i]] = null;\n    }\n\n    inst._isDestroyed = true;\n\n    return inst;\n\n  };\n\n  /**\n   * ItemAnimate\n   * ***********\n   */\n\n  /**\n   * Muuri's internal animation engine. Uses Web Animations API.\n   *\n   * @public\n   * @class\n   * @param {Item} item\n   * @param {HTMLElement} element\n   */\n  function ItemAnimate(item, element) {\n\n    var inst = this;\n    inst._item = item;\n    inst._element = element;\n    inst._animation = null;\n    inst._propsTo = null;\n    inst._isDestroyed = false;\n\n  }\n\n  /**\n   * ItemAnimate - Public prototype methods\n   * **************************************\n   */\n\n  /**\n   * Start instance's animation. Automatically stops current animation if it is\n   * running.\n   *\n   * @public\n   * @memberof ItemAnimate.prototype\n   * @param {Object} propsFrom\n   * @param {Object} propsTo\n   * @param {Object} [options]\n   * @param {Number} [options.duration=300]\n   * @param {String} [options.easing='ease']\n   * @param {Function} [options.onFinish]\n   */\n  ItemAnimate.prototype.start = function (propsFrom, propsTo, options) {\n\n    var inst = this;\n\n    if (inst._isDestroyed) {\n      return;\n    }\n\n    var opts = options || {};\n    var callback = typeof opts.onFinish === typeFunction ? opts.onFinish : null;\n    var shouldStop;\n\n    // If item is being animate check if the target animation properties equal\n    // to the properties in the current animation. If they match we can just let\n    // the animation continue and be done with it (and of course change the\n    // cached callback). If the animation properties do not match we need to\n    // stop the ongoing animation.\n    if (inst._animation) {\n      shouldStop = Object.keys(propsTo).some(function (propName) {\n        return propsTo[propName] !== inst._propsTo[propName];\n      });\n      if (shouldStop) {\n        inst._animation.cancel();\n      }\n      else {\n        inst._animation.onfinish = function () {\n          inst._animation = inst._propsTo = null;\n          callback && callback();\n        };\n        return;\n      }\n    }\n\n    // Cache target props.\n    inst._propsTo = propsTo;\n\n    // Start the animation.\n    inst._animation = inst._element.animate([propsFrom, propsTo], {\n      duration: opts.duration || 300,\n      easing: opts.easing || 'ease'\n    });\n\n    // Bind animation finish callback.\n    inst._animation.onfinish = function () {\n      inst._animation = inst._propsTo = null;\n      callback && callback();\n    };\n\n    // Set the end styles.\n    setStyles(inst._element, propsTo);\n\n  };\n\n  /**\n   * Stop instance's current animation if running.\n   *\n   * @private\n   * @memberof ItemAnimate.prototype\n   * @param {Object} [currentProps]\n   */\n  ItemAnimate.prototype.stop = function (currentProps) {\n\n    var inst = this;\n\n    if (!inst._isDestroyed && inst._animation) {\n      setStyles(inst._element, currentProps || getCurrentStyles(inst._element, inst._propsTo));\n      inst._animation.cancel();\n      inst._animation = inst._propsTo = null;\n    }\n\n  };\n\n  /**\n   * Check if the item is being animated currently.\n   *\n   * @private\n   * @memberof ItemAnimate.prototype\n   * @return {Boolean}\n   */\n  ItemAnimate.prototype.isAnimating = function () {\n\n    return !!this._animation;\n\n  };\n\n  /**\n   * Destroy the instance and stop current animation if it is running.\n   *\n   * @public\n   * @memberof ItemAnimate.prototype\n   * @returns {Boolean}\n   */\n  ItemAnimate.prototype.destroy = function () {\n\n    var inst = this;\n\n    if (!inst._isDestroyed) {\n      inst.stop();\n      inst._item = inst._element = null;\n      inst._isDestroyed = true;\n    }\n\n  };\n\n  /**\n   * ItemMigrate\n   * ***********\n   */\n\n  /**\n   * The migrate process handler constructor.\n   *\n   * @class\n   * @private\n   * @param {Item} item\n   */\n  function ItemMigrate(item) {\n\n    var migrate = this;\n\n    // Private props.\n    migrate._itemId = item._id;\n    migrate._isDestroyed = false;\n\n    // Public props.\n    migrate.isActive = false;\n    migrate.container = false;\n    migrate.containerDiffX = 0;\n    migrate.containerDiffY = 0;\n\n  }\n\n  /**\n   * ItemMigrate - Public prototype methods\n   * **************************************\n   */\n\n  /**\n   * Destroy instance.\n   *\n   * @public\n   * @memberof ItemMigrate.prototype\n   * @returns {ItemMigrate}\n   */\n  ItemMigrate.prototype.destroy = function () {\n\n    var migrate = this;\n\n    if (!migrate._isDestroyed) {\n      migrate.stop(true);\n      migrate._isDestroyed = true;\n    }\n\n    return migrate;\n\n  };\n\n  /**\n   * Get Item instance.\n   *\n   * @public\n   * @memberof ItemMigrate.prototype\n   * @returns {?Item}\n   */\n  ItemMigrate.prototype.getItem = function () {\n\n    return itemInstances[this._itemId] || null;\n\n  };\n\n  /**\n   * Start the migrate process of an item.\n   *\n   * @public\n   * @memberof ItemMigrate.prototype\n   * @param {Grid} targetGrid\n   * @param {GridSingleItemQuery} position\n   * @param {HTMLElement} [container]\n   * @returns {ItemMigrate}\n   */\n  ItemMigrate.prototype.start = function (targetGrid, position, container) {\n\n    var migrate = this;\n\n    if (migrate._isDestroyed) {\n      return migrate;\n    }\n\n    var item = migrate.getItem();\n    var itemElement = item._element;\n    var isItemVisible = item.isVisible();\n    var currentGrid = item.getGrid();\n    var currentGridStn = currentGrid._settings;\n    var targetGridStn = targetGrid._settings;\n    var targetGridElement = targetGrid._element;\n    var currentIndex = currentGrid._items.indexOf(item);\n    var targetIndex = typeof position === typeNumber ? position : targetGrid._items.indexOf(targetGrid._getItem(position));\n    var targetContainer = container || body;\n    var currentContainer;\n    var offsetDiff;\n    var containerDiff;\n    var translateX;\n    var translateY;\n\n    // If we have invalid new index, let's return immediately.\n    if (targetIndex === null) {\n      return migrate;\n    }\n\n    // Normalize target index (for event data).\n    targetIndex = normalizeArrayIndex(targetGrid._items, targetIndex, true);\n\n    // Get current translateX and translateY values if needed.\n    if (item.isPositioning() || migrate.isActive || item.isReleasing()) {\n      translateX = getTranslateAsFloat(itemElement, 'x');\n      translateY = getTranslateAsFloat(itemElement, 'y');\n    }\n\n    // Abort current positioning.\n    if (item.isPositioning()) {\n      item._stopLayout(true, {transform: getTranslateString(translateX, translateY)});\n    }\n\n    // Abort current migration.\n    if (migrate.isActive) {\n      translateX -= migrate.containerDiffX;\n      translateY -= migrate.containerDiffY;\n      migrate.stop(true, {transform: getTranslateString(translateX, translateY)});\n    }\n\n    // Abort current release.\n    if (item.isReleasing()) {\n      translateX -= item._release.containerDiffX;\n      translateY -= item._release.containerDiffY;\n      item._release.stop(true, {transform: getTranslateString(translateX, translateY)});\n    }\n\n    // Stop current visibility animations.\n    // TODO: This causes potentially layout thrashing, because we are not\n    // feeding any styles to the stop handlers.\n    currentGrid._itemShowHandler.stop(item);\n    currentGrid._itemHideHandler.stop(item);\n\n    // Destroy current drag.\n    if (item._drag) {\n      item._drag.destroy();\n    }\n\n    // Destroy current animation handlers.\n    item._animate.destroy();\n    item._animateChild.destroy();\n\n    // Process current visibility animation queue.\n    processQueue(item._visibilityQueue, true, item);\n\n    // Emit beforeSend event.\n    currentGrid._emit(evBeforeSend, {\n      item: item,\n      fromGrid: currentGrid,\n      fromIndex: currentIndex,\n      toGrid: targetGrid,\n      toIndex: targetIndex\n    });\n\n    // Emit beforeReceive event.\n    targetGrid._emit(evBeforeReceive, {\n      item: item,\n      fromGrid: currentGrid,\n      fromIndex: currentIndex,\n      toGrid: targetGrid,\n      toIndex: targetIndex\n    });\n\n    // Remove current classnames.\n    removeClass(itemElement, currentGridStn.itemClass);\n    removeClass(itemElement, currentGridStn.itemVisibleClass);\n    removeClass(itemElement, currentGridStn.itemHiddenClass);\n\n    // Add new classnames.\n    addClass(itemElement, targetGridStn.itemClass);\n    addClass(itemElement, isItemVisible ? targetGridStn.itemVisibleClass : targetGridStn.itemHiddenClass);\n\n    // Move item instance from current grid to target grid.\n    currentGrid._items.splice(currentIndex, 1);\n    insertItemsToArray(targetGrid._items, item, targetIndex);\n\n    // Update item's grid id reference.\n    item._gridId = targetGrid._id;\n\n    // Instantiate new animation controllers.\n    item._animate = new Grid.ItemAnimate(item, itemElement);\n    item._animateChild = new Grid.ItemAnimate(item, item._child);\n\n    // Get current container\n    currentContainer = itemElement.parentNode;\n\n    // Move the item inside the target container if it's different than the\n    // current container.\n    if (targetContainer !== currentContainer) {\n      targetContainer.appendChild(itemElement);\n      offsetDiff = getOffsetDiff(targetContainer, currentContainer, true);\n      if (translateX === undefined) {\n        translateX = getTranslateAsFloat(itemElement, 'x');\n        translateY = getTranslateAsFloat(itemElement, 'y');\n      }\n      setStyles(itemElement, {transform: getTranslateString(translateX + offsetDiff.left, translateY + offsetDiff.top)});\n    }\n\n    // Update child element's styles to reflect the current visibility state.\n    item._child.removeAttribute('style');\n    if (isItemVisible) {\n      targetGrid._itemShowHandler.start(item, true);\n    }\n    else {\n      targetGrid._itemHideHandler.start(item, true);\n    }\n\n    // Update display styles.\n    setStyles(itemElement, {\n      display: isItemVisible ? 'block' : 'hidden'\n    });\n\n    // Get offset diff for the migration data.\n    containerDiff = getOffsetDiff(targetContainer, targetGridElement, true);\n\n    // Update item's cached dimensions and sort data.\n    item._refreshDimensions()._refreshSortData();\n\n    // Create new drag handler.\n    item._drag = targetGridStn.dragEnabled ? new Grid.ItemDrag(item) : null;\n\n    // Setup migration data.\n    migrate.isActive = true;\n    migrate.container = targetContainer;\n    migrate.containerDiffX = containerDiff.left;\n    migrate.containerDiffY = containerDiff.top;\n\n    // Emit send event.\n    currentGrid._emit(evSend, {\n      item: item,\n      fromGrid: currentGrid,\n      fromIndex: currentIndex,\n      toGrid: targetGrid,\n      toIndex: targetIndex\n    });\n\n    // Emit receive event.\n    targetGrid._emit(evReceive, {\n      item: item,\n      fromGrid: currentGrid,\n      fromIndex: currentIndex,\n      toGrid: targetGrid,\n      toIndex: targetIndex\n    });\n\n    return migrate;\n\n  };\n\n  /**\n   * End the migrate process of an item. This method can be used to abort an\n   * ongoing migrate process (animation) or finish the migrate process.\n   *\n   * @public\n   * @memberof ItemMigrate.prototype\n   * @param {Boolean} [abort=false]\n   *  - Should the migration be aborted?\n   * @param {Object} [currentStyles]\n   *  - Optional current translateX and translateY styles.\n   * @returns {ItemMigrate}\n   */\n  ItemMigrate.prototype.stop = function (abort, currentStyles) {\n\n    var migrate = this;\n\n    if (migrate._isDestroyed || !migrate.isActive) {\n      return migrate;\n    }\n\n    var item = migrate.getItem();\n    var element = item._element;\n    var grid = item.getGrid();\n    var gridElement = grid._element;\n    var translateX;\n    var translateY;\n\n    if (migrate.container !== gridElement) {\n      if (!currentStyles) {\n        translateX = abort ? getTranslateAsFloat(element, 'x') - migrate.containerDiffX : item._left;\n        translateY = abort ? getTranslateAsFloat(element, 'y') - migrate.containerDiffY : item._top;\n        currentStyles = {transform: getTranslateString(translateX, translateY)};\n      }\n      gridElement.appendChild(element);\n      setStyles(element, currentStyles);\n    }\n\n    migrate.isActive = false;\n    migrate.container = null;\n    migrate.containerDiffX = 0;\n    migrate.containerDiffY = 0;\n\n    return migrate;\n\n  };\n\n  /**\n   * ItemRelease\n   * ***********\n   */\n\n  /**\n   * The release process handler constructor. Although this might seem as proper\n   * fit for the drag process this needs to be separated into it's own logic\n   * because there might be a scenario where drag is disabled, but the release\n   * process still needs to be implemented (dragging from a grid to another).\n   *\n   * @class\n   * @private\n   * @param {Item} item\n   */\n  function ItemRelease(item) {\n\n    var release = this;\n\n    // Private props.\n    release._itemId = item._id;\n    release._isDestroyed = false;\n\n    // Public props.\n    release.isActive = false;\n    release.isPositioningStarted = false;\n    release.containerDiffX = 0;\n    release.containerDiffY = 0;\n\n  }\n\n  /**\n   * ItemRelease - Public prototype methods\n   * **************************************\n   */\n\n  /**\n   * Destroy instance.\n   *\n   * @public\n   * @memberof ItemRelease.prototype\n   * @returns {ItemRelease}\n   */\n  ItemRelease.prototype.destroy = function () {\n\n    var release = this;\n\n    if (!release._isDestroyed) {\n      release.stop(true);\n      release._isDestroyed = true;\n    }\n\n    return release;\n\n  };\n\n  /**\n   * Get Item instance.\n   *\n   * @public\n   * @memberof ItemRelease.prototype\n   * @returns {?Item}\n   */\n  ItemRelease.prototype.getItem = function () {\n\n    return itemInstances[this._itemId] || null;\n\n  };\n\n  /**\n   * Reset public data and remove releasing class.\n   *\n   * @public\n   * @memberof ItemRelease.prototype\n   * @returns {ItemRelease}\n   */\n  ItemRelease.prototype.reset = function () {\n\n    var release = this;\n\n    if (release._isDestroyed) {\n      return release;\n    }\n\n    var item = release.getItem();\n    release.isActive = false;\n    release.isPositioningStarted = false;\n    release.containerDiffX = 0;\n    release.containerDiffY = 0;\n    removeClass(item._element, item.getGrid()._settings.itemReleasingClass);\n\n    return release;\n\n  };\n\n  /**\n   * Start the release process of an item.\n   *\n   * @public\n   * @memberof ItemRelease.prototype\n   * @returns {ItemRelease}\n   */\n  ItemRelease.prototype.start = function () {\n\n    var release = this;\n\n    if (release._isDestroyed || release.isActive) {\n      return release;\n    }\n\n    var item = release.getItem();\n    var grid = item.getGrid();\n\n    // Flag release as active.\n    release.isActive = true;\n\n    // Add release classname to the released element.\n    addClass(item._element, grid._settings.itemReleasingClass);\n\n    // Emit dragReleaseStart event.\n    grid._emit(evDragReleaseStart, item);\n\n    // Position the released item.\n    item._layout(false);\n\n    return release;\n\n  };\n\n  /**\n   * End the release process of an item. This method can be used to abort an\n   * ongoing release process (animation) or finish the release process.\n   *\n   * @public\n   * @memberof ItemRelease.prototype\n   * @param {Boolean} [abort=false]\n   *  - Should the release be aborted? When true, the release end event won't be\n   *    emitted. Set to true only when you need to abort the release process\n   *    while the item is animating to it's position.\n   * @param {Object} [currentStyles]\n   *  - Optional current translateX and translateY styles.\n   * @returns {ItemRelease}\n   */\n  ItemRelease.prototype.stop = function (abort, currentStyles) {\n\n    var release = this;\n\n    if (release._isDestroyed || !release.isActive) {\n      return release;\n    }\n\n    var item = release.getItem();\n    var element = item._element;\n    var grid = item.getGrid();\n    var container = grid._element;\n    var containerDiffX = release.containerDiffX;\n    var containerDiffY = release.containerDiffY;\n    var translateX;\n    var translateY;\n\n    // Reset data and remove releasing classname from the element.\n    release.reset();\n\n    // If the released element is outside the grid's container element put it\n    // back there and adjust position accordingly.\n    if (element.parentNode !== container) {\n      if (!currentStyles) {\n        translateX = abort ? getTranslateAsFloat(element, 'x') - containerDiffX : item._left;\n        translateY = abort ? getTranslateAsFloat(element, 'y') - containerDiffY : item._top;\n        currentStyles = {transform: getTranslateString(translateX, translateY)};\n      }\n      container.appendChild(element);\n      setStyles(element, currentStyles);\n    }\n\n    // Emit dragReleaseEnd event.\n    if (!abort) {\n      grid._emit(evDragReleaseEnd, item);\n    }\n\n    return release;\n\n  };\n\n  /**\n   * ItemDrag\n   * ********\n   */\n\n  /**\n   * Bind Hammer touch interaction to an item.\n   *\n   * @class\n   * @private\n   * @param {Item} item\n   */\n  function ItemDrag(item) {\n\n    if (!Hammer) {\n      throw new Error('[' + namespace + '] required dependency Hammer is not defined.');\n    }\n\n    var drag = this;\n    var element = item._element;\n    var grid = item.getGrid();\n    var settings = grid._settings;\n    var hammer;\n\n    // Start predicate.\n    var startPredicate = typeof settings.dragStartPredicate === typeFunction ?\n      settings.dragStartPredicate : ItemDrag.defaultStartPredicate;\n    var startPredicateState = startPredicateInactive;\n    var startPredicateResult;\n\n    // Protected data.\n    drag._itemId = item._id;\n    drag._gridId = grid._id;\n    drag._hammer = hammer = new Hammer.Manager(element);\n    drag._isDestroyed = false;\n    drag._isMigrating = false;\n    drag._data = {};\n\n    // Create a private drag start resolver that can be used to resolve the drag\n    // start predicate asynchronously.\n    drag._resolveStartPredicate = function (event) {\n      if (!drag._isDestroyed && startPredicateState === startPredicatePending) {\n        startPredicateState = startPredicateResolved;\n        drag.onStart(event);\n      }\n    };\n\n    // Create scroll listener.\n    drag._scrollListener = function (e) {\n      drag.onScroll(e);\n    };\n\n    // Create overlap checker function.\n    drag._checkSortOverlap = debounce(function () {\n      drag._data.isActive && drag.checkOverlap();\n    }, settings.dragSortInterval);\n\n    // Create sort predicate.\n    drag._sortPredicate = typeof settings.dragSortPredicate === typeFunction ?\n      settings.dragSortPredicate : ItemDrag.defaultSortPredicate;\n\n    // Setup item's initial drag data.\n    drag.reset();\n\n    // Add drag recognizer to hammer.\n    hammer.add(new Hammer.Pan({\n      event: 'drag',\n      pointers: 1,\n      threshold: 0,\n      direction: Hammer.DIRECTION_ALL\n    }));\n\n    // Add draginit recognizer to hammer.\n    hammer.add(new Hammer.Press({\n      event: 'draginit',\n      pointers: 1,\n      threshold: 1000,\n      time: 0\n    }));\n\n    // Configure the hammer instance.\n    if (isPlainObject(settings.dragHammerSettings)) {\n      hammer.set(settings.dragHammerSettings);\n    }\n\n    // Bind drag events.\n    hammer\n    .on('draginit dragstart dragmove', function (e) {\n\n      // Let's activate drag start predicate state.\n      if (startPredicateState === startPredicateInactive) {\n        startPredicateState = startPredicatePending;\n      }\n\n      // If predicate is pending try to resolve it.\n      if (startPredicateState === startPredicatePending) {\n        startPredicateResult = startPredicate(drag.getItem(), e);\n        if (startPredicateResult === true) {\n          startPredicateState = startPredicateResolved;\n          drag.onStart(e);\n        }\n        else if (startPredicateResult === false) {\n          startPredicateState = startPredicateRejected;\n        }\n      }\n\n      // Otherwise if predicate is resolved and drag is active, move the item.\n      else if (startPredicateState === startPredicateResolved && drag._data.isActive) {\n        drag.onMove(e);\n      }\n\n    })\n    .on('dragend dragcancel draginitup', function (e) {\n\n      // Check if the start predicate was resolved during drag.\n      var isResolved = startPredicateState === startPredicateResolved;\n\n      // Do final predicate check to allow user to unbind stuff for the current\n      // drag procedure within the predicate callback. The return value of this\n      // check will have no effect to the state of the predicate.\n      startPredicate(drag.getItem(), e);\n\n      // Reset start predicate state.\n      startPredicateState = startPredicateInactive;\n\n      // If predicate is resolved and dragging is active, call the end handler.\n      if (isResolved && drag._data.isActive) {\n        drag.onEnd(e);\n      }\n\n    });\n\n    // Prevent native link/image dragging for the item and it's ancestors.\n    element.addEventListener('dragstart', preventDefault, false);\n\n  }\n\n  /**\n   * ItemDrag - Public methods\n   * *************************\n   */\n\n  /**\n   * Default drag start predicate handler that handles anchor elements\n   * gracefully. The return value of this function defines if the drag is\n   * started, rejected or pending. When true is returned the dragging is started\n   * and when false is returned the dragging is rejected. If nothing is returned\n   * the predicate will be called again on the next drag movement.\n   *\n   * @public\n   * @memberof ItemDrag\n   * @param {Item} item\n   * @param {Object} event\n   * @param {Object} [options]\n   *   - An optional options object which can be used to pass the predicate\n   *     it's options manually. By default the predicate retrieves the options\n   *     from the grid's settings.\n   * @returns {Boolean}\n   */\n  ItemDrag.defaultStartPredicate = function (item, event, options) {\n\n    var element = item._element;\n    var predicate = item._drag._startPredicateData;\n    var config;\n    var isAnchor;\n    var href;\n    var target;\n\n    // Setup data if it is not set up yet.\n    if (!predicate) {\n      config = options || item._drag.getGrid()._settings.dragStartPredicate;\n      config = isPlainObject(config) ? config : {};\n      predicate = item._drag._startPredicateData = {\n        distance: Math.abs(config.distance) || 0,\n        delay: Math.max(config.delay, 0) || 0,\n        handle: typeof config.handle === 'string' ? config.handle : false\n      };\n    }\n\n    // Final event logic. At this stage return value does not matter anymore,\n    // the predicate is either resolved or it's not and there's nothing to do\n    // about it. Here we just reset data and if the item element is a link\n    // we follow it (if there has only been slight movement).\n    if (event.isFinal) {\n      isAnchor = element.tagName.toLowerCase() === 'a';\n      href = element.getAttribute('href');\n      target = element.getAttribute('target');\n      dragStartPredicateReset(item);\n      if (isAnchor && href && Math.abs(event.deltaX) < 2 && Math.abs(event.deltaY) < 2 && event.deltaTime < 200) {\n        if (target && target !== '_self') {\n          global.open(href, target);\n        }\n        else {\n          global.location.href = href;\n        }\n      }\n      return;\n    }\n\n    // Find and store the handle element so we can check later on if the\n    // cursor is within the handle. If we have a handle selector let's find\n    // the corresponding element. Otherwise let's use the item element as the\n    // handle.\n    if (!predicate.handleElement) {\n      if (predicate.handle) {\n        predicate.handleElement = (event.changedPointers[0] || {}).target;\n        while (predicate.handleElement && !elementMatches(predicate.handleElement, predicate.handle)) {\n          predicate.handleElement = predicate.handleElement !== element ? predicate.handleElement.parentElement : null;\n        }\n        if (!predicate.handleElement) {\n          return false;\n        }\n      }\n      else {\n        predicate.handleElement = element;\n      }\n    }\n\n    // If delay is defined let's keep track of the latest event and initiate\n    // delay if it has not been done yet.\n    if (predicate.delay) {\n      predicate.event = event;\n      if (!predicate.delayTimer) {\n        predicate.delayTimer = global.setTimeout(function () {\n          predicate.delay = 0;\n          if (dragStartPredicateResolve(item, predicate.event)) {\n            item._drag._resolveStartPredicate(predicate.event);\n            dragStartPredicateReset(item);\n          }\n        }, predicate.delay);\n      }\n    }\n\n    return dragStartPredicateResolve(item, event);\n\n  };\n\n  /**\n   * Default drag sort predicate.\n   *\n   * @public\n   * @memberof ItemDrag\n   * @param {Item} item\n   * @param {Object} event\n   * @returns {(Boolean|DragSortCommand)}\n   *   - Returns false if no valid index was found. Otherwise returns drag sort\n   *     command.\n   */\n  ItemDrag.defaultSortPredicate = function (item) {\n\n    var drag = item._drag;\n    var dragData = drag._data;\n    var rootGrid = drag.getGrid();\n    var settings = rootGrid._settings;\n    var config = settings.dragSortPredicate || {};\n    var sortThreshold = config.threshold || 50;\n    var sortAction = config.action || 'move';\n    var itemRect = {\n      width: item._width,\n      height: item._height,\n      left: dragData.elementClientX,\n      top: dragData.elementClientY\n    };\n    var grid = getTargetGrid(item, rootGrid, itemRect, sortThreshold);\n    var gridOffsetLeft = 0;\n    var gridOffsetTop = 0;\n    var matchScore = -1;\n    var matchIndex;\n    var hasValidTargets;\n    var target;\n    var score;\n    var i;\n\n    // Return early if we found no grid container element that overlaps the\n    // dragged item enough.\n    if (!grid) {\n      return false;\n    }\n\n    // If item is moved within it's originating grid adjust item's left and top\n    // props. Otherwise if item is moved to/within another grid get the\n    // container element's offset (from the element's content edge).\n    if (grid === rootGrid) {\n      itemRect.left = dragData.gridX + item._margin.left;\n      itemRect.top = dragData.gridY + item._margin.top;\n    }\n    else {\n      gridOffsetLeft = grid._left + grid._border.left;\n      gridOffsetTop = grid._top + grid._border.top;\n    }\n\n    // Loop through the target grid items and try to find the best match.\n    for (i = 0; i < grid._items.length; i++) {\n\n      target = grid._items[i];\n\n      // If the target item is not active or the target item is the dragged item\n      // let's skip to the next item.\n      if (!target._isActive || target === item) {\n        continue;\n      }\n\n      // Mark the grid as having valid target items.\n      hasValidTargets = true;\n\n      // Calculate the target's overlap score with the dragged item.\n      score = getRectOverlapScore(itemRect, {\n        width: target._width,\n        height: target._height,\n        left: target._left + target._margin.left + gridOffsetLeft,\n        top: target._top + target._margin.top + gridOffsetTop\n      });\n\n      // Update best match index and score if the target's overlap score with\n      // the dragged item is higher than the current best match score.\n      if (score > matchScore) {\n        matchIndex = i;\n        matchScore = score;\n      }\n\n    }\n\n    // If there is no valid match and the item is being moved into another grid.\n    if (matchScore < sortThreshold && item.getGrid() !== grid) {\n      matchIndex = hasValidTargets ? -1 : 0;\n      matchScore = Infinity;\n    }\n\n    // Check if the best match overlaps enough to justify a placement switch.\n    if (matchScore >= sortThreshold) {\n      return {\n        grid: grid,\n        index: matchIndex,\n        action: sortAction\n      };\n    }\n\n    return false;\n\n  };\n\n  /**\n   * ItemDrag - Public prototype methods\n   * ***********************************\n   */\n\n  /**\n   * Destroy instance.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.destroy = function () {\n\n    var drag = this;\n\n    if (!drag._isDestroyed) {\n      drag.stop();\n      drag._hammer.destroy();\n      drag.getItem()._element.removeEventListener('dragstart', preventDefault, false);\n      drag._isDestroyed = true;\n    }\n\n    return drag;\n\n  };\n\n  /**\n   * Get Item instance.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {?Item}\n   */\n  ItemDrag.prototype.getItem = function () {\n\n    return itemInstances[this._itemId] || null;\n\n  };\n\n  /**\n   * Get Grid instance.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {?Grid}\n   */\n  ItemDrag.prototype.getGrid = function () {\n\n    return gridInstances[this._gridId] || null;\n\n  };\n\n  /**\n   * Setup/reset drag data.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.reset = function () {\n\n    var drag = this;\n    var dragData = drag._data;\n\n    // Is item being dragged?\n    dragData.isActive = false;\n\n    // The dragged item's container element.\n    dragData.container = null;\n\n    // The dragged item's containing block.\n    dragData.containingBlock = null;\n\n    // Hammer event data.\n    dragData.startEvent = null;\n    dragData.currentEvent = null;\n\n    // All the elements which need to be listened for scroll events during\n    // dragging.\n    dragData.scrollers = [];\n\n    // The current translateX/translateY position.\n    dragData.left = 0;\n    dragData.top = 0;\n\n    // Dragged element's current position within the grid.\n    dragData.gridX = 0;\n    dragData.gridY = 0;\n\n    // Dragged element's current offset from window's northwest corner. Does\n    // not account for element's margins.\n    dragData.elementClientX = 0;\n    dragData.elementClientY = 0;\n\n    // Offset difference between the dragged element's temporary drag\n    // container and it's original container.\n    dragData.containerDiffX = 0;\n    dragData.containerDiffY = 0;\n\n    return drag;\n\n  };\n\n  /**\n   * Bind drag scroll handlers to all scrollable ancestor elements of the\n   * dragged element and the drag container element.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.bindScrollListeners = function () {\n\n    var drag = this;\n    var gridContainer = drag.getGrid()._element;\n    var dragContainer = drag._data.container;\n    var scrollers = getScrollParents(drag.getItem()._element);\n    var i;\n\n    // If drag container is defined and it's not the same element as grid\n    // container then we need to add the grid container and it's scroll parents\n    // to the elements which are going to be listener for scroll events.\n    if (dragContainer !== gridContainer) {\n      scrollers = arrayUnique(scrollers.concat(gridContainer).concat(getScrollParents(gridContainer)));\n    }\n\n    // Bind scroll listeners.\n    for (i = 0; i < scrollers.length; i++) {\n      scrollers[i].addEventListener('scroll', drag._scrollListener);\n    }\n\n    // Save scrollers to drag data.\n    drag._data.scrollers = scrollers;\n\n    return drag;\n\n  };\n\n  /**\n   * Unbind currently bound drag scroll handlers from all scrollable ancestor\n   * elements of the dragged element and the drag container element.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.unbindScrollListeners = function () {\n\n    var drag = this;\n    var dragData = drag._data;\n    var scrollers = dragData.scrollers;\n    var i;\n\n    for (i = 0; i < scrollers.length; i++) {\n      scrollers[i].removeEventListener('scroll', drag._scrollListener);\n    }\n\n    dragData.scrollers = [];\n\n    return drag;\n\n  };\n\n  /**\n   * Check (during drag) if an item is overlapping other items and based on\n   * the configuration layout the items.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.checkOverlap = function () {\n\n    var drag = this;\n    var item = drag.getItem();\n    var result = drag._sortPredicate(item, drag._data.currentEvent);\n    var currentGrid;\n    var currentIndex;\n    var targetGrid;\n    var targetIndex;\n    var sortAction;\n    var isMigration;\n\n    // Let's make sure the result object has a valid index before going further.\n    if (!isPlainObject(result) || typeof result.index !== typeNumber) {\n      return drag;\n    }\n\n    currentGrid = item.getGrid();\n    targetGrid = result.grid || currentGrid;\n    isMigration = currentGrid !== targetGrid;\n    currentIndex = currentGrid._items.indexOf(item);\n    targetIndex = normalizeArrayIndex(targetGrid._items, result.index, isMigration);\n    sortAction = result.action === 'swap' ? 'swap' : 'move';\n\n    // If the item was moved within it's current grid.\n    if (!isMigration) {\n\n      // Make sure the target index is not the current index.\n      if (currentIndex !== targetIndex) {\n\n        // Do the sort.\n        (sortAction === 'swap' ? arraySwap : arrayMove)(currentGrid._items, currentIndex, targetIndex);\n\n        // Emit move event.\n        currentGrid._emit(evMove, {\n          item: item,\n          fromIndex: currentIndex,\n          toIndex: targetIndex,\n          action: sortAction\n        });\n\n        // Layout the grid.\n        currentGrid.layout();\n\n      }\n\n    }\n\n    // If the item was moved to another grid.\n    else {\n\n      // Emit beforeSend event.\n      currentGrid._emit(evBeforeSend, {\n        item: item,\n        fromGrid: currentGrid,\n        fromIndex: currentIndex,\n        toGrid: targetGrid,\n        toIndex: targetIndex\n      });\n\n      // Emit beforeReceive event.\n      targetGrid._emit(evBeforeReceive, {\n        item: item,\n        fromGrid: currentGrid,\n        fromIndex: currentIndex,\n        toGrid: targetGrid,\n        toIndex: targetIndex\n      });\n\n      // Update item's grid id reference.\n      item._gridId = targetGrid._id;\n\n      // Update drag instances's migrating indicator.\n      drag._isMigrating = item._gridId !== drag._gridId;\n\n      // Move item instance from current grid to target grid.\n      currentGrid._items.splice(currentIndex, 1);\n      insertItemsToArray(targetGrid._items, item, targetIndex);\n\n      // Set sort data as null, which is an indicator for the item comparison\n      // function that the sort data of this specific item should be fetched\n      // lazily.\n      item._sortData = null;\n\n      // Emit send event.\n      currentGrid._emit(evSend, {\n        item: item,\n        fromGrid: currentGrid,\n        fromIndex: currentIndex,\n        toGrid: targetGrid,\n        toIndex: targetIndex\n      });\n\n      // Emit receive event.\n      targetGrid._emit(evReceive, {\n        item: item,\n        fromGrid: currentGrid,\n        fromIndex: currentIndex,\n        toGrid: targetGrid,\n        toIndex: targetIndex\n      });\n\n      // Layout both grids.\n      currentGrid.layout();\n      targetGrid.layout();\n\n    }\n\n    return drag;\n\n  };\n\n  /**\n   * If item is dragged into another grid, finish the migration process\n   * gracefully.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.finishMigration = function () {\n\n    var drag = this;\n    var item = drag.getItem();\n    var release = item._release;\n    var element = item._element;\n    var targetGrid = item.getGrid();\n    var targetGridElement = targetGrid._element;\n    var targetSettings = targetGrid._settings;\n    var targetContainer = targetSettings.dragContainer || targetGridElement;\n    var currentSettings = drag.getGrid()._settings;\n    var currentContainer = element.parentNode;\n    var translateX;\n    var translateY;\n    var offsetDiff;\n\n    // Destroy current drag. Note that we need to set the migrating flag to\n    // false first, because otherwise we create an infinite loop between this\n    // and the drag.stop() method.\n    drag._isMigrating = false;\n    drag.destroy();\n\n    // Destroy current animation handlers.\n    item._animate.destroy();\n    item._animateChild.destroy();\n\n    // Remove current classnames.\n    removeClass(element, currentSettings.itemClass);\n    removeClass(element, currentSettings.itemVisibleClass);\n    removeClass(element, currentSettings.itemHiddenClass);\n\n    // Add new classnames.\n    addClass(element, targetSettings.itemClass);\n    addClass(element, targetSettings.itemVisibleClass);\n\n    // Instantiate new animation controllers.\n    item._animate = new Grid.ItemAnimate(item, element);\n    item._animateChild = new Grid.ItemAnimate(item, item._child);\n\n    // Move the item inside the target container if it's different than the\n    // current container.\n    if (targetContainer !== currentContainer) {\n      targetContainer.appendChild(element);\n      offsetDiff = getOffsetDiff(currentContainer, targetContainer, true);\n      translateX = getTranslateAsFloat(element, 'x') - offsetDiff.left;\n      translateY = getTranslateAsFloat(element, 'y') - offsetDiff.top;\n    }\n\n    // Update item's cached dimensions and sort data.\n    item._refreshDimensions()._refreshSortData();\n\n    // Calculate the offset difference between target's drag container (if any)\n    // and actual grid container element. We save it later for the release\n    // process.\n    offsetDiff = getOffsetDiff(targetContainer, targetGridElement, true);\n    release.containerDiffX = offsetDiff.left;\n    release.containerDiffY = offsetDiff.top;\n\n    // Recreate item's drag handler.\n    item._drag = targetSettings.dragEnabled ? new Grid.ItemDrag(item) : null;\n\n    // Adjust the position of the item element if it was moved from a container\n    // to another.\n    if (targetContainer !== currentContainer) {\n      setStyles(element, {transform: getTranslateString(translateX, translateY)});\n    }\n\n    // Update child element's styles to reflect the current visibility state.\n    item._child.removeAttribute('style');\n    targetGrid._itemShowHandler.start(item, true);\n\n    // Start the release.\n    release.start();\n\n    return drag;\n\n  };\n\n  /**\n   * cancel move/scroll event raf loop action.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.cancelRafLoop = function () {\n\n    var id = this.getItem()._id;\n\n    rafLoop.cancel(rafQueueScroll, id);\n    rafLoop.cancel(rafQueueMove, id);\n\n    return this;\n\n  };\n\n  /**\n   * Abort dragging and reset drag data.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.stop = function () {\n\n    var drag = this;\n    var dragData = drag._data;\n    var item = drag.getItem();\n    var element = item._element;\n    var grid = drag.getGrid();\n\n    if (!dragData.isActive) {\n      return drag;\n    }\n\n    // If the item is being dropped into another grid, finish it up and return\n    // immediately.\n    if (drag._isMigrating) {\n      return drag.finishMigration(dragData.currentEvent);\n    }\n\n    // Cancel raf loop actions.\n    drag.cancelRafLoop();\n\n    // Remove scroll listeners.\n    drag.unbindScrollListeners();\n\n    // Cancel overlap check.\n    drag._checkSortOverlap('cancel');\n\n    // Append item element to the container if it's not it's child. Also make\n    // sure the translate values are adjusted to account for the DOM shift.\n    if (element.parentNode !== grid._element) {\n      grid._element.appendChild(element);\n      setStyles(element, {transform: getTranslateString(dragData.gridX, dragData.gridY)});\n    }\n\n    // Remove dragging class.\n    removeClass(element, grid._settings.itemDraggingClass);\n\n    // Reset drag data.\n    drag.reset();\n\n    return drag;\n\n  };\n\n  /**\n   * Drag start handler.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @param {Object} event\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.onStart = function (event) {\n\n    var drag = this;\n    var item = drag.getItem();\n\n    // If item is not active, don't start the drag.\n    if (!item._isActive) {\n      return drag;\n    }\n\n    var element = item._element;\n    var grid = drag.getGrid();\n    var settings = grid._settings;\n    var dragData = drag._data;\n    var release = item._release;\n    var migrate = item._migrate;\n    var gridContainer = grid._element;\n    var dragContainer = settings.dragContainer || gridContainer;\n    var containingBlock = getContainingBlock(dragContainer, true);\n    var offsetDiff = dragContainer !== gridContainer ? getOffsetDiff(containingBlock, gridContainer) : 0;\n    var currentLeft = getTranslateAsFloat(element, 'x');\n    var currentTop = getTranslateAsFloat(element, 'y');\n    var elementRect = element.getBoundingClientRect();\n\n    // Stop current positioning animation.\n    if (item.isPositioning()) {\n      item._stopLayout(true, {transform: getTranslateString(currentLeft, currentTop)});\n    }\n\n    // Stop current migration animation.\n    if (migrate.isActive) {\n      currentLeft -= migrate.containerDiffX;\n      currentTop -= migrate.containerDiffY;\n      migrate.stop(true, {transform: getTranslateString(currentLeft, currentTop)});\n    }\n\n    // If item is being released reset release data.\n    if (item.isReleasing()) {\n      release.reset();\n    }\n\n    // Setup drag data.\n    dragData.isActive = true;\n    dragData.startEvent = dragData.currentEvent = event;\n    dragData.container = dragContainer;\n    dragData.containingBlock = containingBlock;\n    dragData.elementClientX = elementRect.left;\n    dragData.elementClientY = elementRect.top;\n    dragData.left = dragData.gridX = currentLeft;\n    dragData.top = dragData.gridY = currentTop;\n\n    // Emit dragInit event.\n    grid._emit(evDragInit, item, event);\n\n    // If a specific drag container is set and it is different from the\n    // grid's container element we need to cast some extra spells.\n    if (dragContainer !== gridContainer) {\n\n      // Store the container offset diffs to drag data.\n      dragData.containerDiffX = offsetDiff.left;\n      dragData.containerDiffY = offsetDiff.top;\n\n      // If the dragged element is a child of the drag container all we need to\n      // do is setup the relative drag position data.\n      if (element.parentNode === dragContainer) {\n        dragData.gridX = currentLeft - dragData.containerDiffX;\n        dragData.gridY = currentTop - dragData.containerDiffY;\n      }\n\n      // Otherwise we need to append the element inside the correct container,\n      // setup the actual drag position data and adjust the element's translate\n      // values to account for the DOM position shift.\n      else {\n        dragData.left = currentLeft + dragData.containerDiffX;\n        dragData.top = currentTop + dragData.containerDiffY;\n        dragContainer.appendChild(element);\n        setStyles(element, {transform: getTranslateString(dragData.left, dragData.top)});\n      }\n\n    }\n\n    // Set drag class and bind scrollers.\n    addClass(element, settings.itemDraggingClass);\n    drag.bindScrollListeners();\n\n    // Emit dragStart event.\n    grid._emit(evDragStart, item, event);\n\n    return drag;\n\n  };\n\n  /**\n   * Drag move handler.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @param {Object} event\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.onMove = function (event) {\n\n    var drag = this;\n    var item = drag.getItem();\n\n    // If item is not active, reset drag.\n    if (!item._isActive) {\n      return drag.stop();\n    }\n\n    var element = item._element;\n    var grid = drag.getGrid();\n    var settings = grid._settings;\n    var dragData = drag._data;\n    var axis = settings.dragAxis;\n    var xDiff = event.deltaX - dragData.currentEvent.deltaX;\n    var yDiff = event.deltaY - dragData.currentEvent.deltaY;\n\n    rafLoop.add(rafQueueMove, item._id, function () {\n\n      // Update current event.\n      dragData.currentEvent = event;\n\n      // Update horizontal position data.\n      if (axis !== 'y') {\n        dragData.left += xDiff;\n        dragData.gridX += xDiff;\n        dragData.elementClientX += xDiff;\n      }\n\n      // Update vertical position data.\n      if (axis !== 'x') {\n        dragData.top += yDiff;\n        dragData.gridY += yDiff;\n        dragData.elementClientY += yDiff;\n      }\n\n      // Overlap handling.\n      settings.dragSort && drag._checkSortOverlap();\n\n    }, function () {\n\n      // Update element's translateX/Y values.\n      setStyles(element, {transform: getTranslateString(dragData.left, dragData.top)});\n\n      // Emit dragMove event.\n      grid._emit(evDragMove, item, event);\n\n    });\n\n    return drag;\n\n  };\n\n  /**\n   * Drag scroll handler.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @param {Object} event\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.onScroll = function (event) {\n\n    var drag = this;\n    var item = drag.getItem();\n    var element = item._element;\n    var grid = drag.getGrid();\n    var settings = grid._settings;\n    var axis = settings.dragAxis;\n    var dragData = drag._data;\n    var gridContainer = grid._element;\n    var elementRect;\n    var xDiff;\n    var yDiff;\n    var offsetDiff;\n\n    rafLoop.add(rafQueueScroll, item._id, function () {\n\n      // Calculate element's rect and x/y diff.\n      elementRect = element.getBoundingClientRect();\n      xDiff = dragData.elementClientX - elementRect.left;\n      yDiff = dragData.elementClientY - elementRect.top;\n\n      // Update container diff.\n      if (dragData.container !== gridContainer) {\n        offsetDiff = getOffsetDiff(dragData.containingBlock, gridContainer);\n        dragData.containerDiffX = offsetDiff.left;\n        dragData.containerDiffY = offsetDiff.top;\n      }\n\n      // Update horizontal position data.\n      if (axis !== 'y') {\n        dragData.left += xDiff;\n        dragData.gridX = dragData.left - dragData.containerDiffX;\n      }\n\n      // Update vertical position data.\n      if (axis !== 'x') {\n        dragData.top += yDiff;\n        dragData.gridY = dragData.top - dragData.containerDiffY;\n      }\n\n      // Overlap handling.\n      settings.dragSort && drag._checkSortOverlap();\n\n    }, function () {\n\n      // Update element's translateX/Y values.\n      setStyles(element, {transform: getTranslateString(dragData.left, dragData.top)});\n\n      // Emit dragScroll event.\n      grid._emit(evDragScroll, item, event);\n\n    });\n\n    return drag;\n\n  };\n\n  /**\n   * Drag end handler.\n   *\n   * @public\n   * @memberof ItemDrag.prototype\n   * @param {Object} event\n   * @returns {ItemDrag}\n   */\n  ItemDrag.prototype.onEnd = function (event) {\n\n    var drag = this;\n    var item = drag.getItem();\n    var element = item._element;\n    var grid = drag.getGrid();\n    var settings = grid._settings;\n    var dragData = drag._data;\n    var release = item._release;\n\n    // If item is not active, reset drag.\n    if (!item._isActive) {\n      return drag.stop();\n    }\n\n    // Cancel raf loop actions.\n    drag.cancelRafLoop();\n\n    // Finish currently queued overlap check.\n    settings.dragSort && drag._checkSortOverlap('finish');\n\n    // Remove scroll listeners.\n    drag.unbindScrollListeners();\n\n    // Setup release data.\n    release.containerDiffX = dragData.containerDiffX;\n    release.containerDiffY = dragData.containerDiffY;\n\n    // Reset drag data.\n    drag.reset();\n\n    // Remove drag classname from element.\n    removeClass(element, settings.itemDraggingClass);\n\n    // Emit dragEnd event.\n    grid._emit(evDragEnd, item, event);\n\n    // Finish up the migration process or start the release process.\n    drag._isMigrating ? drag.finishMigration() : release.start();\n\n    return drag;\n\n  };\n\n  /**\n   * Helpers - Generic\n   * *****************\n   */\n\n  /**\n   * Normalize array index. Basically this function makes sure that the provided\n   * array index is within the bounds of the provided array and also transforms\n   * negative index to the matching positive index.\n   *\n   * @private\n   * @param {Array} array\n   * @param {Number} index\n   * @param {Boolean} isMigration\n   */\n  function normalizeArrayIndex(array, index, isMigration) {\n\n    var length = array.length;\n    var maxIndex = Math.max(0, isMigration ? length : length - 1);\n\n    return index > maxIndex ? maxIndex :\n      index < 0 ? Math.max(maxIndex + index + 1, 0) :\n      index;\n\n  }\n\n  /**\n   * Swap array items.\n   *\n   * @private\n   * @param {Array} array\n   * @param {Number} index\n   *   - Index (positive or negative) of the item that will be swapped.\n   * @param {Number} withIndex\n   *   - Index (positive or negative) of the other item that will be swapped.\n   */\n  function arraySwap(array, index, withIndex) {\n\n    // Make sure the array has two or more items.\n    if (array.length < 2) {\n      return;\n    }\n\n    // Normalize the indices.\n    var indexA = normalizeArrayIndex(array, index);\n    var indexB = normalizeArrayIndex(array, withIndex);\n    var temp;\n\n    // Swap the items.\n    if (indexA !== indexB) {\n      temp = array[indexA];\n      array[indexA] = array[indexB];\n      array[indexB] = temp;\n    }\n\n  }\n\n  /**\n   * Move array item to another index.\n   *\n   * @private\n   * @param {Array} array\n   * @param {Number} fromIndex\n   *   - Index (positive or negative) of the item that will be moved.\n   * @param {Number} toIndex\n   *   - Index (positive or negative) where the item should be moved to.\n   */\n  function arrayMove(array, fromIndex, toIndex) {\n\n    // Make sure the array has two or more items.\n    if (array.length < 2) {\n      return;\n    }\n\n    // Normalize the indices.\n    var from = normalizeArrayIndex(array, fromIndex);\n    var to = normalizeArrayIndex(array, toIndex);\n\n    // Add target item to the new position.\n    if (from !== to) {\n      array.splice(to, 0, array.splice(from, 1)[0]);\n    }\n\n  }\n\n  /**\n   * Returns a new duplicate free version of the provided array.\n   *\n   * @private\n   * @param {Array} array\n   * @returns {Array}\n   */\n  function arrayUnique(array) {\n\n    var ret = [];\n    var len = array.length;\n    var i;\n\n    if (len) {\n      ret[0] = array[0];\n      for (i = 1; i < len; i++) {\n        if (ret.indexOf(array[i]) < 0) {\n          ret.push(array[i]);\n        }\n      }\n    }\n\n    return ret;\n\n  }\n\n  /**\n   * Check if a value is a plain object.\n   *\n   * @private\n   * @param {*} val\n   * @returns {Boolean}\n   */\n  function isPlainObject(val) {\n\n    return typeof val === 'object' && Object.prototype.toString.call(val) === '[object Object]';\n\n  }\n\n  /**\n   * Check if a value is a node list\n   *\n   * @private\n   * @param {*} val\n   * @returns {Boolean}\n   */\n  function isNodeList(val) {\n\n    var type = Object.prototype.toString.call(val);\n    return type === '[object HTMLCollection]' || type === '[object NodeList]';\n\n  }\n\n  /**\n   * Merge two objects recursively (deep merge). The source object's properties\n   * are merged to the target object.\n   *\n   * @private\n   * @param {Object} target\n   *   - The target object.\n   * @param {Object} source\n   *   - The source object.\n   * @returns {Object} Returns the target object.\n   */\n  function mergeObjects(target, source) {\n\n    // Loop through the surce object's props.\n    Object.keys(source).forEach(function (propName) {\n\n      var isObject = isPlainObject(source[propName]);\n\n      // If target and source values are both objects, merge the objects and\n      // assign the merged value to the target property.\n      if (isPlainObject(target[propName]) && isObject) {\n        target[propName] = mergeObjects({}, target[propName]);\n        target[propName] = mergeObjects(target[propName], source[propName]);\n      }\n\n      // Otherwise set the source object's value to target object and make sure\n      // that object and array values are cloned and directly assigned.\n      else {\n        target[propName] = isObject ? mergeObjects({}, source[propName]) :\n          Array.isArray(source[propName]) ? source[propName].concat() :\n          source[propName];\n      }\n\n    });\n\n    return target;\n\n  }\n\n  /**\n   * Insert an item or an array of items to array to a specified index. Mutates\n   * the array. The index can be negative in which case the items will be added\n   * to the end of the array.\n   *\n   * @private\n   * @param {Array} array\n   * @param {*} items\n   * @param {Number} [index=-1]\n   */\n  function insertItemsToArray(array, items, index) {\n\n    var targetIndex = typeof index === typeNumber ? index : -1;\n    array.splice.apply(array, [targetIndex < 0 ? array.length - targetIndex + 1 : targetIndex, 0].concat(items));\n\n  }\n\n  /**\n   * Returns a function, that, as long as it continues to be invoked, will not\n   * be triggered. The function will be called after it stops being called for\n   * N milliseconds. The returned function accepts one argument which, when\n   * being \"finish\", calls the debounced function immediately if it is currently\n   * waiting to be called, and when being \"cancel\" cancels the currently queued\n   * function call.\n   *\n   * @private\n   * @param {Function} fn\n   * @param {Number} wait\n   * @returns {Function}\n   */\n  function debounce(fn, wait) {\n\n    var timeout;\n    var actionCancel = 'cancel';\n    var actionFinish = 'finish';\n\n    return wait > 0 ? function (action) {\n\n      if (timeout !== undefined) {\n        timeout = global.clearTimeout(timeout);\n        if (action === actionFinish) {\n          fn();\n        }\n      }\n\n      if (action !== actionCancel && action !== actionFinish) {\n        timeout = global.setTimeout(function () {\n          timeout = undefined;\n          fn();\n        }, wait);\n      }\n\n    } : function (action) {\n\n      if (action !== actionCancel) {\n        fn();\n      }\n\n    };\n\n  }\n\n  /**\n   * Returns a raf loop queue system that allows pushing callbacks to either\n   * the read queue or the write queue.\n   *\n   * @private\n   * @returns {Object}\n   */\n  function createRafLoop() {\n\n    var nextTick = null;\n    var queue = [];\n    var map = {};\n    var raf = (global.requestAnimationFrame\n      || global.webkitRequestAnimationFrame\n      || global.mozRequestAnimationFrame\n      || global.msRequestAnimationFrame\n      || function (cb) {\n        return global.setTimeout(cb, 16);\n      }\n    ).bind(global);\n\n    function add(type, id, readCallback, writeCallback) {\n\n      // First, let's check if an item has been added to the queues with the\n      // same id and remove it.\n      var currentIndex = queue.indexOf(type + id);\n      if (currentIndex > -1) {\n        queue.splice(currentIndex, 1);\n      }\n\n      // Add all move/scroll event callbacks to the beginning of the queue\n      // and other callbacks to the end of the queue.\n      type === rafQueueMove || type === rafQueueScroll ? queue.unshift(type + id) : queue.push(type + id);\n      map[type + id] = [readCallback, writeCallback];\n\n      // Finally, let's kickstart the next tick if it is not running yet.\n      !nextTick && (nextTick = raf(flush));\n\n    }\n\n    function cancel(type, id) {\n\n      // Let's check if an item has been added to the queue with the id and\n      // if so -> remove it.\n      var currentIndex = queue.indexOf(type + id);\n      if (currentIndex > -1) {\n        queue.splice(currentIndex, 1);\n        map[type + id] = undefined;\n      }\n\n    }\n\n    function flush() {\n\n      var maxBatchSize = +Grid._maxRafBatchSize || 100;\n      var batch = queue.splice(0, Math.min(maxBatchSize, queue.length));\n      var batchMap = {};\n      var i;\n\n      // Reset ticker.\n      nextTick = null;\n\n      // Create batch map and clear map items.\n      for (i = 0; i < batch.length; i++) {\n        batchMap[batch[i]] = map[batch[i]];\n        map[batch[i]] = undefined;\n      }\n\n      // Process read callbacks.\n      for (i = 0; i < batch.length; i++) {\n        batchMap[batch[i]][0]();\n      }\n\n      // Process write callbacks.\n      for (i = 0; i < batch.length; i++) {\n        batchMap[batch[i]][1]();\n      }\n\n      // Restart the ticker if needed.\n      if (!nextTick && queue.length) {\n        nextTick = raf(flush);\n      }\n\n    }\n\n    return {\n      add: add,\n      cancel: cancel\n    };\n\n  }\n\n  /**\n   * Helpers - DOM utils\n   * *******************\n   */\n\n  /**\n   * Transforms a camel case style property to kebab case style property.\n   *\n   * @private\n   * @param {String} string\n   * @returns {String}\n   */\n  function getStyleName(string) {\n\n    return string.replace(/([A-Z])/g, '-$1').toLowerCase();\n\n  }\n\n  /**\n   * Returns the computed value of an element's style property as a string.\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @param {String} style\n   * @returns {String}\n   */\n  function getStyle(element, style) {\n\n    return global.getComputedStyle(element, null).getPropertyValue(style === 'transform' ? transform.styleName || style : style);\n\n  }\n\n  /**\n   * Returns the computed value of an element's style property transformed into\n   * a float value.\n   *\n   * @private\n   * @param {HTMLElement} el\n   * @param {String} style\n   * @returns {Number}\n   */\n  function getStyleAsFloat(el, style) {\n\n    return parseFloat(getStyle(el, style)) || 0;\n\n  }\n\n  /**\n   * Returns the element's computed translateX/Y value as a float. Assumes that\n   * the translate value is defined as pixels.\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @param {String} axis\n   *   - \"x\" or \"y\".\n   * @returns {Number}\n   */\n  function getTranslateAsFloat(element, axis) {\n\n    return parseFloat((getStyle(element, 'transform') || '').replace('matrix(', '').split(',')[axis === 'x' ? 4 : 5]) || 0;\n\n  }\n\n  /**\n   * Transform translateX and translateY value into CSS transform style\n   * property's value.\n   *\n   * @private\n   * @param {Number} translateX\n   * @param {Number} translateY\n   * @returns {String}\n   */\n  function getTranslateString(translateX, translateY) {\n\n    return 'translateX(' + translateX + 'px) translateY(' + translateY + 'px)';\n\n  }\n\n  /**\n   * Get current values of the provided styles definition object.\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {Object}\n   */\n  function getCurrentStyles(element, styles) {\n\n    var current = {};\n    var keys = Object.keys(styles);\n    var i;\n\n    for (i = 0; i < keys.length; i++) {\n      current[keys[i]] = getStyle(element, getStyleName(keys[i]));\n    }\n\n    return current;\n\n  }\n\n  /**\n   * Set inline styles to an element.\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   */\n  function setStyles(element, styles) {\n\n    var props = Object.keys(styles);\n    var i;\n\n    for (i = 0; i < props.length; i++) {\n      element.style[props[i] === 'transform' && transform ? transform.propName : props[i]] = styles[props[i]];\n    }\n\n  }\n\n  /**\n   * Add class to an element.\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @param {String} className\n   */\n  function addClass(element, className) {\n\n    if (element.classList) {\n      element.classList.add(className);\n    }\n    else if (!elementMatches(element, '.' + className)) {\n      element.className += ' ' + className;\n    }\n\n  }\n\n  /**\n   * Remove class name from an element.\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @param {String} className\n   */\n  function removeClass(element, className) {\n\n    if (element.classList) {\n      element.classList.remove(className);\n    }\n    else if (elementMatches(element, '.' + className)) {\n      element.className = (' ' + element.className + ' ').replace(' ' + className + ' ', ' ').trim();\n    }\n\n  }\n\n  /**\n   * Convert nodeList to array.\n   *\n   * @private\n   * @param {NodeList} nodeList\n   * @returns {HTMLElement[]}\n   */\n  function nodeListToArray(nodeList) {\n\n    return [].slice.call(nodeList);\n\n  }\n\n  /**\n   * Checks the supported element.matches() method and returns a function that\n   * can be used to call the supported method.\n   *\n   * @private\n   * @returns {Function}\n   */\n  function getSupportedElementMatches() {\n\n    var p = Element.prototype;\n    var fn = p.matches || p.matchesSelector || p.webkitMatchesSelector || p.mozMatchesSelector || p.msMatchesSelector || p.oMatchesSelector;\n\n    return function (el, selector) {\n      return fn.call(el, selector);\n    };\n\n  }\n\n  /**\n   * Returns the supported style property's prefix, property name and style name\n   * or null if the style property is not supported. This is used for getting\n   * the supported transform.\n   *\n   * @private\n   * @param {String} style\n   * @returns {?Object}\n   */\n  function getSupportedStyle(style) {\n\n    var styleCap = style.charAt(0).toUpperCase() + style.slice(1);\n    var prefixes = ['', 'Webkit', 'Moz', 'O', 'ms'];\n    var prefix;\n    var propName;\n    var i;\n\n    for (i = 0; i < prefixes.length; i++) {\n      prefix = prefixes[i];\n      propName = prefix ? prefix + styleCap : style;\n      if (docElem.style[propName] !== undefined) {\n        prefix = prefix.toLowerCase();\n        return {\n          prefix: prefix,\n          propName: propName,\n          styleName: prefix ? '-' + prefix + '-' + style : style\n        };\n      }\n    }\n\n    return null;\n\n  }\n\n  /**\n   * Calculate the offset difference two elements.\n   *\n   * @private\n   * @param {HTMLElement} elemA\n   * @param {HTMLElement} elemB\n   * @param {Boolean} [compareContainingBlocks=false]\n   *   - When this is set to true the containing blocks of the provided elements\n   *     will be used for calculating the difference. Otherwise the provided\n   *     elements will be compared directly.\n   * @returns {Object}\n   */\n  function getOffsetDiff(elemA, elemB, compareContainingBlocks) {\n\n    if (elemA === elemB) {\n      return {\n        left: 0,\n        top: 0\n      };\n    }\n\n    if (compareContainingBlocks) {\n      elemA = getContainingBlock(elemA, true);\n      elemB = getContainingBlock(elemB, true);\n    }\n\n    var aOffset = getOffset(elemA, true);\n    var bOffset = getOffset(elemB, true);\n\n    return {\n      left: bOffset.left - aOffset.left,\n      top: bOffset.top - aOffset.top\n    };\n\n  }\n\n  /**\n   * Returns the element's document offset, which in practice means the vertical\n   * and horizontal distance between the element's northwest corner and the\n   * document's northwest corner.\n   *\n   * @private\n   * @param {(Document|Element|Window)} element\n   * @param {Boolean} [excludeElementBorders=false]\n   * @returns {Offset}\n   */\n  function getOffset(element, excludeElementBorders) {\n\n    var rect;\n    var ret = {\n      left: 0,\n      top: 0\n    };\n\n    // Document's offsets are always 0.\n    if (element === doc) {\n      return ret;\n    }\n\n    // Add viewport's scroll left/top to the respective offsets.\n    ret.left = global.pageXOffset || 0;\n    ret.top = global.pageYOffset || 0;\n\n    // Window's offsets are the viewport's scroll left/top values.\n    if (element.self === global.self) {\n      return ret;\n    }\n\n    // Add element's client rects to the offsets.\n    rect = element.getBoundingClientRect();\n    ret.left += rect.left;\n    ret.top += rect.top;\n\n    // Exclude element's borders from the offset if needed.\n    if (excludeElementBorders) {\n      ret.left += getStyleAsFloat(element, 'border-left-width');\n      ret.top += getStyleAsFloat(element, 'border-top-width');\n    }\n\n    return ret;\n\n  }\n\n  /**\n   * Returns an aabsolute positioned element's containing block, which is\n   * considered to be the closest ancestor element that the target element's\n   * positioning is relative to. Disclaimer: this only works as intended for\n   * abolute positioned elements.\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @param {Boolean} [isParent=false]\n   *   - When this is set to true the containing block checking is started from\n   *     the provided element. Otherwise the checking is started from the\n   *     provided element's parent element.\n   * @returns {(Document|Element)}\n   */\n  function getContainingBlock(element, isParent) {\n\n    // As long as the containing block is an element, static and not\n    // transformed, try to get the element's parent element and fallback to\n    // document. https://github.com/niklasramo/mezr/blob/0.6.1/mezr.js#L339\n    var ret = (isParent ? element : element.parentElement) || doc;\n    while (ret && ret !== doc && getStyle(ret, 'position') === 'static' && !isTransformed(ret)) {\n      ret = ret.parentElement || doc;\n    }\n\n    return ret;\n\n  }\n\n  /**\n   * Get element's scroll parents.\n   *\n   * Borrowed from jQuery UI library (and heavily modified):\n   * https://github.com/jquery/jquery-ui/blob/63448148a217da7e64c04b21a04982f0d6\n   * 4aabaa/ui/scroll-parent.js\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @returns {HTMLElement[]}\n   */\n  function getScrollParents(element) {\n\n    var ret = [];\n    var overflowRegex = /(auto|scroll)/;\n    var parent = element.parentNode;\n\n    // If transformed elements leak fixed elements.\n    if (transformLeaksFixed) {\n\n      // If the element is fixed it can not have any scroll parents.\n      if (getStyle(element, 'position') === 'fixed') {\n        return ret;\n      }\n\n      // Find scroll parents.\n      while (parent && parent !== doc && parent !== docElem) {\n        if (overflowRegex.test(getStyle(parent, 'overflow') + getStyle(parent, 'overflow-y') + getStyle(parent, 'overflow-x'))) {\n          ret.push(parent);\n        }\n        parent = getStyle(parent, 'position') === 'fixed' ? null : parent.parentNode;\n      }\n\n      // If parent is not fixed element, add window object as the last scroll\n      // parent.\n      parent !== null && ret.push(global);\n\n    }\n    // If fixed elements behave as defined in the W3C specification.\n    else {\n\n      // Find scroll parents.\n      while (parent && parent !== doc) {\n\n        // If the currently looped element is fixed ignore all parents that are\n        // not transformed.\n        if (getStyle(element, 'position') === 'fixed' && !isTransformed(parent)) {\n          parent = parent.parentNode;\n          continue;\n        }\n\n        // Add the parent element to return items if it is scrollable.\n        if (overflowRegex.test(getStyle(parent, 'overflow') + getStyle(parent, 'overflow-y') + getStyle(parent, 'overflow-x'))) {\n          ret.push(parent);\n        }\n\n        // Update element and parent references.\n        element = parent;\n        parent = parent.parentNode;\n\n      }\n\n      // If the last item is the root element, replace it with the global\n      // object (window). The root element scroll is propagated to the window.\n      if (ret[ret.length - 1] === docElem) {\n        ret[ret.length - 1] = global;\n      }\n\n      // Otherwise add global object (window) as the last scroll parent.\n      else {\n        ret.push(global);\n      }\n\n    }\n\n    return ret;\n\n  }\n\n  /**\n   * Detects if transformed elements leak fixed elements. According W3C\n   * transform rendering spec a transformed element should contain even fixed\n   * elements. Meaning that fixed elements are positioned relative to the\n   * closest transformed ancestor element instead of window. However, not every\n   * browser follows the spec (IE and older Firefox). So we need to test it.\n   * https://www.w3.org/TR/css3-2d-transforms/#transform-rendering\n   *\n   * Borrowed from Mezr (v0.6.1):\n   * https://github.com/niklasramo/mezr/blob/0.6.1/mezr.js#L607\n   *\n   * @private\n   * @returns {Boolean}\n   *   - Returns true if transformed elements leak fixed elements, false\n   *     otherwise.\n   */\n  function doesTransformLeakFixed() {\n\n    if (!transform) {\n      return true;\n    }\n\n    var elems = [0, 1].map(function (elem, isInner) {\n      elem = doc.createElement('div');\n      setStyles(elem, {\n        position: isInner ? 'fixed' : 'absolute',\n        display: 'block',\n        visibility: 'hidden',\n        left: isInner ? '0px' : '1px',\n        transform: 'none'\n      });\n      return elem;\n    });\n    var outer = body.appendChild(elems[0]);\n    var inner = outer.appendChild(elems[1]);\n    var left = inner.getBoundingClientRect().left;\n    setStyles(outer, {transform: 'scale(1)'});\n    var isLeaking = left === inner.getBoundingClientRect().left;\n    body.removeChild(outer);\n\n    return isLeaking;\n\n  }\n\n  /**\n   * Returns true if element is transformed, false if not. In practice the\n   * element's display value must be anything else than \"none\" or \"inline\" as\n   * well as have a valid transform value applied in order to be counted as a\n   * transformed element.\n   *\n   * Borrowed from Mezr (v0.6.1):\n   * https://github.com/niklasramo/mezr/blob/0.6.1/mezr.js#L661\n   *\n   * @private\n   * @param {HTMLElement} element\n   * @returns {Boolean}\n   */\n  function isTransformed(element) {\n\n    var transform = getStyle(element, 'transform');\n    var display = getStyle(element, 'display');\n\n    return transform !== 'none' && display !== 'inline' && display !== 'none';\n\n  }\n\n  /**\n   * Calculate how many percent the intersection area of two rectangles is from\n   * the maximum potential intersection area between the rectangles.\n   *\n   * @private\n   * @param {Rectangle} a\n   * @param {Rectangle} b\n   * @returns {Number}\n   *   - A number between 0-100.\n   */\n  function getRectOverlapScore(a, b) {\n\n    // Return 0 immediately if the rectangles do not overlap.\n    if (!muuriLayout.doRectsOverlap(a, b)) {\n      return 0;\n    }\n\n    // Calculate intersection area's width, height, max height and max width.\n    var width = Math.min(a.left + a.width, b.left + b.width) - Math.max(a.left, b.left);\n    var height = Math.min(a.top + a.height, b.top + b.height) - Math.max(a.top, b.top);\n    var maxWidth = Math.min(a.width, b.width);\n    var maxHeight = Math.min(a.height, b.height);\n\n    return (width * height) / (maxWidth * maxHeight) * 100;\n\n  }\n\n  /**\n   * Helpers - Item sort utilities\n   * *****************************\n   */\n\n  /**\n   * Helper for the sort method to generate mapped version of the items array\n   * than contains reference to the item indices.\n   *\n   * @private\n   * @param {Item[]} items\n   * @returns {Object}\n   */\n  function getItemIndexMap(items) {\n\n    var ret = {};\n    var i;\n\n    for (i = 0; i < items.length; i++) {\n      ret[items[i]._id] = i;\n    }\n\n    return ret;\n\n  }\n\n  /**\n   * Helper for the sort method to compare the indices of the items to enforce\n   * stable sort.\n   *\n   * @private\n   * @param {Item} itemA\n   * @param {Item} itemB\n   * @param {Boolean} isDescending\n   * @param {Object} indexMap\n   * @returns {Number}\n   */\n  function compareItemIndices(itemA, itemB, isDescending, indexMap) {\n\n    var indexA = indexMap[itemA._id];\n    var indexB = indexMap[itemB._id];\n    return isDescending ? indexB - indexA : indexA - indexB;\n\n  }\n\n  /**\n   * Helper for the sort method to compare the items based on the provided\n   * attributes.\n   *\n   * @private\n   * @param {Item} itemA\n   * @param {Item} itemB\n   * @param {Boolean} isDescending\n   * @param {Object} criterias\n   * @returns {Number}\n   */\n  function compareItems(itemA, itemB, isDescending, criterias) {\n\n    var ret = 0;\n    var criteriaName;\n    var criteriaOrder;\n    var valA;\n    var valB;\n    var i;\n\n    // Loop through the list of sort criterias.\n    for (i = 0; i < criterias.length; i++) {\n\n      // Get the criteria name, which should match an item's sort data key.\n      criteriaName = criterias[i][0];\n      criteriaOrder = criterias[i][1];\n\n      // Get items' cached sort values for the criteria. If the item has no sort\n      // data let's update the items sort data (this is a lazy load mechanism).\n      valA = (itemA._sortData ? itemA : itemA._refreshSortData())._sortData[criteriaName];\n      valB = (itemB._sortData ? itemB : itemB._refreshSortData())._sortData[criteriaName];\n\n      // Sort the items in descending order if defined so explicitly.\n      if (criteriaOrder === 'desc' || (!criteriaOrder && isDescending)) {\n        ret = valB < valA ? -1 : valB > valA ? 1 : 0;\n      }\n\n      // Otherwise sort items in ascending order.\n      else {\n        ret = valA < valB ? -1 : valA > valB ? 1 : 0;\n      }\n\n      // If we have -1 or 1 as the return value, let's return it immediately.\n      if (ret !== 0) {\n        return ret;\n      }\n\n    }\n\n    return ret;\n\n  }\n\n  /**\n   * Reorder an array of items based on another array of items.\n   *\n   * @private\n   * @param {Item[]} items\n   * @param {Item[]} refItems\n   * @returns {Item[]}\n   */\n  function sortItemsByReference(items, refItems) {\n\n    var newItems = [];\n    var currentItems = items.concat();\n    var item;\n    var currentIndex;\n    var i;\n\n    for (i = 0; i < refItems.length; i++) {\n      item = refItems[i];\n      currentIndex = currentItems.indexOf(item);\n      if (currentIndex > -1) {\n        newItems.push(item);\n        currentItems.splice(currentIndex, 1);\n      }\n    }\n\n    items.splice.apply(items, [0, items.length].concat(newItems).concat(currentItems));\n\n    return items;\n\n  }\n\n  /**\n   * Check if a point (coordinate) is within a rectangle.\n   *\n   * @private\n   * @param {Number} x\n   * @param {Number} y\n   * @param {Rectangle} rect\n   * @return {Boolean}\n   */\n  function isPointWithinRect(x, y, rect) {\n\n    return rect.width\n      && rect.height\n      && x >= rect.left\n      && x < (rect.left + rect.width)\n      && y >= rect.top\n      && y < (rect.top + rect.height);\n\n  }\n\n  /**\n   * Helpers - Muuri\n   * ***************\n   */\n\n  /**\n   * Show or hide Grid instance's items.\n   *\n   * @private\n   * @param {Grid} inst\n   * @param {String} method\n   *   - \"show\" or \"hide\".\n   * @param {(GridMultiItemQuery|GridItemState)} items\n   * @param {Object} [options]\n   * @param {Boolean} [options.instant=false]\n   * @param {(ShowCallback|HideCallback)} [options.onFinish]\n   * @param {(Boolean|LayoutCallback|String)} [options.layout=true]\n   * @returns {Grid}\n   */\n  function gridShowHideHandler(inst, method, items, options) {\n\n    var targetItems = inst.getItems(items);\n    var opts = options || {};\n    var isInstant = opts.instant === true;\n    var callback = opts.onFinish;\n    var layout = opts.layout ? opts.layout : opts.layout === undefined;\n    var counter = targetItems.length;\n    var isShow = method === 'show';\n    var startEvent = isShow ? evShowStart : evHideStart;\n    var endEvent = isShow ? evShowEnd : evHideEnd;\n    var needsLayout = false;\n    var completedItems = [];\n    var hiddenItems = [];\n    var item;\n    var i;\n\n    // If there are no items call the callback, but don't emit any events.\n    if (!counter) {\n      if (typeof callback === typeFunction) {\n        callback(targetItems);\n      }\n    }\n\n    // Otherwise if we have some items let's dig in.\n    else {\n\n      // Emit showStart/hideStart event.\n      inst._emit(startEvent, targetItems.concat());\n\n      // Show/hide items.\n      for (i = 0; i < targetItems.length; i++) {\n\n        item = targetItems[i];\n\n        // If inactive item is shown or active item is hidden we need to do\n        // layout.\n        if ((isShow && !item._isActive) || (!isShow && item._isActive)) {\n          needsLayout = true;\n        }\n\n        // If inactive item is shown we also need to do some special hackery to\n        // make the item not animate it's next positioning (layout).\n        if (isShow && !item._isActive) {\n          item._skipNextLayoutAnimation = true;\n        }\n\n        // If the a hidden item is being shown we need to refresh the item's\n        // dimensions.\n        isShow && item._isHidden && hiddenItems.push(item);\n\n        // Show/hide the item.\n        item['_' + method](isInstant, function (interrupted, item) {\n\n          // If the current item's animation was not interrupted add it to the\n          // completedItems array.\n          if (!interrupted) {\n            completedItems.push(item);\n          }\n\n          // If all items have finished their animations call the callback\n          // and emit showEnd/hideEnd event.\n          if (--counter < 1) {\n            if (typeof callback === typeFunction) {\n              callback(completedItems.concat());\n            }\n            inst._emit(endEvent, completedItems.concat());\n          }\n\n        });\n\n      }\n\n      // Refresh hidden items.\n      hiddenItems.length && inst.refreshItems(hiddenItems);\n\n      // Layout if needed.\n      if (needsLayout && layout) {\n        inst.layout(layout === 'instant', typeof layout === typeFunction ? layout : undefined);\n      }\n\n    }\n\n    return inst;\n\n  }\n\n  /**\n   * Returns an object which contains start and stop methods for item's\n   * show/hide process.\n   *\n   * @param {String} type\n   * @param {Object} settings\n   * @returns {Object}\n   */\n  function getItemVisibilityHandler(type, settings) {\n\n    var isShow = type === 'show';\n    var duration = parseInt(isShow ? settings.showDuration : settings.hideDuration) || 0;\n    var easing = (isShow ? settings.showEasing : settings.hideEasing) || 'ease';\n    var styles = isShow ? settings.visibleStyles : settings.hiddenStyles;\n    var isEnabled = duration > 0;\n    var currentStyles;\n\n    styles = isPlainObject(styles) ? styles : null;\n\n    return {\n      start: function (item, instant, onFinish) {\n        if (!styles) {\n          onFinish && onFinish();\n        }\n        else {\n          rafLoop.cancel(rafQueueVisibility, item._id);\n          if (!isEnabled || instant) {\n            if (item._animateChild.isAnimating()) {\n              item._animateChild.stop(styles);\n            }\n            else {\n              setStyles(item._child, styles);\n            }\n            onFinish && onFinish();\n          }\n          else {\n            rafLoop.add(rafQueueVisibility, item._id, function () {\n              currentStyles = getCurrentStyles(item._child, styles);\n            }, function () {\n              item._animateChild.start(currentStyles, styles, {\n                duration: duration,\n                easing: easing,\n                onFinish: onFinish\n              });\n            });\n          }\n        }\n      },\n      stop: function (item, targetStyles) {\n        rafLoop.cancel(rafQueueVisibility, item._id);\n        item._animateChild.stop(targetStyles);\n      }\n    };\n\n  }\n\n  /**\n   * Get target grid for the default drag sort predicate.\n   *\n   * @private\n   * @param {Item} item\n   * @param {Grid} rootGrid\n   * @param {Rectangle} itemRect\n   * @param {Number} threshold\n   * @returns {?Grid}\n   */\n  function getTargetGrid(item, rootGrid, itemRect, threshold) {\n\n    var ret = null;\n    var dragSort = rootGrid._settings.dragSort;\n    var grids = dragSort === true ? [rootGrid] : dragSort.call(rootGrid, item);\n    var bestScore = -1;\n    var gridScore;\n    var grid;\n    var i;\n\n    // Return immediately if there are no grids.\n    if (!Array.isArray(grids)) {\n      return ret;\n    }\n\n    // Loop through the grids and get the best match.\n    for (i = 0; i < grids.length; i++) {\n\n      grid = grids[i];\n\n      // Filter out all destroyed grids.\n      if (grid._isDestroyed) {\n        continue;\n      }\n\n      // We need to update the grid's offset since it may have changed during\n      // scrolling. This could be left as problem for the userland, but it's\n      // much nicer this way. One less hack for the user to worry about =)\n      grid._refreshDimensions();\n\n      // Check how much dragged element overlaps the container element.\n      gridScore = getRectOverlapScore(itemRect, {\n        width: grid._width,\n        height: grid._height,\n        left: grid._left,\n        top: grid._top\n      });\n\n      // Check if this grid is the best match so far.\n      if (gridScore > threshold && gridScore > bestScore) {\n        bestScore = gridScore;\n        ret = grid;\n      }\n\n    }\n\n    return ret;\n\n  }\n\n  /**\n   * Process item's callback queue.\n   *\n   * @private\n   * @param {Function[]} queue\n   * @param {Boolean} interrupted\n   * @param {Item} instance\n   */\n  function processQueue(queue, interrupted, instance) {\n\n    var callbacks = queue.splice(0, queue.length);\n    var i;\n\n    for (i = 0; i < callbacks.length; i++) {\n      callbacks[i](interrupted, instance);\n    }\n\n  }\n\n  /**\n   * Check if item is in specific state.\n   *\n   * @private\n   * @param {Item} item\n   * @param {GridItemState} state\n   *  - Accepted values are: \"active\", \"inactive\", \"visible\", \"hidden\",\n   *    \"showing\", \"hiding\", \"positioning\", \"dragging\", \"releasing\" and\n   *    \"migrating\".\n   * @returns {Boolean}\n   */\n  function isItemInState(item, state) {\n\n    var methodName;\n\n    if (state === 'inactive') {\n      return !item.isActive();\n    }\n\n    if (state === 'hidden') {\n      return !item.isVisible();\n    }\n\n    methodName = 'is' + state.charAt(0).toUpperCase() + state.slice(1);\n\n    return typeof item[methodName] === typeFunction ? item[methodName]() : false;\n\n  }\n\n  /**\n   * Prevent default.\n   *\n   * @private\n   * @param {Object} e\n   */\n  function preventDefault(e) {\n\n    if (e.preventDefault) {\n      e.preventDefault();\n    }\n\n  }\n\n  /**\n   * Merge default settings with user settings. The returned object is a new\n   * object with merged values. The merging is a deep merge meaning that all\n   * objects and arrays within the provided settings objects will be also merged\n   * so that modifying the values of the settings object will have no effect on\n   * the returned object.\n   *\n   * @private\n   * @param {Object} defaultSettings\n   * @param {Object} [userSettings]\n   * @returns {Object} Returns a new object.\n   */\n  function mergeSettings(defaultSettings, userSettings) {\n\n    // Create a fresh copy of default settings.\n    var ret = mergeObjects({}, defaultSettings);\n\n    // Merge user settings to default settings.\n    ret = userSettings ? mergeObjects(ret, userSettings) : ret;\n\n    // Handle visible/hidden styles manually so that the whole object is\n    // overriden instead of the props.\n    ret.visibleStyles = (userSettings || {}).visibleStyles || (defaultSettings || {}).visibleStyles;\n    ret.hiddenStyles = (userSettings || {}).hiddenStyles || (defaultSettings || {}).hiddenStyles;\n\n    return ret;\n\n  }\n\n  /**\n   * Resolver for default drag start predicate function.\n   *\n   * @private\n   * @param {Item} item\n   * @param {Object} event\n   * @returns {Boolean}\n   */\n  function dragStartPredicateResolve(item, event) {\n\n    var predicate = item._drag._startPredicateData;\n    var pointer = event.changedPointers[0];\n    var pageX = pointer && pointer.pageX || 0;\n    var pageY = pointer && pointer.pageY || 0;\n    var handleRect;\n\n    // If the moved distance is smaller than the threshold distance or there is\n    // some delay left, ignore this predicate cycle.\n    if (event.distance < predicate.distance || predicate.delay) {\n      return;\n    }\n\n    // Get handle rect.\n    handleRect = predicate.handleElement.getBoundingClientRect();\n\n    // Reset predicate data.\n    dragStartPredicateReset(item);\n\n    // If the cursor is still within the handle let's start the drag.\n    return isPointWithinRect(pageX, pageY, {\n      width: handleRect.width,\n      height: handleRect.height,\n      left: handleRect.left + (global.pageXOffset || 0),\n      top: handleRect.top + (global.pageYOffset || 0)\n    });\n\n  }\n\n  /**\n   * Reset for default drag start predicate function.\n   *\n   * @private\n   * @param {Item} item\n   */\n  function dragStartPredicateReset(item) {\n\n    var predicate = item._drag._startPredicateData;\n\n    if (predicate) {\n      if (predicate.delayTimer) {\n        predicate.delayTimer = global.clearTimeout(predicate.delayTimer);\n      }\n      item._drag._startPredicateData = null;\n    }\n\n  }\n\n  /**\n   * Default layout algorithm\n   * ************************\n   */\n\n  /*!\n    * muuriLayout v0.5.4\n    * Copyright (c) 2016 Niklas Rm <inramo@gmail.com>\n    * Released under the MIT license\n    */\n\n  /**\n   * The default Muuri layout algorithm. Based on MAXRECTS approach as described\n   * by Jukka Jylnki in his survey: \"A Thousand Ways to Pack the Bin - A\n   * Practical Approach to Two-Dimensional Rectangle Bin Packing.\".\n   *\n   * This algorithm is intentionally separated from the rest of the codebase,\n   * because it is it's own library with a different copyright than the rest of\n   * the software. It's also MIT licensed so no worries there. This is intended\n   * to be used as Muuri's default layout algorithm and goes hand in hand with\n   * Muuri's core development.\n   *\n   * @private\n   * @param {Item[]} items\n   * @param {Number} width\n   * @param {Number} height\n   * @param {Object} options\n   * @param {Boolean} [options.fillGaps=false]\n   * @param {Boolean} [options.horizontal=false]\n   * @param {Boolean} [options.alignRight=false]\n   * @param {Boolean} [options.alignBottom=false]\n   * @returns {LayoutData}\n   */\n  function muuriLayout(items, width, height, options) {\n\n    var fillGaps = !!options.fillGaps;\n    var isHorizontal = !!options.horizontal;\n    var alignRight = !!options.alignRight;\n    var alignBottom = !!options.alignBottom;\n    var rounding = !!options.rounding;\n    var layout = {\n      slots: {},\n      width: isHorizontal ? 0 : (rounding ? Math.round(width) : width),\n      height: !isHorizontal ? 0 : (rounding ? Math.round(height) : height),\n      setWidth: isHorizontal,\n      setHeight: !isHorizontal\n    };\n    var freeSlots = [];\n    var slotIds;\n    var slotData;\n    var slot;\n    var item;\n    var itemWidth;\n    var itemHeight;\n    var i;\n\n    // No need to go further if items do not exist.\n    if (!items.length) {\n      return layout;\n    }\n\n    // Find slots for items.\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n      itemWidth = item._width + item._margin.left + item._margin.right;\n      itemHeight = item._height + item._margin.top + item._margin.bottom;\n      if (rounding) {\n        itemWidth = Math.round(itemWidth);\n        itemHeight = Math.round(itemHeight);\n      }\n      slotData = muuriLayout.getSlot(layout, freeSlots, itemWidth, itemHeight, !isHorizontal, fillGaps);\n      slot = slotData[0];\n      freeSlots = slotData[1];\n      if (isHorizontal) {\n        layout.width = Math.max(layout.width, slot.left + slot.width);\n      }\n      else {\n        layout.height = Math.max(layout.height, slot.top + slot.height);\n      }\n      layout.slots[item._id] = slot;\n    }\n\n    // If the alignment is set to right or bottom, we need to adjust the\n    // results.\n    if (alignRight || alignBottom) {\n      slotIds = Object.keys(layout.slots);\n      for (i = 0; i < slotIds.length; i++) {\n        slot = layout.slots[slotIds[i]];\n        if (alignRight) {\n          slot.left = layout.width - (slot.left + slot.width);\n        }\n        if (alignBottom) {\n          slot.top = layout.height - (slot.top + slot.height);\n        }\n      }\n    }\n\n    return layout;\n\n  }\n\n  /**\n   * Calculate position for the layout item. Returns the left and top position\n   * of the item in pixels.\n   *\n   * @private\n   * @memberof muuriLayout\n   * @param {Layout} layout\n   * @param {Array} slots\n   * @param {Number} itemWidth\n   * @param {Number} itemHeight\n   * @param {Boolean} vertical\n   * @param {Boolean} fillGaps\n   * @returns {Array}\n   */\n  muuriLayout.getSlot = function (layout, slots, itemWidth, itemHeight, vertical, fillGaps) {\n\n    var leeway = 0.001;\n    var newSlots = [];\n    var item = {\n      left: null,\n      top: null,\n      width: itemWidth,\n      height: itemHeight\n    };\n    var slot;\n    var potentialSlots;\n    var ignoreCurrentSlots;\n    var i;\n    var ii;\n\n    // Try to find a slot for the item.\n    for (i = 0; i < slots.length; i++) {\n      slot = slots[i];\n      if (item.width <= (slot.width + leeway) && item.height <= (slot.height + leeway)) {\n        item.left = slot.left;\n        item.top = slot.top;\n        break;\n      }\n    }\n\n    // If no slot was found for the item.\n    if (item.left === null) {\n\n      // Position the item in to the bottom left (vertical mode) or top right\n      // (horizontal mode) of the grid.\n      item.left = vertical ? 0 : layout.width;\n      item.top = vertical ? layout.height : 0;\n\n      // If gaps don't needs filling do not add any current slots to the new\n      // slots array.\n      if (!fillGaps) {\n        ignoreCurrentSlots = true;\n      }\n\n    }\n\n    // In vertical mode, if the item's bottom overlaps the grid's bottom.\n    if (vertical && (item.top + item.height) > layout.height) {\n\n      // If item is not aligned to the left edge, create a new slot.\n      if (item.left > 0) {\n        newSlots.push({\n          left: 0,\n          top: layout.height,\n          width: item.left,\n          height: Infinity\n        });\n      }\n\n      // If item is not aligned to the right edge, create a new slot.\n      if ((item.left + item.width) < layout.width) {\n        newSlots.push({\n          left: item.left + item.width,\n          top: layout.height,\n          width: layout.width - item.left - item.width,\n          height: Infinity\n        });\n      }\n\n      // Update grid height.\n      layout.height = item.top + item.height;\n\n    }\n\n    // In horizontal mode, if the item's right overlaps the grid's right edge.\n    if (!vertical && (item.left + item.width) > layout.width) {\n\n      // If item is not aligned to the top, create a new slot.\n      if (item.top > 0) {\n        newSlots.push({\n          left: layout.width,\n          top: 0,\n          width: Infinity,\n          height: item.top\n        });\n      }\n\n      // If item is not aligned to the bottom, create a new slot.\n      if ((item.top + item.height) < layout.height) {\n        newSlots.push({\n          left: layout.width,\n          top: item.top + item.height,\n          width: Infinity,\n          height: layout.height - item.top - item.height\n        });\n      }\n\n      // Update grid width.\n      layout.width = item.left + item.width;\n\n    }\n\n    // Clean up the current slots making sure there are no old slots that\n    // overlap with the item. If an old slot overlaps with the item, split it\n    // into smaller slots if necessary.\n    for (i = fillGaps ? 0 : ignoreCurrentSlots ? slots.length : i; i < slots.length; i++) {\n      potentialSlots = muuriLayout.splitRect(slots[i], item);\n      for (ii = 0; ii < potentialSlots.length; ii++) {\n        slot = potentialSlots[ii];\n        // Let's make sure here that we have a big enough slot\n        // (width/height > 0.49px) and also let's make sure that the slot is\n        // within the boundaries of the grid.\n        if (slot.width > 0.49 && slot.height > 0.49 && ((vertical && slot.top < layout.height) || (!vertical && slot.left < layout.width))) {\n          newSlots.push(slot);\n        }\n      }\n    }\n\n    // Sanitize new slots.\n    if (newSlots.length) {\n      newSlots = muuriLayout.purgeRects(newSlots).sort(vertical ? muuriLayout.sortRectsTopLeft : muuriLayout.sortRectsLeftTop);\n    }\n\n    // Return the item and updated slots data.\n    return [item, newSlots];\n\n  };\n\n  /**\n   * Punch a hole into a rectangle and split the remaining area into smaller\n   * rectangles (4 at max).\n   *\n   * @private\n   * @param {Rectangle} rect\n   * @param {Rectangle} hole\n   * returns {Rectangle[]}\n   */\n  muuriLayout.splitRect = function (rect, hole) {\n\n    var ret = [];\n\n    // If the rect does not overlap with the hole add rect to the return data as\n    // is.\n    if (!muuriLayout.doRectsOverlap(rect, hole)) {\n      return [{\n        left: rect.left,\n        top: rect.top,\n        width: rect.width,\n        height: rect.height\n      }];\n    }\n\n    // Left split.\n    if (rect.left < hole.left) {\n      ret.push({\n        left: rect.left,\n        top: rect.top,\n        width: hole.left - rect.left,\n        height: rect.height\n      });\n    }\n\n    // Right split.\n    if ((rect.left + rect.width) > (hole.left + hole.width)) {\n      ret.push({\n        left: hole.left + hole.width,\n        top: rect.top,\n        width: (rect.left + rect.width) - (hole.left + hole.width),\n        height: rect.height\n      });\n    }\n\n    // Top split.\n    if (rect.top < hole.top) {\n      ret.push({\n        left: rect.left,\n        top: rect.top,\n        width: rect.width,\n        height: hole.top - rect.top\n      });\n    }\n\n    // Bottom split.\n    if ((rect.top + rect.height) > (hole.top + hole.height)) {\n      ret.push({\n        left: rect.left,\n        top: hole.top + hole.height,\n        width: rect.width,\n        height: (rect.top + rect.height) - (hole.top + hole.height)\n      });\n    }\n\n    return ret;\n\n  };\n\n  /**\n   * Check if two rectangles overlap.\n   *\n   * @private\n   * @memberof muuriLayout\n   * @param {Rectangle} a\n   * @param {Rectangle} b\n   * @returns {Boolean}\n   */\n  muuriLayout.doRectsOverlap = function (a, b) {\n\n    return !((a.left + a.width) <= b.left || (b.left + b.width) <= a.left || (a.top + a.height) <= b.top || (b.top + b.height) <= a.top);\n\n  };\n\n  /**\n   * Check if a rectangle is fully within another rectangle.\n   *\n   * @private\n   * @memberof muuriLayout\n   * @param {Rectangle} a\n   * @param {Rectangle} b\n   * @returns {Boolean}\n   */\n  muuriLayout.isRectWithinRect = function (a, b) {\n\n    return a.left >= b.left && a.top >= b.top && (a.left + a.width) <= (b.left + b.width) && (a.top + a.height) <= (b.top + b.height);\n\n  };\n\n  /**\n   * Loops through an array of rectangles and removes all that are fully within\n   * another rectangle in the array.\n   *\n   * @private\n   * @memberof muuriLayout\n   * @param {Rectangle[]} rects\n   * @returns {Rectangle[]}\n   */\n  muuriLayout.purgeRects = function (rects) {\n\n    var i = rects.length;\n    var ii;\n    var rectA;\n    var rectB;\n\n    while (i--) {\n      rectA = rects[i];\n      ii = rects.length;\n      while (ii--) {\n        rectB = rects[ii];\n        if (i !== ii && muuriLayout.isRectWithinRect(rectA, rectB)) {\n          rects.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    return rects;\n\n  };\n\n  /**\n   * Sort rectangles with top-left gravity.\n   *\n   * @private\n   * @memberof muuriLayout\n   * @param {Rectangle} a\n   * @param {Rectangle} b\n   * @returns {Number}\n   */\n  muuriLayout.sortRectsTopLeft = function (a, b) {\n\n    return a.top - b.top || a.left - b.left;\n\n  };\n\n  /**\n   * Sort rectangles with left-top gravity.\n   *\n   * @private\n   * @memberof muuriLayout\n   * @param {Rectangle} a\n   * @param {Rectangle} b\n   * @returns {Number}\n   */\n  muuriLayout.sortRectsLeftTop = function (a, b) {\n\n    return a.left - b.left || a.top - b.top;\n\n  };\n\n  /**\n   * Type definitions\n   * ****************\n   */\n\n  /* eslint-disable */\n  /**\n   * The values by which multiple grid items can be queried. An html element or\n   * an array of HTML elements. Item or an array of items. Node list, live or\n   * static. Number (index) or a list of numbers (indices).\n   *\n   * @typedef {(HTMLElement|HTMLElement[]|Item|Item[]|NodeList|Number|Number[])} GridMultiItemQuery\n   */\n  /* eslint-enable */\n\n  /**\n   * The values by which a single grid item can be queried. An html element, an\n   * item instance or a number (index).\n   *\n   * @typedef {(HTMLElement|Item|Number)} GridSingleItemQuery\n   */\n\n  /**\n   * The grid item's state, a string. Accepted values are: \"active\", \"inactive\",\n   * \"visible\", \"hidden\", \"showing\", \"hiding\", \"positioning\", \"dragging\",\n   * \"releasing\" and \"migrating\".\n   *\n   * @typedef {String} GridItemState\n   */\n\n  /**\n   * The data that is required to orchestrate a sort action during drag.\n   *\n   * @typedef {Object} DragSortCommand\n   * @param {String} action\n   *   - \"move\" or \"swap\".\n   * @param {Number} index\n   *   - target index.\n   * @param {?Grid} [grid=null]\n   *   - target grid.\n   */\n\n  /**\n   * A rectangle is an object with width, height and offset (left and top) data.\n   *\n   * @typedef {Object} Rectangle\n   * @property {Number} width\n   * @property {Number} height\n   * @property {Number} left\n   * @property {Number} top\n   */\n\n  /**\n   * Layout data for the layout instance.\n   *\n   * @typedef {Object} LayoutData\n   * @property {Object} slots\n   * @property {Number} width\n   * @property {Number} height\n   * @property {Boolean} setWidth\n   * @property {Boolean} setHeight\n   */\n\n  /**\n   * @callback LayoutCallback\n   * @param {Boolean} isAborted\n   *   - Was the layout procedure aborted?\n   * @param {Item[]} items\n   *   - The items that were attempted to be positioned.\n   */\n\n  /**\n   * @callback ShowCallback\n   * @param {Item[]} items\n   *   - The items that were successfully shown without interruptions.\n   */\n\n  /**\n   * @callback HideCallback\n   * @param {Item[]} items\n   *   - The items that were successfully hidden without interruptions.\n   */\n\n  /**\n   * @callback FilterCallback\n   * @param {Item[]} shownItems\n   *   - The items that were shown.\n   * @param {Item[]} hiddenItems\n   *   - The items that were hidden.\n   */\n\n  /**\n   * Init\n   */\n\n  return Grid;\n\n}));\n","module.exports = function(module) {\r\n\tif (!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif (!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n","/* @flow */\nimport Muuri from 'muuri';\nimport { IdManager } from './IdManager';\nimport Item from './Item';\nimport { USE_SACK_ALGORITHM } from './flags'\n\n\nexport default class GridSystem {\n\tcolumnGrids : Array<Muuri>;\n\tboardGrid : Muuri;\n\t\n\tisAnswer: Array<boolean>;\n\tanswerItems: Map<string, Set<Item> >;\n\tcandidateItems: Set<Item>;\n\titemsMap: {[string]: Item};\n\titemsPosMap: Map<string, Item>;\n\n\tcandidatesTableName: string;\n\tanswersTablesNames: Array<string>;\n\tmuuris: Map<string, Muuri>;\n\tcontainers: Map<string, HTMLElement>;\n\n\tsortItems: (items: Array<string> ,itemsPos: Array<string>) => void;\n\tgenerate_muuri: (tableName: string, container: HTMLElement, include_item: (Item)=>void) => void;\n\n\t__bind_functions() {\n\t\tthis.sortItems = this.sortItems.bind(this);\n\t\tthis.generate_muuri = this.generate_muuri.bind(this);\n\t}\n\n\tconstructor(listsContainer: HTMLElement, items: Array<Item>, tablesMetadata: Array<[string,string]>) {\n\t\tthis.__bind_functions();\n\t\tvar that = this;\n\n\t\tthis.candidatesTableName = tablesMetadata[0][0];\n\t\tthis.answersTablesNames = tablesMetadata.slice(1).map((pair) => pair[0])\n\t\tthis.muuris = new Map();\n\t\tthis.containers = new Map();\n\n\t\t// Add mapped items and sets\n\t\tthis.answerItems = new Map();\n\t\tthis.candidateItems = new Set();\n\t\tthis.itemsMap = {};\n\t\tthis.itemsPosMap = new Map();\n\t\tfor(let i=0;i<items.length;i++) {\n\t\t\tthis.itemsMap[items[i].get_id()] = items[i];\n\t\t\tthis.itemsPosMap.set(items[i].get_pos_id(), items[i])\n\t\t\t\n\t\t\t// Add all items as candidates\n\t\t\tthis.candidateItems.add(items[i]);\n\t\t}\n\n\t\tthis.columnGrids = []\n\n\t\tfor(var tableId=1;tableId < tablesMetadata.length;tableId++) {\n\t\t\tconst metadata = tablesMetadata[tableId];\n\t\t\tconst tableName = metadata[0];\n\t\t\tconst tableColor = metadata[1];\n\n\t\t\tvar container = document.createElement('div');\n\t\t\tcontainer.setAttribute('class', 'permutation-column')\n\n\t\t\tvar headerContainer = document.createElement('div');\n\t\t\theaderContainer.setAttribute('class', 'permutation-column-header unselectable');\n\t\t\theaderContainer.style.background = tableColor;\n\t\t\tvar header = document.createElement('span')\n\t\t\theader.setAttribute('class', 'glyphicon glyphicon-th-list')\n\t\t\theaderContainer.appendChild(header);\n\t\t\theaderContainer.innerHTML += `<b> ${tableName}</b>`;\n\n\t\t\tlet gridContainer = document.createElement('div');\n\t\t\tgridContainer.setAttribute('class', 'permutation-column-content')\n\t\t\t\n\t\t\tcontainer.appendChild(headerContainer)\n\t\t\tcontainer.appendChild(gridContainer)\n\t\t\tlistsContainer.appendChild(container);\n\n\t\t\tthis.add_table(gridContainer, tableName, tableColor, tablesMetadata);\n\t\t}\n\n\t\tvar container2 = document.createElement('div');\n\t\tcontainer2.setAttribute('class', 'permutation-column')\n\n\t\tvar headerContainer2 = document.createElement('div');\n\t\theaderContainer2.setAttribute('class', 'permutation-column-header unselectable');\n\t\theaderContainer2.style.background = tablesMetadata[0][1];\n\t\tvar header2 = document.createElement('span')\n\t\theader2.setAttribute('class', 'glyphicon glyphicon-trash')\n\t\theaderContainer2.appendChild(header2);\n\t\theaderContainer2.innerHTML += `<b> ${tablesMetadata[0][0]}</b>`;\n\n\t\tlet candidatesContainer = document.createElement('div');\n\t\tcandidatesContainer.setAttribute('class', 'permutation-column-content')\n\t\tcandidatesContainer.setAttribute('id', `${IdManager.pid}-candidates`)\n\n\t\tthis.populate_items(items, candidatesContainer);\n\t\t\n\t\tcontainer2.appendChild(headerContainer2)\n\t\tcontainer2.appendChild(candidatesContainer)\n\t\tlistsContainer.appendChild(container2);\n        \n\t\tthis.generate_muuri(this.candidatesTableName, candidatesContainer, \n\t\t\t(item:Item) => { // Include item\n\t\t\t\tfor(var tableId=1;tableId < tablesMetadata.length;tableId++) {\n\t\t\t\t\tconst metadata = tablesMetadata[tableId];\n\t\t\t\t\tconst tableName = metadata[0];\n\t\t\t\t\n\t\t\t\t\tvar table = that.answerItems.get(tableName);\n\t\t\t\t\tif(!table) {\n\t\t\t\t\t\tconsole.error(`Undefined table ${tableName}`)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else if(table.has(item)) {\n\t\t\t\t\t\t// WARNING does 'delete' works in all browsers?\n\t\t\t\t\t\ttable.delete(item);\n\n\t\t\t\t\t\tvar sorted: Array<Item> = that.get_sorted_items(table);\n\t\t\t\t\t\tfor(let i=0;i<sorted.length;i++) {\n\t\t\t\t\t\t\tsorted[i].update_position(tableName, i+1);// Starts in 1\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthat.candidateItems.add(item);\n\t\t\t\t\n\t\t\t\tif(USE_SACK_ALGORITHM) {\n\t\t\t\t\titem.update_position(tablesMetadata[0][0], -1); // Candidates bag\n\t\t\t\t} else {\n\t\t\t\t\tvar sorted: Array<Item> = that.get_sorted_items(that.candidateItems);\n\t\t\t\t\tfor(let i=0;i<sorted.length;i++) {\n\t\t\t\t\t\tsorted[i].update_position(tablesMetadata[0][0], -i-1); // Candidates bag\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\tthis.boardGrid = new Muuri('.permutation', {\n\t\t\tlayoutDuration: 400,\n\t\t\tlayoutEasing: 'ease',\n\t\t\tdragEnabled: false,\n\t\t\tdragSortInterval: 0,\n\t\t\tdragStartPredicate: {\n\t\t\t\thandle: '.permutation-column-header'\n\t\t\t},\n\t\t\tdragReleaseDuration: 400,\n\t\t\tdragReleaseEasing: 'ease'\n\t\t});\n\t}\n\n\t// @external\n\tsortItems(items: Array<string>, itemsPos: Array<string>) {\n\t\t// Remove all candidates\n\t\tvar candidatesMuuri: Muuri = this.muuris.get(this.candidatesTableName);\n\t\tvar tmpContainer = this.containers.get(this.candidatesTableName);\n\t\tif(!tmpContainer) {\n\t\t\tconsole.error('Candidates container not found')\n\t\t\treturn;\n\t\t}\n\t\tvar candidatesContainer: HTMLElement = tmpContainer;\n\t\tthis.candidateItems.forEach((item: Item) => {\n\t\t\tcandidatesMuuri.remove(0);\t\n\t\t\tcandidatesContainer.removeChild(item.get_card());\n\t\t})\n\t\t// Remove all current answers\n\t\tfor(var i=0;i<this.answersTablesNames.length;i++) {\n\t\t\tvar tableName = this.answersTablesNames[i]\n\n\t\t\tvar muuriGrid = this.muuris.get(tableName)\n\t\t\tvar container = this.containers.get(tableName)\n\t\t\tvar itemSet = this.answerItems.get(tableName)\n\t\t\t\n\t\t\tif(!itemSet || !muuriGrid || !container) {\n\t\t\t\tconsole.error('Item not found!')\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\titemSet.forEach((item: Item) => {\n\t\t\t\tmuuriGrid.remove(0);\n\t\t\t\tcontainer.removeChild(item.get_card())\n\t\t\t})\n\t\t}\n\t\t// Removing items logically\n\t\tthis.candidateItems.clear();\n\t\tthis.answerItems.forEach((items: Set<Item>) => {\n\t\t\titems.clear();\n\t\t})\n\n\t\t// Computing new positions\n\t\tvar mappedOrder: Map<string, Map<number, Item> > = new Map();\n\t\tmappedOrder.set(this.candidatesTableName, new Map());\n\t\tthis.answersTablesNames.forEach((tableName: string) => {\n\t\t\tmappedOrder.set(tableName, new Map());\n\t\t})\n\t\tconsole.log(this.itemsPosMap)\n\t\titems.map((itemId: string, i: number) => {\n\t\t\tif(!this.itemsPosMap.has(itemId)) {\n\t\t\t\t// console.log(`Not found item ${itemId}`)\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar item = this.itemsPosMap.get(itemId);\n\t\t\tvar itemPos: string = itemsPos[i];\n\t\t\tvar sepPos = itemPos.lastIndexOf(\"#\");\n\n\t\t\tvar tableName = itemPos.substring(0, sepPos);\n\t\t\tvar pos = parseInt(itemPos.substring(sepPos+1));\n\n\t\t\tvar map = mappedOrder.get(tableName);\n\t\t\t\n\t\t\tif(!map) {\n\t\t\t\tconsole.error(`Error loading map from table \"${tableName}\"`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(!item) {\n\t\t\t\tconsole.error(`Error loading item \"${itemId}\", got ${item}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Add items logically\n\t\t\tif(tableName == this.candidatesTableName) {\n\t\t\t\tthis.candidateItems.add(item)\n\t\t\t\titem.update_position(tableName, -pos)\n\t\t\t} else {\n\t\t\t\tvar tableItems = this.answerItems.get(tableName)\n\t\t\t\tif(!tableItems) console.error('Could not find items table')\n\t\t\t\telse tableItems.add(item)\n\t\t\t\titem.update_position(tableName, pos)\n\t\t\t}\n\n\t\t\tif(map.has(pos))\n\t\t\t \t// FIXME: When using SACK_ALGORITHM, all the candidates have the same position\n\t\t\t\tmap.set(map.size+1, item)\n\t\t\tmap.set(pos, item)\n\t\t});\n\t\tvar newOrder: {[string]: Array<Item>} = {};\n\t\tmappedOrder.forEach((posMap: Map<number, Item>, tableName: string) => {\n\t\t\tvar sortedItems: Array<Item> = [...posMap.entries()].sort((a: [number, Item], b: [number, Item]) => {\n\t\t\t\treturn a[0] > b[0] ? 1:-1; // Assuming non repeated keys\n\t\t\t}).map((pair: [number, Item]) => { return pair[1]; });\n\t\t\tnewOrder[tableName] = sortedItems;\n\t\t});\n\t\t// Repopulating with DOM elements\n\t\tcandidatesMuuri.add(newOrder[this.candidatesTableName].map((item: Item) => {return item.get_card()}));\n\t\tfor(var i=0;i<this.answersTablesNames.length;i++) {\n\t\t\tvar tableName = this.answersTablesNames[i];\n\n\t\t\tvar muuri = this.muuris.get(tableName)\n\t\t\tif(!muuri) {\n\t\t\t\tconsole.error(`Could not find muuri for table ${tableName}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tmuuri.add(newOrder[tableName].map((item: Item) => {return item.get_card()}));\n\t\t}\n\t}\n\n\tpopulate_items(items: Array<Item>, container: HTMLElement) {\n\t\tfor(var i=0;i<items.length;i++) {\n\t\t\tcontainer.appendChild(items[i].get_card())\n\t\t}\n\t}\n\n\tadd_table(container: HTMLElement, tableName: string, tableColor: string, tablesMetadata: Array<[string, string]>) {\n\t\tvar that = this;\n\t\tthis.answerItems.set(tableName, new Set());\n\t\t\n\t\tthis.generate_muuri(tableName, container, (item:Item) => {\n\t\t\tif(that.candidateItems.has(item)) {\n\t\t\t\t// WARNING does 'delete' works in all browsers?\n\t\t\t\tthat.candidateItems.delete(item);\n\n\t\t\t\tif(!USE_SACK_ALGORITHM) {\n\t\t\t\t\tvar sorted: Array<Item> = that.get_sorted_items(that.candidateItems);\n\t\t\t\t\tfor(let i=0;i<sorted.length;i++) {\n\t\t\t\t\t\tsorted[i].update_position(tablesMetadata[0][0], -i-1); // Candidates bag\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Remove from other tables\n\t\t\tfor(var tableId=1;tableId < tablesMetadata.length;tableId++) {\n\t\t\t\tconst metadata = tablesMetadata[tableId];\n\t\t\t\tconst otherTableName = metadata[0];\n\t\t\t\tif(otherTableName == tableName) continue;\n\t\t\t\n\t\t\t\tvar table = that.answerItems.get(otherTableName);\n\t\t\t\tif(!table) {\n\t\t\t\t\tconsole.error(`Undefined table ${otherTableName}`)\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if(table.has(item)) {\n\t\t\t\t\t// WARNING does 'delete' works in all browsers?\n\t\t\t\t\ttable.delete(item);\n\n\t\t\t\t\tvar sorted: Array<Item> = that.get_sorted_items(table);\n\t\t\t\t\tfor(let i=0;i<sorted.length;i++) {\n\t\t\t\t\t\tsorted[i].update_position(otherTableName, i+1);// Starts in 1\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar table = that.answerItems.get(tableName)\n\t\t\tif(table) {\n\t\t\t\ttable.add(item);\n\n\t\t\t\tvar sorted: Array<Item> = that.get_sorted_items(table);\n\t\t\t\tfor(let i=0;i<sorted.length;i++) {\n\t\t\t\t\tsorted[i].update_position(tableName, i+1);// Starts in 1\n\t\t\t\t}\n\t\t\t} else console.error(`Undefined table ${tableName}`);\n\t\t});\n\t}\n\n\tget_sorted_items(unsorted: Set<Item>) {\n\t\tvar sorted: Array<Item> = [];\n\n\t\tvar posItemPair: Array<[number, Item]> = [];\n\t\tunsorted.forEach(function(item) {\n\t\t\tposItemPair.push([item.get_y(), item]);\n\t\t});\n\t\t\n\t\tposItemPair = posItemPair.sort(function(a:[number, Item], b:[number, Item]): number {\n\t\t\treturn a[0] > b[0]? 1: -1;\n\t\t});\n\t\t\n\t\tfor(let i=0;i<posItemPair.length;i++) sorted.push(posItemPair[i][1]);\n\n\t\treturn sorted;\n\t}\n\n\tgenerate_muuri(tableName: string, container: HTMLElement, include_item: (Item)=>void) {\n\t\tvar that = this;\n\n\t\tvar grid = new Muuri(container, {\n\t\t\titems: '.permutation-item',\n\t\t\tlayoutDuration: 400,\n\t\t\tlayoutEasing: 'ease',\n\t\t\tdragEnabled: true,\n\t\t\tdragSort: function () {\n\t\t\t\treturn that.columnGrids;\n\t\t\t},\n\t\t\tdragSortInterval: 0,\n\t\t\tdragContainer: document.body, // TODO: can we drag items in the whole body?\n\t\t\tdragReleaseDuration: 400,\n\t\t\tdragReleaseEasing: 'ease'\n\t\t})\n\t\t.on('dragStart', function (item) {\n\t\t\t// Let's set fixed widht/height to the dragged item\n\t\t\t// so that it does not stretch unwillingly when\n\t\t\t// it's appended to the document body for the\n\t\t\t// duration of the drag.\n\t\t\titem.getElement().style.width = item.getWidth() + 'px';\n\t\t\titem.getElement().style.height = item.getHeight() + 'px';\n\t\t\t//console.log('Pressed element ' + item._child.getAttribute('name') + ' at ' + name);\n\t\t})\n\t\t.on('dragReleaseEnd', function (item) {\n\t\t\t// Let's remove the fixed width/height from the\n\t\t\t// dragged item now that it is back in a grid\n\t\t\t// column and can freely adjust to it's\n\t\t\t// surroundings.\n\t\t\titem.getElement().style.width = '';\n\t\t\titem.getElement().style.height = '';\n\t\t\t// Just in case, let's refresh the dimensions of all items\n\t\t\t// in case dragging the item caused some other items to\n\t\t\t// be different size.\n\t\t\tthat.columnGrids.forEach(function (grid) {\n\t\t\t\tgrid.refreshItems();\n\t\t\t});\n\t\t\tif(include_item!=null) include_item(that.itemsMap[item._child.getAttribute('id')]);\n\t\t\t//console.log('Released element ' + item._child.getAttribute('name'));\n\t\t})\n\t\t.on('layoutStart', function () {\n\t\t\t// Let's keep the board grid up to date with the\n\t\t\t// dimensions changes of column grids.\n\t\t\tthat.boardGrid.refreshItems().layout();\n\t\t});\n\n\t\tthat.columnGrids.push(grid);\n\t\tthat.muuris.set(tableName, grid)\n\t\tthat.containers.set(tableName, container)\n\t}\n}","/* @flow */\n\n\nexport const IdManager = new class {\n    TPL_ANSWER_CONTAINER: string;\n    TPL_CANDIDATES_CONTAINER: string;\n    TPL_HIDDEN_INPUTS: string;\n    TPL_CARD: string;\n    TPL_HIDDEN_INPUT_POS: string;\n    TPL_HIDDEN_INPUT_IPOS: string;\n\n    pid: string;\n    _initialized: boolean;\n\n    constructor() {\n        this._initialized = false;\n\n        this.TPL_ANSWER_CONTAINER = '$pid-answer'\n        this.TPL_CANDIDATES_CONTAINER = '$pid-candidates'\n        this.TPL_HIDDEN_INPUTS = '$pid-hidden-inputs'\n        this.TPL_CARD = '$pid-card$item'\n        this.TPL_HIDDEN_INPUT_POS = '$pid-$item-pos'\n        this.TPL_HIDDEN_INPUT_IPOS = '$pid-$item-ipos'\n    }\n\n    // Lazy initialization\n    init(pid: string) {\n        this.pid = pid;\n        this._initialized = true;\n    }\n\n    stringify(template: string, itemid: string|null = null) {\n        if(!this._initialized) throw 'Uninitialized IdManager';\n\n        if(itemid==null) return template.replace('$pid', this.pid)\n\t    else return template.replace('$pid', this.pid).replace('$item', itemid)\n    }\n}\n","/* @flow */\nimport { IdManager } from './IdManager';\nimport { USE_SACK_ALGORITHM } from './flags';\n\nexport default class Item {\n    // Hidden input name ($pid-$item)\n    name: string;\n    // Initial position\n    ipos: number;\n    // Current container table.\n    table: string;\n    // Current position. negative positions belongs to discarted elements\n    pos: number;\n    // Card content\n    content: string;\n\n    // Card\n    card: HTMLElement;\n    enumeration: HTMLElement;\n    contentCard: HTMLElement;\n    // Hidden inputs\n    iposHiddenInput: HTMLElement;\n    posHiddenInput: HTMLElement;\n\n    // Flags\n    showEnum: boolean;\n    textSelectable: boolean;\n\n    constructor(ipos: number, name: string, content: string, showEnum?: boolean = true) {\n\n        if(USE_SACK_ALGORITHM && this.ipos < 0) {// if negative then it is a candidate item\n            this.ipos = -1; // -1 for all candidate items\n        } else this.ipos = ipos;\n\n        this.name = name;\n        this.content = content;\n\n        // Flags\n        this.showEnum = showEnum\n        this.textSelectable = false\n\n        // Current position = initial position\n        this.pos = this.ipos;\n    }\n\n    get_id() {\n        return IdManager.stringify(IdManager.TPL_CARD, this.ipos+'');\n    }\n\n    toString() {\n        return this.content;\n    }\n\n    build(tableName: string) {\n        // Building card\n        this.enumeration = document.createElement('span')\n        //this.enumeration.style.fontWeight = 'bold';\n        this.enumeration.style.fontSize = '1.2em';\n        this.enumeration.style.position = 'absolute';\n\n        this.enumeration.innerHTML = '';\n        \n        this.contentCard = document.createElement('div')\n        this.contentCard.innerHTML = this.content\n        if(this.showEnum) this.contentCard.style.marginLeft = '2em'\n\n        this.card = document.createElement('div')\n        this.card.classList.add('permutation-item')\n        if(!this.textSelectable) this.card.classList.add('unselectable')\n\n        var itemContent: HTMLElement = document.createElement('div')\n        itemContent.setAttribute('class', 'permutation-item-content')\n        itemContent.setAttribute('id', this.get_id())\n        itemContent.appendChild(this.enumeration)\n        itemContent.appendChild(this.contentCard)\n\n        this.card.appendChild(itemContent)\n\n        // Building hidden inputs\n        this.iposHiddenInput = document.createElement('input')\n        this.iposHiddenInput.setAttribute('type', 'hidden')\n        this.iposHiddenInput.setAttribute('name', IdManager.stringify(IdManager.TPL_HIDDEN_INPUT_IPOS, this.name))\n        this.iposHiddenInput.setAttribute('value', tableName + '#' + this.ipos)\n\n        this.posHiddenInput = document.createElement('input')\n        this.posHiddenInput.setAttribute('type', 'hidden')\n        this.posHiddenInput.setAttribute('name', this.get_pos_id())\n        this.posHiddenInput.setAttribute('value', tableName + '#' + this.pos)\n    }\n\n    get_pos_id() {\n        return IdManager.stringify(IdManager.TPL_HIDDEN_INPUT_POS, this.name);\n    }\n\n    update_position(tableName: string, pos: number) {\n        this.table = tableName;\n        this.pos = pos;\n        if(pos < 0) this.posHiddenInput.setAttribute('value', this.table + '#' + (-this.pos))\n        else this.posHiddenInput.setAttribute('value', this.table + '#' + this.pos)\n        \n        if(pos > 0) {\n            if(this.showEnum) this.enumeration.innerHTML = pos+'. '\n        } else {\n            this.enumeration.innerHTML = ''\n        }\n    }\n\n    get_card() {\n        return this.card;\n    }\n\n    get_iposHiddenInput() {\n        return this.iposHiddenInput;\n    }\n\n    get_posHiddenInput() {\n        return this.posHiddenInput;\n    }\n\n    get_y() {\n        return this.card.getBoundingClientRect().top;\n    }\n}","/* @flow */\nimport Item from './Item';\nimport Muuri from 'muuri';\nimport { IdManager } from './IdManager';\n\n\nexport default class PermutationList {\n    columnGrid: Muuri;\n    listContainer: HTMLElement;\n\n    answers: Set<Item>;\n    itemsMap: {[string]: Item};\n\n    constructor(listContainer: HTMLElement, items: Array<Item>, tableName: string) {\n        var that = this;\n\n        this.listContainer = listContainer;\n\n        this.answers = new Set();\n\t\tthis.itemsMap = {};\n\t\tfor(let i=0;i<items.length;i++) {\n\t\t\tthis.itemsMap[items[i].get_id()] = items[i];\n\t\t\tthis.answers.add(items[i]);\n        }\n        \n        this.generate_muuri(listContainer, function(item:Item) {\n            var sorted: Array<Item> = that.get_sorted_items(that.answers);\n            for(let i=0;i<sorted.length;i++) {\n                sorted[i].update_position(tableName, i+1);// Starts in 1\n            }\n\t\t})\n    }\n\n    get_sorted_items(unsorted: Set<Item>) {\n\t\tvar sorted: Array<Item> = [];\n\n\t\tvar posItemPair: Array<[number, Item]> = [];\n\t\tunsorted.forEach(function(item) {\n\t\t\tposItemPair.push([item.get_y(), item]);\n\t\t});\n\t\t\n\t\tposItemPair = posItemPair.sort(function(a:[number, Item], b:[number, Item]): number {\n\t\t\treturn a[0] > b[0]? 1: -1;\n\t\t});\n\t\t\n\t\tfor(let i=0;i<posItemPair.length;i++) sorted.push(posItemPair[i][1]);\n\n\t\treturn sorted;\n\t}\n\n    generate_muuri(container: HTMLElement, process_item: (Item)=>void) {\n        var that = this;\n\n\t\tvar grid = new Muuri(container, {\n\t\t\titems: '.permutation-item',\n\t\t\tlayoutDuration: 400,\n\t\t\tlayoutEasing: 'ease',\n\t\t\tdragEnabled: true,\n\t\t\tdragSort: function () {\n\t\t\t\treturn [that.columnGrid];\n\t\t\t},\n\t\t\tdragSortInterval: 0,\n\t\t\tdragContainer: document.body, // TODO: can we drag items in the whole body?\n\t\t\tdragReleaseDuration: 400,\n\t\t\tdragReleaseEasing: 'ease'\n\t\t})\n\t\t.on('dragStart', function (item) {\n\t\t\t// Let's set fixed widht/height to the dragged item\n\t\t\t// so that it does not stretch unwillingly when\n\t\t\t// it's appended to the document body for the\n\t\t\t// duration of the drag.\n\t\t\titem.getElement().style.width = item.getWidth() + 'px';\n\t\t\titem.getElement().style.height = item.getHeight() + 'px';\n\t\t\t//console.log('Pressed element ' + item._child.getAttribute('name') + ' at ' + name);\n\t\t})\n\t\t.on('dragReleaseEnd', function (item) {\n\t\t\t// Let's remove the fixed width/height from the\n\t\t\t// dragged item now that it is back in a grid\n\t\t\t// column and can freely adjust to it's\n\t\t\t// surroundings.\n\t\t\titem.getElement().style.width = '';\n\t\t\titem.getElement().style.height = '';\n\t\t\t// Just in case, let's refresh the dimensions of all items\n\t\t\t// in case dragging the item caused some other items to\n\t\t\t// be different size.\n\t\t\tthat.columnGrid.refreshItems();\n\t\t\tif(process_item!=null) process_item(that.itemsMap[item._child.getAttribute('id')]);\n\t\t\t//console.log('Released element ' + item._child.getAttribute('name'));\n\t\t});\n\n\t\tthat.columnGrid = grid;\n    }\n}","/* @flow */\n\n/* if true: assign -1 to all candidates\n   else: assign negative integers to candidates */\nexport const USE_SACK_ALGORITHM = false;","/* @flow */\nimport GridSystem from './GridSystem';\nimport { IdManager } from './IdManager';\nimport Item from './Item';\nimport PermutationList from './PermutationList';\n\n\nfunction generate_trello_ui(pid: string, elems: Array<string>, elemsId: Array<string>, \n\t\t\t\t\t\t\ttablesMetadata: Array<[string,string]>) {\n\tvar nullListsContainer: HTMLElement|null = document.getElementById(IdManager.stringify(IdManager.TPL_ANSWER_CONTAINER))\n\t// var nullCandidatesContainer: HTMLElement|null = document.getElementById(IdManager.stringify(IdManager.TPL_CANDIDATES_CONTAINER))\n\tvar nullHiddenInputs: HTMLElement|null = document.getElementById(IdManager.stringify(IdManager.TPL_HIDDEN_INPUTS))\n\n\tif(nullListsContainer==null || nullHiddenInputs==null) {\n\t\tconsole.error(`Something is null:`)\n\t\tconsole.log(nullListsContainer)\n\t\tconsole.log(nullHiddenInputs)\n\t\treturn;\n\t}\n\n\tconst listsContainer: HTMLElement = nullListsContainer;\n\t// const candidatesContainer: HTMLElement = nullCandidatesContainer;\n\tconst hiddenInputs: HTMLElement = nullHiddenInputs;\n\n\tvar items: Array<Item> = [];\n\n\tfor(let i=0;i<elems.length;i++) {\n\t\tvar item: Item;\n\n\t\titem = new Item(i+1, elemsId[i], elems[i]) // 1,2,3\n\t\titem.build(tablesMetadata[0][0])\n\n\t\thiddenInputs.appendChild(item.get_iposHiddenInput())\n\t\thiddenInputs.appendChild(item.get_posHiddenInput())\n\n\t\titems.push(item)\n\t}\n\treturn new GridSystem(listsContainer, items, tablesMetadata)\n}\n\nfunction generate_list_ui(pid: string, elems: Array<string>, elemsId: Array<string>, \n\t\t\t\t\t\t\ttablesMetadata: Array<[string,string]>) {\n\tconst tableName = tablesMetadata[1][0];\n\tconst tableColor = tablesMetadata[1][1];\n\t\n\tvar nullAnswersContainer: HTMLElement|null = document.getElementById(IdManager.stringify(IdManager.TPL_ANSWER_CONTAINER))\n\tvar nullHiddenInputs: HTMLElement|null = document.getElementById(IdManager.stringify(IdManager.TPL_HIDDEN_INPUTS))\n\n\tif(nullAnswersContainer==null || nullHiddenInputs==null) {\n\t\tconsole.error(`Something is null:`)\n\t\tconsole.log(nullAnswersContainer)\n\t\tconsole.log(nullHiddenInputs)\n\t\treturn;\n\t}\n\n\tvar container = document.createElement('div');\n\tcontainer.setAttribute('class', 'permutation-column')\n\n\tvar headerContainer = document.createElement('div');\n\theaderContainer.setAttribute('class', 'permutation-column-header unselectable');\n\theaderContainer.style.background = tableColor;\n\tvar header = document.createElement('span')\n\theader.setAttribute('class', 'glyphicon glyphicon-th-list')\n\theaderContainer.appendChild(header);\n\theaderContainer.innerHTML += `<b> ${tableName}</b>`;\n\n\tlet gridContainer = document.createElement('div');\n\tgridContainer.setAttribute('class', 'permutation-column-content')\n\t\n\tcontainer.appendChild(headerContainer)\n\tcontainer.appendChild(gridContainer)\n\tnullAnswersContainer.appendChild(container);\n\n\tconst answersContainer: HTMLElement = gridContainer;\n\tconst hiddenInputs: HTMLElement = nullHiddenInputs;\n\n\tvar items: Array<Item> = [];\n\n\tfor(let i=0;i<elems.length;i++) {\n\t\tvar item: Item;\n\n\t\titem = new Item(i+1, elemsId[i], elems[i]) // Starts in 1\n\t\titem.build(tableName)\n\n\t\tanswersContainer.appendChild(item.get_card())\n\t\thiddenInputs.appendChild(item.get_iposHiddenInput())\n\t\thiddenInputs.appendChild(item.get_posHiddenInput())\n\n\t\titems.push(item)\n\t}\n\treturn new PermutationList(answersContainer, items, tableName)\n}\n\nexport function generate_ui(ptype: 'trello'|'list', pid: string, elems: Array<string>, elemsId: Array<string>,\n\t\t\t\t\t\t\ttablesMetadata: Array<[string,string]>) {\n\tIdManager.init(pid);\n\n\tconsole.log(ptype)\n\t\n\tif(ptype=='trello')\n\t\treturn generate_trello_ui(pid, elems, elemsId, tablesMetadata);\n\tif(ptype=='list')\n\t\treturn generate_list_ui(pid, elems, elemsId, tablesMetadata);\n}\n\n\n// generate_permutation_list([Array(110).join(' C-C C+C ') + ';','D','A','B'], '.board-column-content');\n"],"sourceRoot":""}